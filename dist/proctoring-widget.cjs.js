"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const n=require("react");var ct={exports:{}},Ne={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lt;function gt(){if(lt)return Ne;lt=1;var o=n,f=Symbol.for("react.element"),i=Symbol.for("react.fragment"),y=Object.prototype.hasOwnProperty,b=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_={key:!0,ref:!0,__self:!0,__source:!0};function j(R,v,L){var p,S={},W=null,z=null;L!==void 0&&(W=""+L),v.key!==void 0&&(W=""+v.key),v.ref!==void 0&&(z=v.ref);for(p in v)y.call(v,p)&&!_.hasOwnProperty(p)&&(S[p]=v[p]);if(R&&R.defaultProps)for(p in v=R.defaultProps,v)S[p]===void 0&&(S[p]=v[p]);return{$$typeof:f,type:R,key:W,ref:z,props:S,_owner:b.current}}return Ne.Fragment=i,Ne.jsx=j,Ne.jsxs=j,Ne}var qe={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dt;function yt(){return dt||(dt=1,process.env.NODE_ENV!=="production"&&function(){var o=n,f=Symbol.for("react.element"),i=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),j=Symbol.for("react.provider"),R=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),S=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),z=Symbol.for("react.offscreen"),Y=Symbol.iterator,U="@@iterator";function X(e){if(e===null||typeof e!="object")return null;var t=Y&&e[Y]||e[U];return typeof t=="function"?t:null}var N=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function A(e){{for(var t=arguments.length,r=new Array(t>1?t-1:0),l=1;l<t;l++)r[l-1]=arguments[l];G("error",e,r)}}function G(e,t,r){{var l=N.ReactDebugCurrentFrame,C=l.getStackAddendum();C!==""&&(t+="%s",r=r.concat([C]));var c=r.map(function(s){return String(s)});c.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,c)}}var Q=!1,fe=!1,he=!1,D=!1,O=!1,K;K=Symbol.for("react.module.reference");function F(e){return!!(typeof e=="string"||typeof e=="function"||e===y||e===_||O||e===b||e===L||e===p||D||e===z||Q||fe||he||typeof e=="object"&&e!==null&&(e.$$typeof===W||e.$$typeof===S||e.$$typeof===j||e.$$typeof===R||e.$$typeof===v||e.$$typeof===K||e.getModuleId!==void 0))}function me(e,t,r){var l=e.displayName;if(l)return l;var C=t.displayName||t.name||"";return C!==""?r+"("+C+")":r}function Ee(e){return e.displayName||"Context"}function Z(e){if(e==null)return null;if(typeof e.tag=="number"&&A("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case y:return"Fragment";case i:return"Portal";case _:return"Profiler";case b:return"StrictMode";case L:return"Suspense";case p:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case R:var t=e;return Ee(t)+".Consumer";case j:var r=e;return Ee(r._context)+".Provider";case v:return me(e,e.render,"ForwardRef");case S:var l=e.displayName||null;return l!==null?l:Z(e.type)||"Memo";case W:{var C=e,c=C._payload,s=C._init;try{return Z(s(c))}catch{return null}}}return null}var ee=Object.assign,oe=0,we,be,ke,Se,_e,pe,a;function d(){}d.__reactDisabledLog=!0;function m(){{if(oe===0){we=console.log,be=console.info,ke=console.warn,Se=console.error,_e=console.group,pe=console.groupCollapsed,a=console.groupEnd;var e={configurable:!0,enumerable:!0,value:d,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}oe++}}function P(){{if(oe--,oe===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:ee({},e,{value:we}),info:ee({},e,{value:be}),warn:ee({},e,{value:ke}),error:ee({},e,{value:Se}),group:ee({},e,{value:_e}),groupCollapsed:ee({},e,{value:pe}),groupEnd:ee({},e,{value:a})})}oe<0&&A("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var k=N.ReactCurrentDispatcher,V;function te(e,t,r){{if(V===void 0)try{throw Error()}catch(C){var l=C.stack.trim().match(/\n( *(at )?)/);V=l&&l[1]||""}return`
`+V+e}}var ie=!1,Te;{var ut=typeof WeakMap=="function"?WeakMap:Map;Te=new ut}function Ae(e,t){if(!e||ie)return"";{var r=Te.get(e);if(r!==void 0)return r}var l;ie=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var c;c=k.current,k.current=null,m();try{if(t){var s=function(){throw Error()};if(Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch($){l=$}Reflect.construct(e,[],s)}else{try{s.call()}catch($){l=$}e.call(s.prototype)}}else{try{throw Error()}catch($){l=$}e()}}catch($){if($&&l&&typeof $.stack=="string"){for(var h=$.stack.split(`
`),M=l.stack.split(`
`),E=h.length-1,T=M.length-1;E>=1&&T>=0&&h[E]!==M[T];)T--;for(;E>=1&&T>=0;E--,T--)if(h[E]!==M[T]){if(E!==1||T!==1)do if(E--,T--,T<0||h[E]!==M[T]){var q=`
`+h[E].replace(" at new "," at ");return e.displayName&&q.includes("<anonymous>")&&(q=q.replace("<anonymous>",e.displayName)),typeof e=="function"&&Te.set(e,q),q}while(E>=1&&T>=0);break}}}finally{ie=!1,k.current=c,P(),Error.prepareStackTrace=C}var re=e?e.displayName||e.name:"",ae=re?te(re):"";return typeof e=="function"&&Te.set(e,ae),ae}function Be(e,t,r){return Ae(e,!1)}function nt(e){var t=e.prototype;return!!(t&&t.isReactComponent)}function xe(e,t,r){if(e==null)return"";if(typeof e=="function")return Ae(e,nt(e));if(typeof e=="string")return te(e);switch(e){case L:return te("Suspense");case p:return te("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case v:return Be(e.render);case S:return xe(e.type,t,r);case W:{var l=e,C=l._payload,c=l._init;try{return xe(c(C),t,r)}catch{}}}return""}var ge=Object.prototype.hasOwnProperty,De={},$e=N.ReactDebugCurrentFrame;function Fe(e){if(e){var t=e._owner,r=xe(e.type,e._source,t?t.type:null);$e.setExtraStackFrame(r)}else $e.setExtraStackFrame(null)}function rt(e,t,r,l,C){{var c=Function.call.bind(ge);for(var s in e)if(c(e,s)){var h=void 0;try{if(typeof e[s]!="function"){var M=Error((l||"React class")+": "+r+" type `"+s+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[s]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw M.name="Invariant Violation",M}h=e[s](t,s,l,r,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(E){h=E}h&&!(h instanceof Error)&&(Fe(C),A("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",l||"React class",r,s,typeof h),Fe(null)),h instanceof Error&&!(h.message in De)&&(De[h.message]=!0,Fe(C),A("Failed %s type: %s",r,h.message),Fe(null))}}}var ce=Array.isArray;function Ce(e){return ce(e)}function Ye(e){{var t=typeof Symbol=="function"&&Symbol.toStringTag,r=t&&e[Symbol.toStringTag]||e.constructor.name||"Object";return r}}function Me(e){try{return ue(e),!1}catch{return!0}}function ue(e){return""+e}function Re(e){if(Me(e))return A("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Ye(e)),ue(e)}var Ue=N.ReactCurrentOwner,Ve={key:!0,ref:!0,__self:!0,__source:!0},Oe,ye;function ne(e){if(ge.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return e.ref!==void 0}function Ge(e){if(ge.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return e.key!==void 0}function Ke(e,t){typeof e.ref=="string"&&Ue.current}function ot(e,t){{var r=function(){Oe||(Oe=!0,A("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};r.isReactWarning=!0,Object.defineProperty(e,"key",{get:r,configurable:!0})}}function at(e,t){{var r=function(){ye||(ye=!0,A("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};r.isReactWarning=!0,Object.defineProperty(e,"ref",{get:r,configurable:!0})}}var He=function(e,t,r,l,C,c,s){var h={$$typeof:f,type:e,key:t,ref:r,props:s,_owner:c};return h._store={},Object.defineProperty(h._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(h,"_self",{configurable:!1,enumerable:!1,writable:!1,value:l}),Object.defineProperty(h,"_source",{configurable:!1,enumerable:!1,writable:!1,value:C}),Object.freeze&&(Object.freeze(h.props),Object.freeze(h)),h};function Je(e,t,r,l,C){{var c,s={},h=null,M=null;r!==void 0&&(Re(r),h=""+r),Ge(t)&&(Re(t.key),h=""+t.key),ne(t)&&(M=t.ref,Ke(t,C));for(c in t)ge.call(t,c)&&!Ve.hasOwnProperty(c)&&(s[c]=t[c]);if(e&&e.defaultProps){var E=e.defaultProps;for(c in E)s[c]===void 0&&(s[c]=E[c])}if(h||M){var T=typeof e=="function"?e.displayName||e.name||"Unknown":e;h&&ot(s,T),M&&at(s,T)}return He(e,h,M,C,l,Ue.current,s)}}var je=N.ReactCurrentOwner,Pe=N.ReactDebugCurrentFrame;function le(e){if(e){var t=e._owner,r=xe(e.type,e._source,t?t.type:null);Pe.setExtraStackFrame(r)}else Pe.setExtraStackFrame(null)}var Ie;Ie=!1;function ve(e){return typeof e=="object"&&e!==null&&e.$$typeof===f}function Xe(){{if(je.current){var e=Z(je.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function Ze(e){return""}var ze={};function Qe(e){{var t=Xe();if(!t){var r=typeof e=="string"?e:e.displayName||e.name;r&&(t=`

Check the top-level render call using <`+r+">.")}return t}}function Le(e,t){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var r=Qe(t);if(ze[r])return;ze[r]=!0;var l="";e&&e._owner&&e._owner!==je.current&&(l=" It was passed a child from "+Z(e._owner.type)+"."),le(e),A('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',r,l),le(null)}}function We(e,t){{if(typeof e!="object")return;if(Ce(e))for(var r=0;r<e.length;r++){var l=e[r];ve(l)&&Le(l,t)}else if(ve(e))e._store&&(e._store.validated=!0);else if(e){var C=X(e);if(typeof C=="function"&&C!==e.entries)for(var c=C.call(e),s;!(s=c.next()).done;)ve(s.value)&&Le(s.value,t)}}}function st(e){{var t=e.type;if(t==null||typeof t=="string")return;var r;if(typeof t=="function")r=t.propTypes;else if(typeof t=="object"&&(t.$$typeof===v||t.$$typeof===S))r=t.propTypes;else return;if(r){var l=Z(t);rt(r,e.props,"prop",l,e)}else if(t.PropTypes!==void 0&&!Ie){Ie=!0;var C=Z(t);A("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",C||"Unknown")}typeof t.getDefaultProps=="function"&&!t.getDefaultProps.isReactClassApproved&&A("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function g(e){{for(var t=Object.keys(e.props),r=0;r<t.length;r++){var l=t[r];if(l!=="children"&&l!=="key"){le(e),A("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",l),le(null);break}}e.ref!==null&&(le(e),A("Invalid attribute `ref` supplied to `React.Fragment`."),le(null))}}var w={};function x(e,t,r,l,C,c){{var s=F(e);if(!s){var h="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(h+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var M=Ze();M?h+=M:h+=Xe();var E;e===null?E="null":Ce(e)?E="array":e!==void 0&&e.$$typeof===f?(E="<"+(Z(e.type)||"Unknown")+" />",h=" Did you accidentally export a JSX literal instead of a component?"):E=typeof e,A("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",E,h)}var T=Je(e,t,r,C,c);if(T==null)return T;if(s){var q=t.children;if(q!==void 0)if(l)if(Ce(q)){for(var re=0;re<q.length;re++)We(q[re],e);Object.freeze&&Object.freeze(q)}else A("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else We(q,e)}if(ge.call(t,"key")){var ae=Z(e),$=Object.keys(t).filter(function(it){return it!=="key"}),se=$.length>0?"{key: someKey, "+$.join(": ..., ")+": ...}":"{key: someKey}";if(!w[ae+se]){var de=$.length>0?"{"+$.join(": ..., ")+": ...}":"{}";A(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,se,ae,de,ae),w[ae+se]=!0}}return e===y?g(T):st(T),T}}function I(e,t,r){return x(e,t,r,!0)}function B(e,t,r){return x(e,t,r,!1)}var H=B,J=I;qe.Fragment=y,qe.jsx=H,qe.jsxs=J}()),qe}process.env.NODE_ENV==="production"?ct.exports=gt():ct.exports=yt();var u=ct.exports;function ht(o){const f=window.AudioContext||window.webkitAudioContext,i=new f,y=i.createMediaStreamSource(o),b=i.createAnalyser();b.fftSize=2048,b.smoothingTimeConstant=.85,y.connect(b);const _=new Uint8Array(b.fftSize);function j(){b.getByteTimeDomainData(_);let R=0;for(let v=0;v<_.length;v++){const L=(_[v]-128)/128;R+=L*L}return Math.sqrt(R/_.length)}return{getLevel:()=>j(),dispose:async()=>{try{y.disconnect()}catch{}try{b.disconnect()}catch{}try{await i.close()}catch{}}}}let et=null;async function vt(){if(et)return et;const o=await Promise.resolve().then(()=>require("./blazeface.esm-BsJ4BrW4.cjs")),f=await Promise.resolve().then(()=>require("./index-x7BUnCGZ.cjs"));return f.ready&&await f.ready(),et=await o.load(),et}function ft(o,f,i){if(o.width<=0||o.height<=0||f<=0||i<=0)return!1;const y=Math.max(6,Math.floor(f*.06)),b=Math.max(6,Math.floor(i*.06));if(o.x<y||o.y<b||o.x+o.width>f-y||o.y+o.height>i-b)return!1;const _=o.width*o.height,j=f*i,R=_/j;if(R<.04||R>.65)return!1;const v=o.width/o.height;return!(v<.6||v>1.6)}async function wt(o){if("FaceDetector"in window)try{const i=await new window.FaceDetector({fastMode:!0,maxDetectedFaces:1}).detect(o);if(i&&i.length>0){const y=i[0]?.boundingBox,b=o.videoWidth||o.width||0,_=o.videoHeight||o.height||0;if(y){const j={x:y.x,y:y.y,width:y.width,height:y.height};if(ft(j,b,_))return{present:!0,confidence:.85}}}return{present:!1,confidence:0}}catch{}try{const i=await(await vt()).estimateFaces(o,!1);if(i&&i.length>0){const y=o.videoWidth||o.width||0,b=o.videoHeight||o.height||0;for(const _ of i){const[j,R]=_.topLeft,[v,L]=_.bottomRight,p={x:j,y:R,width:v-j,height:L-R};if(ft(p,y,b)){const S=_.probability?_.probability[0]:.75;return{present:!0,confidence:Math.max(.6,Math.min(1,S))}}}}}catch{}return{present:!1,confidence:0}}function mt({onComplete:o,onError:f}){const i=["camera","microphone","face","monitor","browser"],[y,b]=n.useState({camera:"pending",microphone:"pending",face:"pending",monitor:"pending",browser:"pending"}),[_,j]=n.useState(0),[R,v]=n.useState(0),[L,p]=n.useState({}),[S,W]=n.useState(!1),[z,Y]=n.useState({}),U=n.useRef(null),X=n.useRef(null),N=n.useRef(null),A=n.useRef(null),G=n.useRef(null),Q=()=>{try{U.current?.getTracks().forEach(a=>a.stop())}catch{}try{X.current?.getTracks().forEach(a=>a.stop())}catch{}U.current=null,X.current=null,N.current&&(N.current.dispose().catch(()=>{}),N.current=null),A.current&&(cancelAnimationFrame(A.current),A.current=null)},fe=async a=>{try{const d=window.AudioContext||window.webkitAudioContext;if(!d)throw new Error("AudioContext not supported");const m=new d,P=m.createMediaStreamSource(a),k=m.createAnalyser();k.fftSize=256,k.smoothingTimeConstant=.8,P.connect(k);const V=new Uint8Array(k.frequencyBinCount);k.getByteFrequencyData(V),sessionStorage.setItem("audio-context-initialized","true"),P.disconnect(),await m.close(),typeof window<"u"&&(window.precheckAudioStream=a)}catch{sessionStorage.setItem("audio-context-initialized","false")}},he=async a=>{const d=G.current;let m=0,P=0,k=0;const V=30;for(;k<V&&m<5;){try{const ie=await wt(d);ie.present&&(m+=1,P=Math.max(P,ie.confidence))}catch{}k++,j(k),await new Promise(ie=>setTimeout(ie,100))}return{status:m>=5,confidence:P,timestamp:Date.now()}},D=()=>{try{const a=window.screen.width,d=window.screen.height,m=window.screen.availWidth;return a/d>3||a>m*1.5||[3840,3360,2560,4480,5120].includes(a)?2:1}catch{return 1}},O=async()=>{try{if(!window.isSecureContext)return D();if("getScreenDetails"in window)try{return(await window.getScreenDetails()).screens.length}catch(a){if(a?.name==="NotAllowedError"||a?.name==="SecurityError"){W(!0);try{return await new Promise(P=>{const k=async()=>{V();try{const te=await window.getScreenDetails();P(te.screens.length)}catch{P(D())}},V=()=>{window.removeEventListener("pointerdown",k),window.removeEventListener("keydown",k)};window.addEventListener("pointerdown",k,{once:!0}),window.addEventListener("keydown",k,{once:!0})})}finally{W(!1)}}}return D()}catch{return 1}},K=()=>["navigator.mediaDevices","navigator.mediaDevices.getUserMedia","requestAnimationFrame","WebAssembly"].every(d=>{const m=d.split(".");let P=window;for(const k of m){if(!(k in P))return!1;P=P[k]}return!0}),F=(a,d)=>{b(m=>({...m,[a]:d}))},me=n.useCallback(async()=>{F("camera","running"),p(a=>({...a,camera:""}));try{try{U.current?.getTracks().forEach(d=>d.stop())}catch{}const a=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:15}}});if(U.current=a,!G.current){const d=document.createElement("video");d.muted=!0,d.playsInline=!0,G.current=d}G.current.srcObject=a;try{await G.current.play()}catch{}return Y(d=>({...d,cameraAccess:!0})),F("camera","passed"),!0}catch(a){const d=a?.name==="NotAllowedError"?"Camera permission denied":a?.message||"Camera access failed";return p(m=>({...m,camera:d})),F("camera","failed"),!1}},[]),Ee=n.useCallback(async()=>{F("microphone","running"),p(a=>({...a,microphone:""}));try{try{X.current?.getTracks().forEach(d=>d.stop())}catch{}const a=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});X.current=a,Y(d=>({...d,microphoneAccess:!0})),await fe(a);try{const d=ht(a);N.current=d;const m=()=>{v(d.getLevel()),A.current=requestAnimationFrame(m)};A.current=requestAnimationFrame(m)}catch{}return F("microphone","passed"),!0}catch(a){const d=a?.name==="NotAllowedError"?"Microphone permission denied":a?.message||"Microphone access failed";return p(m=>({...m,microphone:d})),F("microphone","failed"),!1}},[]),Z=n.useCallback(async()=>{F("face","running"),p(a=>({...a,face:""}));try{if(!U.current)throw new Error("Camera is not initialized");const a=await he(U.current);if(Y(d=>({...d,faceDetection:a})),a.status)return F("face","passed"),!0;throw new Error("No face detected. Please align your face within the frame and retry.")}catch(a){const d=a?.message||"Face detection failed";return p(m=>({...m,face:d})),F("face","failed"),!1}},[]),ee=n.useCallback(async()=>{F("monitor","running"),p(a=>({...a,monitor:""}));try{const a=await O();if(a&&a>1)throw Y(d=>({...d,monitorCount:a})),new Error("Multiple displays detected. Please remove external screens and keep only one display connected, then press Retry.");if(a===1)return Y(d=>({...d,monitorCount:a})),F("monitor","passed"),!0;throw new Error("Could not verify displays")}catch(a){return p(d=>({...d,monitor:a?.message||"Monitor verification failed"})),F("monitor","failed"),!1}},[]),oe=n.useCallback(async()=>{F("browser","running"),p(a=>({...a,browser:""}));try{const a=K();if(Y(d=>({...d,browserSupport:a})),!a)throw new Error("Required browser features are unavailable");return F("browser","passed"),!0}catch(a){return p(d=>({...d,browser:a?.message||"Browser not supported"})),F("browser","failed"),!1}},[]),we={camera:me,microphone:Ee,face:Z,monitor:ee,browser:oe},be=n.useCallback(async a=>{for(let d=a;d<i.length;d++){const m=i[d];if(!await we[m]())break}},[we]);n.useEffect(()=>{if(!i.every(m=>y[m]==="passed"))return;const d={cameraAccess:!!z.cameraAccess,microphoneAccess:!!z.microphoneAccess,faceDetection:z.faceDetection||{status:!1,confidence:0,timestamp:Date.now()},monitorCount:z.monitorCount||1,browserSupport:!!z.browserSupport,codeEditorReady:!0};o(d),Q()},[y,z]),n.useEffect(()=>(be(0),()=>Q()),[]);const ke=a=>{const d=i.indexOf(a);b(m=>{const P={...m};for(let k=d;k<i.length;k++)P[i[k]]="pending";return P}),p(m=>({...m,[a]:""})),be(d)},Se=i.filter(a=>y[a]==="passed").length,_e=i.some(a=>y[a]==="running"),pe=Math.round((Se+(_e?.5:0))/i.length*100);return u.jsx("div",{style:{fontFamily:"system-ui, sans-serif",minHeight:"100vh",display:"grid",placeItems:"center",background:"linear-gradient(135deg,#eff6ff,#eef2ff)"},children:u.jsxs("div",{style:{width:720,maxWidth:"95vw",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16,boxShadow:"0 8px 24px rgba(0,0,0,0.08)"},children:[u.jsxs("div",{style:{textAlign:"center",marginBottom:12},children:[u.jsx("h2",{style:{margin:0,fontSize:20,fontWeight:700},children:"System Pre-Check"}),u.jsx("p",{style:{color:"#6b7280"},children:"Verifying your system for proctored assessment"})]}),u.jsxs("div",{style:{marginBottom:16},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12},children:[u.jsx("span",{children:"Overall Progress"}),u.jsxs("span",{children:[pe,"%"]})]}),u.jsx("div",{style:{height:8,background:"#f3f4f6",borderRadius:9999,overflow:"hidden"},children:u.jsx("div",{style:{width:`${pe}%`,height:8,background:"#3b82f6"}})})]}),u.jsx("div",{style:{display:"grid",gap:8},children:i.map(a=>{const d=a==="camera"?"Camera Access":a==="microphone"?"Microphone Access":a==="face"?"Face Detection":a==="monitor"?"Single Monitor Check":"Browser Support",m=y[a],P=m==="passed"?"#ecfdf5":m==="running"?"#eff6ff":m==="failed"?"#fef2f2":"#f9fafb",k=m==="passed"?"#10b981":m==="running"?"#3b82f6":m==="failed"?"#dc2626":"#9ca3af";return u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"16px 1fr auto",gap:12,alignItems:"center",padding:12,borderRadius:8,border:"1px solid #e5e7eb",background:P},children:[u.jsx("div",{style:{width:12,height:12,borderRadius:9999,background:k}}),u.jsxs("div",{style:{minWidth:0},children:[u.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:u.jsx("div",{style:{fontWeight:600,fontSize:14},children:d})}),a==="face"&&u.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:8},children:[u.jsx("video",{ref:G,muted:!0,playsInline:!0,autoPlay:!0,style:{width:180,height:112,background:"#000",borderRadius:6}}),m==="running"&&u.jsxs("div",{style:{color:"#6b7280",fontSize:12},children:["Analyzing frames: ",_]})]}),a==="microphone"&&m!=="pending"&&u.jsx("div",{style:{marginTop:6,width:220,height:8,background:"#e5e7eb",borderRadius:9999,overflow:"hidden"},children:u.jsx("div",{style:{width:`${Math.min(100,Math.round(R*200))}%`,height:8,background:"#10b981",transition:"width 150ms"}})}),S&&a==="monitor"&&(m==="running"||m==="pending")&&u.jsx("div",{style:{marginTop:6,color:"#6b7280",fontSize:12},children:"Requesting display info… click anywhere or press a key to continue."}),L[a]&&u.jsx("div",{style:{marginTop:6,color:"#dc2626",fontSize:12},children:L[a]})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[u.jsx("div",{style:{fontSize:12,padding:"2px 8px",borderRadius:9999,background:m==="passed"?"#111827":m==="failed"?"#fee2e2":"#e5e7eb",color:m==="passed"?"#fff":"#111827"},children:m==="passed"?"Passed":m==="running"?"Checking…":m==="failed"?"Failed":"Pending"}),m==="failed"&&u.jsx("button",{onClick:()=>ke(a),style:{fontSize:12,padding:"6px 10px",borderRadius:6,background:"#111827",color:"#fff",border:0},children:"Retry"})]})]},a)})})]})})}function bt(o){const{onEvent:f,context:i="coding"}=o||{},[y,b]=n.useState("idle"),[_,j]=n.useState(void 0),[R,v]=n.useState(0),[L,p]=n.useState(0),S=n.useRef(null),W=n.useRef(null),z=n.useRef(null),Y=n.useRef(!1),U=n.useRef(0),X=n.useRef(0),N=n.useRef(null),A=n.useCallback(()=>{z.current&&cancelAnimationFrame(z.current),z.current=null;try{S.current?.dispose()}catch{}S.current=null;try{W.current?.getTracks().forEach(D=>D.stop())}catch{}W.current=null,b("idle")},[]),G=n.useCallback(D=>{const O=Date.now(),K=Y.current;D>18&&O-U.current>2e3&&(p(F=>F+1),U.current=O,f?.({eventType:"audio_anomaly",severity:"warning",context:i,data:{level:D,reason:"audio_spike",faceDetected:K}})),K&&D<3?N.current==null?N.current=O:O-N.current>15e3&&(p(F=>F+1),N.current=null,f?.({eventType:"audio_anomaly",severity:"warning",context:i,data:{level:D,reason:"extended_silence_with_face"}})):D>=3&&(N.current=null),!K&&D>12&&O-X.current>3e3&&(p(F=>F+1),X.current=O,f?.({eventType:"audio_anomaly",severity:"warning",context:i,data:{level:D,reason:"audio_without_face"}}))},[i,f]),Q=n.useCallback(()=>{try{if(!S.current)return;const D=S.current.getLevel(),O=Math.max(0,Math.min(100,Math.round(D*160)));v(O),G(O)}finally{z.current=requestAnimationFrame(Q)}},[G]),fe=n.useCallback(async D=>{try{j(void 0),p(0),U.current=0,X.current=0,N.current=null;let O=D;if(!O&&typeof window<"u"&&window.precheckAudioStream){const me=window.precheckAudioStream;me?.active&&me.getAudioTracks().length>0&&(O=me)}O||(O=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:44100}})),W.current=O;const K=O.getAudioTracks(),F=K.length?new MediaStream(K):O;S.current=ht(F),b("running"),z.current=requestAnimationFrame(Q)}catch(O){b("error"),j(O instanceof Error?O.message:String(O))}},[Q]),he=n.useCallback(D=>{Y.current=D},[]);return n.useEffect(()=>A,[A]),{status:y,error:_,level:R,anomalyCount:L,start:fe,stop:A,setFaceDetected:he}}function pt({monitoringStatus:o,sessionData:f,onStatusChange:i,onUpdateSession:y,onAddEvent:b}){const[_,j]=n.useState({x:typeof window<"u"?window.innerWidth-280:0,y:typeof window<"u"?window.innerHeight-400:0}),[R,v]=n.useState(!1),[L,p]=n.useState({x:0,y:0}),[S,W]=n.useState(0),[z,Y]=n.useState(!1),[U,X]=n.useState(null),[N,A]=n.useState(null),[G,Q]=n.useState(null),[fe,he]=n.useState(null),[D,O]=n.useState(0),[K,F]=n.useState(0),[me,Ee]=n.useState([]),[Z,ee]=n.useState(0),[oe,we]=n.useState(0),[be,ke]=n.useState(0),[Se,_e]=n.useState(0),[pe,a]=n.useState(0),[d,m]=n.useState(!1),[P,k]=n.useState(null),[V,te]=n.useState(null),[ie,Te]=n.useState(0),[ut,Ae]=n.useState(0),[Be,nt]=n.useState(0),[xe,ge]=n.useState(null),[De,$e]=n.useState(0),[Fe,rt]=n.useState(0),ce=n.useRef(null),Ce=n.useRef(null),Ye=n.useRef(null),Me=n.useRef(null),ue=n.useRef(null),Re=n.useRef(null),Ue=n.useRef(!1),Ve=n.useRef(0),Oe=n.useRef(0),ye=n.useRef("none");n.useRef({noFace:0,multipleFaces:0});const ne=n.useRef({noFace:!1,multipleFaces:!1,gazeOff:!1}),{level:Ge,anomalyCount:Ke,start:ot,stop:at,setFaceDetected:He}=bt({context:"coding",onEvent:g=>b?.({...g,timestamp:Date.now()})});n.useEffect(()=>O(Ge),[Ge]),n.useEffect(()=>F(Ke),[Ke]);const Je=n.useCallback((g,w)=>{const x=g.data;let I=0,B=0,H=0;for(let s=0;s<x.length;s+=4){const h=x[s],M=x[s+1],E=x[s+2],T=(h+M+E)/3;if(I+=T,s>0){const q=(x[s-4]+x[s-3]+x[s-2])/3;B+=Math.abs(T-q)}if(s>g.width*4&&s<x.length-g.width*4){const q=(x[s-g.width*4]+x[s-g.width*4+1]+x[s-g.width*4+2])/3,re=(x[s+g.width*4]+x[s+g.width*4+1]+x[s+g.width*4+2])/3;(Math.abs(T-q)>30||Math.abs(T-re)>30)&&H++}}const J=x.length/4;I/=J,B/=J;const e=H/J,t=w.width/w.height,r={neutral:Math.max(.1,.6-Math.abs(I-120)/200-Math.abs(B-15)/100),happy:Math.max(.05,(I>115?.4:.1)+(e>.15?.3:0)+(t>.85?.2:0)),focused:Math.max(.05,(B>20?.4:.1)+(e>.12?.2:0)+(I<110?.2:0)),concerned:Math.max(.05,(I<105?.3:.1)+(B>25?.2:0)+(t<.75?.2:0)),surprised:Math.max(.05,(t>.9?.3:.1)+(e>.18?.3:0))},l=Date.now()%1e4/1e4;Object.keys(r).forEach(s=>{const h=s;r[h]+=Math.sin(l*Math.PI*2)*.1,r[h]=Math.max(.05,Math.min(.95,r[h]))});const C=Object.entries(r).reduce((s,h)=>r[s[0]]>r[h[0]]?s:h)[0],c=Math.max(...Object.values(r));return{dominant:C,confidence:c,emotions:r}},[]),je=n.useCallback((g,w)=>{const x=w.data;let I=0,B=0,H=0;const J=Math.floor(w.height*.6);for(let c=Math.floor(w.height*.3);c<J;c++)for(let s=0;s<w.width;s+=4){const h=(c*w.width+s)*4,M=x[h],E=x[h+1],T=x[h+2];(M+E+T)/3<100?I++:B++,(Math.abs(M-E)>30||Math.abs(E-T)>30)&&H++}const e=I+B,t=e?I/e:0,r=e?H/e:0,l=t>.4&&r<.3,C=t>.2;return{isProfessional:l,hasShirt:C,confidence:.7,details:l?"Professional attire detected":"Casual attire detected"}},[]),Pe=n.useCallback((g,w,x)=>{const I=g.x+g.width/2,B=g.y+g.height/2,H=(I-w/2)/w,J=(B-x/2)/x,e=Math.sqrt(H*H+J*J),t=e<.15,r=Math.max(0,1-e*2);return{isLookingAtCamera:t,gazeDirection:{x:H,y:J},confidence:.8,attentionScore:r}},[]),le=n.useCallback(g=>{const{gazeDirection:w,attentionScore:x,isLookingAtCamera:I}=g,B=Math.sqrt(w.x*w.x+w.y*w.y);return!I&&B>.5&&x<.3},[]),Ie=n.useCallback(async()=>{try{const g=await Promise.resolve().then(()=>require("./index-x7BUnCGZ.cjs")),w=await Promise.resolve().then(()=>require("./blazeface.esm-BsJ4BrW4.cjs"));g.ready&&await g.ready();const x=await w.load();return Me.current=x,!0}catch(g){return console.error("[widget] Failed to init face detection:",g),!1}},[]),ve=n.useCallback(async()=>{if(!ce.current||!Ce.current||!Me.current){ue.current=requestAnimationFrame(ve);return}const g=ce.current,w=Ce.current;if(g.readyState!==4){ue.current=requestAnimationFrame(ve);return}try{const x=await Me.current.estimateFaces(g,!1),I=g.videoWidth||g.width||w.width,B=g.videoHeight||g.height||w.height,H=Math.max(6,Math.floor(I*.06)),J=Math.max(6,Math.floor(B*.06)),e=.04,t=.65,r=x.map(c=>{const[s,h]=c.topLeft,[M,E]=c.bottomRight;return{x:s,y:h,width:M-s,height:E-h,confidence:c.probability?.[0]||.8}}).filter(c=>{if(c.width<=0||c.height<=0||c.x<H||c.y<J||c.x+c.width>I-H||c.y+c.height>B-J)return!1;const h=c.width*c.height/(I*B);if(h<e||h>t)return!1;const M=c.width/c.height;return!(M<.6||M>1.6)});W(r.length),Ee(r),Y(r.length===1),He(r.length>0);const l=Date.now();let C=r.length===0?"none":r.length===1?"single":"multiple";if(C==="multiple")ye.current!=="multiple"&&(k(l),nt(c=>c+1),ne.current.multipleFaces||(ne.current.multipleFaces=!0,b?.({eventType:"face_detection",severity:"warning",context:"coding",data:{reason:"multiple_faces",count:r.length},timestamp:l})));else{if(ye.current==="multiple"&&P!==null){const c=l-P;Te(s=>s+c),k(null)}ne.current.multipleFaces=!1}if(C==="none")ye.current!=="none"&&(ge(l),$e(c=>c+1),ne.current.noFace||(ne.current.noFace=!0,b?.({eventType:"face_detection",severity:"critical",context:"coding",data:{reason:"no_face"},timestamp:l})));else{if(ye.current==="none"&&xe!==null){const c=l-xe;rt(s=>s+c),ge(null)}ne.current.noFace=!1}if(ye.current=C,r.length===1){const c=r[0],s=w.getContext("2d");if(s){s.drawImage(g,0,0,w.width,w.height);const h=s.getImageData(0,0,w.width,w.height),M=s.getImageData(c.x,c.y,c.width,c.height),E={isGoodPosture:Math.abs(Math.random()*20-10)<5,shoulderAlignment:Math.random()*20-10,headTilt:Math.random()*15-7.5,confidence:.75},T=Je(M,c),q=je(M,h),re=Pe(c,w.width,w.height);X(E),A(T),Q(q),he(re);const ae=le(re);if(ae&&!d&&Date.now()-Oe.current>3e3)a(se=>se+1),m(!0),te(l),Oe.current=Date.now(),ne.current.gazeOff||(ne.current.gazeOff=!0,b?.({eventType:"gaze_tracking",severity:"warning",context:"coding",data:{offscreen:!0},timestamp:l}));else if(!ae&&d){if(V!==null){const se=l-V;Ae(de=>de+se),te(null)}m(!1),ne.current.gazeOff=!1}const $=r.length===0||r.length>1;if(y&&($||l-Ve.current>=5e3)){const se=f?.snapshots||[];let de=se;if($){const it={timestamp:l,type:"violation_trigger",image:"base64_image_placeholder",context:r.length===0?"No face detected":"Multiple faces detected"};de=[...se,it],de.length>30&&(de=de.slice(-30))}y({snapshots:de,postureAnalysis:E,attireAnalysis:q}),Ve.current=l}}}else if(X(null),A(null),Q(null),he(null),d){if(V!==null){const c=l-V;Ae(s=>s+c),te(null)}m(!1)}r.length===0?i?.("violation"):r.length>1?i?.("warning"):i?.("optimal")}catch(x){console.error("[widget] Face detection error:",x)}ue.current=requestAnimationFrame(ve)},[Je,je,Pe,le,i,y,f?.snapshots,d,P,V,He]);n.useEffect(()=>{F(0)},[]),n.useEffect(()=>((async()=>{try{const w=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:320},height:{ideal:240},frameRate:{ideal:15}},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});ce.current&&(ce.current.srcObject=w);let x=null;const I=w.getAudioTracks();I.length>0&&(x=new MediaStream(I),Re.current=x),await Ie(),x&&await ot(x),ue.current=requestAnimationFrame(ve)}catch{i?.("violation")}})(),()=>{Ue.current=!0,ue.current&&cancelAnimationFrame(ue.current),ce.current?.srcObject&&ce.current.srcObject.getTracks().forEach(x=>x.stop()),Re.current&&Re.current.getTracks().forEach(w=>w.stop()),at(),Re.current=null}),[]);const Xe=g=>{v(!0);const w=Ye.current?.getBoundingClientRect();w&&p({x:g.clientX-w.left,y:g.clientY-w.top})},Ze=g=>{if(R){const w=Math.max(0,Math.min((typeof window<"u"?window.innerWidth:0)-280,g.clientX-L.x)),x=Math.max(0,Math.min((typeof window<"u"?window.innerHeight:0)-400,g.clientY-L.y));j({x:w,y:x})}},ze=()=>v(!1);n.useEffect(()=>{if(R)return document.addEventListener("mousemove",Ze),document.addEventListener("mouseup",ze),()=>{document.removeEventListener("mousemove",Ze),document.removeEventListener("mouseup",ze)}},[R,L]);const Qe=()=>{document.hidden&&we(g=>{const w=g+1;return b?.({eventType:"tab_switch",severity:"critical",context:"coding",data:{when:Date.now()},timestamp:Date.now()}),w})},Le=()=>ee(g=>g+1),We=g=>{ke(w=>w+1),b?.({eventType:"keystroke",severity:"info",context:"coding",data:{},timestamp:Date.now()}),(g.ctrlKey||g.metaKey)&&(g.key==="c"||g.key==="x"||g.key==="v")&&(_e(w=>w+1),g.preventDefault(),b?.({eventType:"keystroke",severity:"warning",context:"coding",data:{copyCutPaste:!0,key:g.key},timestamp:Date.now()}))};n.useEffect(()=>(document.addEventListener("visibilitychange",Qe),window.addEventListener("blur",Le),document.addEventListener("keydown",We),()=>{document.removeEventListener("visibilitychange",Qe),window.removeEventListener("blur",Le),document.removeEventListener("keydown",We)}),[]);const st=S===0?"#ef4444":S>1?"#f59e0b":"#22c55e";return u.jsxs("div",{ref:Ye,onMouseDown:Xe,style:{position:"fixed",left:_.x,top:_.y,zIndex:9999,width:288,cursor:"move",border:`2px solid ${st}`,borderRadius:8,background:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.2)",padding:12,userSelect:"none"},children:[u.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:u.jsx("div",{style:{fontSize:12,fontWeight:600},children:S===0?"No Face":S>1?"Multiple Faces":z?"Optimal":"Good"})}),u.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:4,overflow:"hidden"},children:[u.jsx("video",{ref:ce,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:128,objectFit:"cover"}}),u.jsx("canvas",{ref:Ce,width:320,height:240,style:{display:"none"}})]}),u.jsxs("div",{style:{marginTop:8,fontSize:12,display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[u.jsxs("div",{children:["Faces: ",u.jsx("strong",{style:{color:S===1?"#16a34a":"#ef4444"},children:S})]}),u.jsxs("div",{children:["No Face: ",u.jsx("strong",{style:{color:De>0?"#ef4444":"#16a34a"},children:De})]}),u.jsxs("div",{children:["Multiple: ",u.jsx("strong",{style:{color:Be>0?"#ef4444":"#16a34a"},children:Be})]}),u.jsxs("div",{children:["Eye Contact: ",u.jsx("strong",{style:{color:fe?.isLookingAtCamera?"#16a34a":"#ef4444"},children:fe?.isLookingAtCamera?"Yes":"No"})]}),u.jsxs("div",{children:["Posture: ",u.jsx("strong",{style:{color:U?.isGoodPosture?"#16a34a":"#f59e0b"},children:U?.isGoodPosture?"Good":"Poor"})]}),u.jsxs("div",{children:["Attire: ",u.jsx("strong",{style:{color:G?.isProfessional?"#16a34a":"#f59e0b"},children:G?.isProfessional?"Professional":"Casual"})]}),u.jsxs("div",{children:["Emotion: ",u.jsx("strong",{style:{color:"#3b82f6"},children:N?.dominant||"Unknown"})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:["Audio: ",u.jsxs("span",{style:{color:D>50?"#16a34a":D>20?"#f59e0b":"#ef4444"},children:[D,"%"]}),u.jsx("div",{style:{width:64,height:6,background:"#eee",borderRadius:9999,overflow:"hidden"},children:u.jsx("div",{style:{width:`${Math.min(D,100)}%`,height:6,transition:"width 100ms",background:D>50?"#16a34a":D>20?"#f59e0b":"#ef4444"}})})]}),u.jsxs("div",{children:["Audio Alerts: ",u.jsx("strong",{style:{color:K>0?"#ef4444":"#16a34a"},children:K})]}),u.jsxs("div",{children:["Unfocus: ",u.jsx("strong",{style:{color:Z>0?"#ef4444":"#16a34a"},children:Z})]}),u.jsxs("div",{children:["Tab Switch: ",u.jsx("strong",{style:{color:oe>0?"#ef4444":"#16a34a"},children:oe})]}),u.jsxs("div",{children:["Keystrokes: ",u.jsx("strong",{style:{color:"#3b82f6"},children:be})]}),u.jsxs("div",{children:["Copy Attempts: ",u.jsx("strong",{style:{color:Se>0?"#ef4444":"#16a34a"},children:Se})]}),u.jsxs("div",{children:["Gaze Off: ",u.jsx("strong",{style:{color:pe>0?"#ef4444":"#16a34a"},children:pe})]})]})]})}const tt=(o,f)=>o.length>f?o.slice(o.length-f):o,St=(o,f)=>({sessionId:o,sessionType:"coding-assessment",startTime:Date.now(),preCheckResults:f,liveEvents:[],codingMetrics:{totalKeystrokes:0,linesOfCode:0,codeExecutions:0,externalCopyEvents:0,languageSwitches:0,averageTypingSpeed:0,codingTimeVsReadingTime:{coding:0,reading:0}},questionProgress:[],snapshots:[],sessionStats:{totalDuration:0,questionsAttempted:0,violationCount:0,tabSwitches:0,audioAnomalies:0,gazeDuration:0,focusBreaks:0,codeExecutionCount:0,noFaceIncidents:0,multipleFaceIncidents:0,unfocusEvents:0,gazeOffScreenIncidents:0,keystrokes:0,copyCutPasteAttempts:0}});function xt(o,f){switch(f.eventType){case"tab_switch":return{...o,tabSwitches:o.tabSwitches+1,violationCount:o.violationCount+1};case"audio_anomaly":return{...o,audioAnomalies:o.audioAnomalies+1,violationCount:o.violationCount+1};case"code_execution":return{...o,codeExecutionCount:o.codeExecutionCount+1};case"face_detection":{const i=f.data?.reason;return i==="no_face"?{...o,noFaceIncidents:o.noFaceIncidents+1,violationCount:o.violationCount+1}:i==="multiple_faces"?{...o,multipleFaceIncidents:o.multipleFaceIncidents+1,violationCount:o.violationCount+1}:o}case"gaze_tracking":{const i=f.data?.type==="focus_break",y=Number(f.data?.focusTimeMs)||0,b=f.data?.offscreen===!0;return{...o,focusBreaks:o.focusBreaks+(i?1:0),gazeDuration:o.gazeDuration+y,unfocusEvents:o.unfocusEvents+(i?1:0),gazeOffScreenIncidents:o.gazeOffScreenIncidents+(b?1:0),violationCount:o.violationCount+(i||b?1:0)}}case"keystroke":{const i=f.data?.copyCutPaste===!0;return{...o,keystrokes:o.keystrokes+1,copyCutPasteAttempts:o.copyCutPasteAttempts+(i?1:0),violationCount:o.violationCount+(i?1:0)}}default:return o}}function Ct(o,f){switch(f.type){case"INIT":return{...f.payload};case"SET_FIELDS":{const i={...o,...f.payload};return i.snapshots&&(i.snapshots=tt(i.snapshots,50)),i.liveEvents&&(i.liveEvents=tt(i.liveEvents,200)),i}case"ADD_EVENTS":{const i=tt([...o.liveEvents,...f.events],200),y=f.events.reduce(xt,o.sessionStats);return{...o,liveEvents:i,sessionStats:y}}case"ADD_SNAPSHOT":{const i=tt([...o.snapshots,f.snapshot],50);return{...o,snapshots:i}}case"TICK":{const i=Math.max(0,f.now-o.startTime);return i===o.sessionStats.totalDuration?o:{...o,sessionStats:{...o.sessionStats,totalDuration:i}}}case"COMPLETE":{const i=f.endTime??Date.now();return{...o,sessionStats:{...o.sessionStats,totalDuration:Math.max(0,i-o.startTime)}}}default:return o}}function Rt(o){const[f,i]=n.useState(null),y=n.useCallback(p=>{i(S=>S&&Ct(S,p))},[]),b=n.useRef(null),_=n.useRef(0),j=n.useRef(null),R=n.useCallback(p=>{const S=`session_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;b.current=S;const W=sessionStorage.getItem(S);if(W)try{const Y=JSON.parse(W);return i(Y),S}catch{}const z=St(S,p);return i(z),sessionStorage.setItem(S,JSON.stringify(z)),S},[o?.sessionId]),v=n.useCallback(p=>{const S=p??f;if(!(!S||!b.current))try{sessionStorage.setItem(b.current,JSON.stringify(S)),_.current=Date.now()}catch(W){console.error("[session] persist failed",W)}},[f]);return n.useEffect(()=>{if(!f)return;const S=Date.now()-_.current;return S<1e3?(j.current&&clearTimeout(j.current),j.current=setTimeout(()=>v(),1e3-S)):v(),()=>{j.current&&clearTimeout(j.current)}},[f,v]),n.useEffect(()=>{const p=()=>v();return window.addEventListener("visibilitychange",p),window.addEventListener("beforeunload",p),()=>{window.removeEventListener("visibilitychange",p),window.removeEventListener("beforeunload",p)}},[v]),n.useEffect(()=>{if(!f)return;const p=setInterval(()=>y({type:"TICK",now:Date.now()}),1e3);return()=>clearInterval(p)},[f,y]),n.useMemo(()=>({state:f,sessionId:b.current,init:R,setFields:p=>y({type:"SET_FIELDS",payload:p}),addEvents:p=>y({type:"ADD_EVENTS",events:p}),addSnapshot:p=>y({type:"ADD_SNAPSHOT",snapshot:p}),complete:()=>y({type:"COMPLETE"})}),[f,y,R])}function Et({onSessionStart:o,onSessionUpdate:f,onEvent:i}){const[y,b]=n.useState(null),[_,j]=n.useState("optimal"),R=Rt();return n.useEffect(()=>{if(y&&!R.state){const v=R.init(y);o?.(v,y)}},[y,R]),y?u.jsx(pt,{monitoringStatus:_,sessionData:R.state??void 0,onStatusChange:v=>j(v),onUpdateSession:v=>{R.setFields(v),f?.(v)},onAddEvent:v=>{R.addEvents([{...v,timestamp:v.timestamp??Date.now()}]),i?.(v)}}):u.jsx(mt,{onComplete:v=>b(v),onError:()=>b(null)})}exports.FloatingVideo=pt;exports.Prechecks=mt;exports.ProctoringWidget=Et;
