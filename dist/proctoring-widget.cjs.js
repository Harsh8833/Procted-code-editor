"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("react");var Ht={exports:{}},St={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zt;function sn(){if(Zt)return St;Zt=1;var r=t,f=Symbol.for("react.element"),i=Symbol.for("react.fragment"),y=Object.prototype.hasOwnProperty,p=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,k={key:!0,ref:!0,__self:!0,__source:!0};function j(F,v,A){var g,C={},P=null,Y=null;A!==void 0&&(P=""+A),v.key!==void 0&&(P=""+v.key),v.ref!==void 0&&(Y=v.ref);for(g in v)y.call(v,g)&&!k.hasOwnProperty(g)&&(C[g]=v[g]);if(F&&F.defaultProps)for(g in v=F.defaultProps,v)C[g]===void 0&&(C[g]=v[g]);return{$$typeof:f,type:F,key:P,ref:Y,props:C,_owner:p.current}}return St.Fragment=i,St.jsx=j,St.jsxs=j,St}var Rt={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qt;function cn(){return Qt||(Qt=1,process.env.NODE_ENV!=="production"&&function(){var r=t,f=Symbol.for("react.element"),i=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),p=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),j=Symbol.for("react.provider"),F=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),g=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),Y=Symbol.for("react.offscreen"),se=Symbol.iterator,fe="@@iterator";function ie(e){if(e===null||typeof e!="object")return null;var n=se&&e[se]||e[fe];return typeof n=="function"?n:null}var q=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function W(e){{for(var n=arguments.length,l=new Array(n>1?n-1:0),S=1;S<n;S++)l[S-1]=arguments[S];ke("error",e,l)}}function ke(e,n,l){{var S=q.ReactDebugCurrentFrame,D=S.getStackAddendum();D!==""&&(n+="%s",l=l.concat([D]));var I=l.map(function(_){return String(_)});I.unshift("Warning: "+n),Function.prototype.apply.call(console[e],console,I)}}var xe=!1,Le=!1,de=!1,U=!1,M=!1,ce;ce=Symbol.for("react.module.reference");function he(e){return!!(typeof e=="string"||typeof e=="function"||e===y||e===k||M||e===p||e===A||e===g||U||e===Y||xe||Le||de||typeof e=="object"&&e!==null&&(e.$$typeof===P||e.$$typeof===C||e.$$typeof===j||e.$$typeof===F||e.$$typeof===v||e.$$typeof===ce||e.getModuleId!==void 0))}function Te(e,n,l){var S=e.displayName;if(S)return S;var D=n.displayName||n.name||"";return D!==""?l+"("+D+")":l}function Ve(e){return e.displayName||"Context"}function me(e){if(e==null)return null;if(typeof e.tag=="number"&&W("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case y:return"Fragment";case i:return"Portal";case k:return"Profiler";case p:return"StrictMode";case A:return"Suspense";case g:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case F:var n=e;return Ve(n)+".Consumer";case j:var l=e;return Ve(l._context)+".Provider";case v:return Te(e,e.render,"ForwardRef");case C:var S=e.displayName||null;return S!==null?S:me(e.type)||"Memo";case P:{var D=e,I=D._payload,_=D._init;try{return me(_(I))}catch{return null}}}return null}var ue=Object.assign,Se=0,ot,at,He,Ke,a,h,w;function B(){}B.__reactDisabledLog=!0;function N(){{if(Se===0){ot=console.log,at=console.info,He=console.warn,Ke=console.error,a=console.group,h=console.groupCollapsed,w=console.groupEnd;var e={configurable:!0,enumerable:!0,value:B,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}Se++}}function Ne(){{if(Se--,Se===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:ue({},e,{value:ot}),info:ue({},e,{value:at}),warn:ue({},e,{value:He}),error:ue({},e,{value:Ke}),group:ue({},e,{value:a}),groupCollapsed:ue({},e,{value:h}),groupEnd:ue({},e,{value:w})})}Se<0&&W("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Re=q.ReactCurrentDispatcher,pe;function dt(e,n,l){{if(pe===void 0)try{throw Error()}catch(D){var S=D.stack.trim().match(/\n( *(at )?)/);pe=S&&S[1]||""}return`
`+pe+e}}var ht=!1,mt;{var Et=typeof WeakMap=="function"?WeakMap:Map;mt=new Et}function pt(e,n){if(!e||ht)return"";{var l=mt.get(e);if(l!==void 0)return l}var S;ht=!0;var D=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var I;I=Re.current,Re.current=null,N();try{if(n){var _=function(){throw Error()};if(Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(R){S=R}Reflect.construct(e,[],_)}else{try{_.call()}catch(R){S=R}e.call(_.prototype)}}else{try{throw Error()}catch(R){S=R}e()}}catch(R){if(R&&S&&typeof R.stack=="string"){for(var T=R.stack.split(`
`),o=S.stack.split(`
`),s=T.length-1,c=o.length-1;s>=1&&c>=0&&T[s]!==o[c];)c--;for(;s>=1&&c>=0;s--,c--)if(T[s]!==o[c]){if(s!==1||c!==1)do if(s--,c--,c<0||T[s]!==o[c]){var u=`
`+T[s].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),typeof e=="function"&&mt.set(e,u),u}while(s>=1&&c>=0);break}}}finally{ht=!1,Re.current=I,Ne(),Error.prepareStackTrace=D}var x=e?e.displayName||e.name:"",b=x?dt(x):"";return typeof e=="function"&&mt.set(e,b),b}function Nt(e,n,l){return pt(e,!1)}function Ct(e){var n=e.prototype;return!!(n&&n.isReactComponent)}function Je(e,n,l){if(e==null)return"";if(typeof e=="function")return pt(e,Ct(e));if(typeof e=="string")return dt(e);switch(e){case A:return dt("Suspense");case g:return dt("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case v:return Nt(e.render);case C:return Je(e.type,n,l);case P:{var S=e,D=S._payload,I=S._init;try{return Je(I(D),n,l)}catch{}}}return""}var We=Object.prototype.hasOwnProperty,Mt={},Wt=q.ReactDebugCurrentFrame;function st(e){if(e){var n=e._owner,l=Je(e.type,e._source,n?n.type:null);Wt.setExtraStackFrame(l)}else Wt.setExtraStackFrame(null)}function Ee(e,n,l,S,D){{var I=Function.call.bind(We);for(var _ in e)if(I(e,_)){var T=void 0;try{if(typeof e[_]!="function"){var o=Error((S||"React class")+": "+l+" type `"+_+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[_]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw o.name="Invariant Violation",o}T=e[_](n,_,S,l,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(s){T=s}T&&!(T instanceof Error)&&(st(D),W("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",S||"React class",l,_,typeof T),st(null)),T instanceof Error&&!(T.message in Mt)&&(Mt[T.message]=!0,st(D),W("Failed %s type: %s",l,T.message),st(null))}}}var it=Array.isArray;function ct(e){return it(e)}function gt(e){{var n=typeof Symbol=="function"&&Symbol.toStringTag,l=n&&e[Symbol.toStringTag]||e.constructor.name||"Object";return l}}function Be(e){try{return Xe(e),!1}catch{return!0}}function Xe(e){return""+e}function kt(e){if(Be(e))return W("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",gt(e)),Xe(e)}var yt=q.ReactCurrentOwner,Tt={key:!0,ref:!0,__self:!0,__source:!0},Ce,le;function we(e){if(We.call(e,"ref")){var n=Object.getOwnPropertyDescriptor(e,"ref").get;if(n&&n.isReactWarning)return!1}return e.ref!==void 0}function vt(e){if(We.call(e,"key")){var n=Object.getOwnPropertyDescriptor(e,"key").get;if(n&&n.isReactWarning)return!1}return e.key!==void 0}function _t(e,n){typeof e.ref=="string"&&yt.current}function Ft(e,n){{var l=function(){Ce||(Ce=!0,W("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};l.isReactWarning=!0,Object.defineProperty(e,"key",{get:l,configurable:!0})}}function ut(e,n){{var l=function(){le||(le=!0,W("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};l.isReactWarning=!0,Object.defineProperty(e,"ref",{get:l,configurable:!0})}}var wt=function(e,n,l,S,D,I,_){var T={$$typeof:f,type:e,key:n,ref:l,props:_,_owner:I};return T._store={},Object.defineProperty(T._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(T,"_self",{configurable:!1,enumerable:!1,writable:!1,value:S}),Object.defineProperty(T,"_source",{configurable:!1,enumerable:!1,writable:!1,value:D}),Object.freeze&&(Object.freeze(T.props),Object.freeze(T)),T};function lt(e,n,l,S,D){{var I,_={},T=null,o=null;l!==void 0&&(kt(l),T=""+l),vt(n)&&(kt(n.key),T=""+n.key),we(n)&&(o=n.ref,_t(n,D));for(I in n)We.call(n,I)&&!Tt.hasOwnProperty(I)&&(_[I]=n[I]);if(e&&e.defaultProps){var s=e.defaultProps;for(I in s)_[I]===void 0&&(_[I]=s[I])}if(T||o){var c=typeof e=="function"?e.displayName||e.name||"Unknown":e;T&&Ft(_,c),o&&ut(_,c)}return wt(e,T,o,D,S,yt.current,_)}}var ae=q.ReactCurrentOwner,ee=q.ReactDebugCurrentFrame;function _e(e){if(e){var n=e._owner,l=Je(e.type,e._source,n?n.type:null);ee.setExtraStackFrame(l)}else ee.setExtraStackFrame(null)}var Me;Me=!1;function ft(e){return typeof e=="object"&&e!==null&&e.$$typeof===f}function bt(){{if(ae.current){var e=me(ae.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function Bt(e){return""}var jt={};function Dt(e){{var n=bt();if(!n){var l=typeof e=="string"?e:e.displayName||e.name;l&&(n=`

Check the top-level render call using <`+l+">.")}return n}}function Ze(e,n){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var l=Dt(n);if(jt[l])return;jt[l]=!0;var S="";e&&e._owner&&e._owner!==ae.current&&(S=" It was passed a child from "+me(e._owner.type)+"."),_e(e),W('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',l,S),_e(null)}}function xt(e,n){{if(typeof e!="object")return;if(ct(e))for(var l=0;l<e.length;l++){var S=e[l];ft(S)&&Ze(S,n)}else if(ft(e))e._store&&(e._store.validated=!0);else if(e){var D=ie(e);if(typeof D=="function"&&D!==e.entries)for(var I=D.call(e),_;!(_=I.next()).done;)ft(_.value)&&Ze(_.value,n)}}}function At(e){{var n=e.type;if(n==null||typeof n=="string")return;var l;if(typeof n=="function")l=n.propTypes;else if(typeof n=="object"&&(n.$$typeof===v||n.$$typeof===C))l=n.propTypes;else return;if(l){var S=me(n);Ee(l,e.props,"prop",S,e)}else if(n.PropTypes!==void 0&&!Me){Me=!0;var D=me(n);W("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",D||"Unknown")}typeof n.getDefaultProps=="function"&&!n.getDefaultProps.isReactClassApproved&&W("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Ot(e){{for(var n=Object.keys(e.props),l=0;l<n.length;l++){var S=n[l];if(S!=="children"&&S!=="key"){_e(e),W("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",S),_e(null);break}}e.ref!==null&&(_e(e),W("Invalid attribute `ref` supplied to `React.Fragment`."),_e(null))}}var Fe={};function je(e,n,l,S,D,I){{var _=he(e);if(!_){var T="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(T+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var o=Bt();o?T+=o:T+=bt();var s;e===null?s="null":ct(e)?s="array":e!==void 0&&e.$$typeof===f?(s="<"+(me(e.type)||"Unknown")+" />",T=" Did you accidentally export a JSX literal instead of a component?"):s=typeof e,W("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",s,T)}var c=lt(e,n,l,D,I);if(c==null)return c;if(_){var u=n.children;if(u!==void 0)if(S)if(ct(u)){for(var x=0;x<u.length;x++)xt(u[x],e);Object.freeze&&Object.freeze(u)}else W("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else xt(u,e)}if(We.call(n,"key")){var b=me(e),R=Object.keys(n).filter(function(J){return J!=="key"}),z=R.length>0?"{key: someKey, "+R.join(": ..., ")+": ...}":"{key: someKey}";if(!Fe[b+z]){var H=R.length>0?"{"+R.join(": ..., ")+": ...}":"{}";W(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,z,b,H,b),Fe[b+z]=!0}}return e===y?Ot(c):At(c),c}}function qt(e,n,l){return je(e,n,l,!0)}function Pt(e,n,l){return je(e,n,l,!1)}var Gt=Pt,Yt=qt;Rt.Fragment=y,Rt.jsx=Gt,Rt.jsxs=Yt}()),Rt}process.env.NODE_ENV==="production"?Ht.exports=sn():Ht.exports=cn();var d=Ht.exports;function tn(r){const f=window.AudioContext||window.webkitAudioContext,i=new f,y=i.createMediaStreamSource(r),p=i.createAnalyser();p.fftSize=2048,p.smoothingTimeConstant=.85,y.connect(p);const k=new Uint8Array(p.fftSize);function j(){p.getByteTimeDomainData(k);let F=0;for(let v=0;v<k.length;v++){const A=(k[v]-128)/128;F+=A*A}return Math.sqrt(F/k.length)}return{getLevel:()=>j(),dispose:async()=>{try{y.disconnect()}catch{}try{p.disconnect()}catch{}try{await i.close()}catch{}}}}let zt=null;async function un(){if(zt)return zt;const r=await Promise.resolve().then(()=>require("./blazeface.esm-BsJ4BrW4.cjs")),f=await Promise.resolve().then(()=>require("./index-x7BUnCGZ.cjs"));return f.ready&&await f.ready(),zt=await r.load(),zt}function en(r,f,i){if(r.width<=0||r.height<=0||f<=0||i<=0)return!1;const y=Math.max(6,Math.floor(f*.06)),p=Math.max(6,Math.floor(i*.06));if(r.x<y||r.y<p||r.x+r.width>f-y||r.y+r.height>i-p)return!1;const k=r.width*r.height,j=f*i,F=k/j;if(F<.04||F>.65)return!1;const v=r.width/r.height;return!(v<.6||v>1.6)}async function ln(r){if("FaceDetector"in window)try{const i=await new window.FaceDetector({fastMode:!0,maxDetectedFaces:1}).detect(r);if(i&&i.length>0){const y=i[0]?.boundingBox,p=r.videoWidth||r.width||0,k=r.videoHeight||r.height||0;if(y){const j={x:y.x,y:y.y,width:y.width,height:y.height};if(en(j,p,k))return{present:!0,confidence:.85}}}return{present:!1,confidence:0}}catch{}try{const i=await(await un()).estimateFaces(r,!1);if(i&&i.length>0){const y=r.videoWidth||r.width||0,p=r.videoHeight||r.height||0;for(const k of i){const[j,F]=k.topLeft,[v,A]=k.bottomRight,g={x:j,y:F,width:v-j,height:A-F};if(en(g,y,p)){const C=k.probability?k.probability[0]:.75;return{present:!0,confidence:Math.max(.6,Math.min(1,C))}}}}}catch{}return{present:!1,confidence:0}}function nn({onComplete:r,onError:f}){const i=["camera","microphone","face","monitor","browser"],[y,p]=t.useState({camera:"pending",microphone:"pending",face:"pending",monitor:"pending",browser:"pending"}),[k,j]=t.useState(0),[F,v]=t.useState(0),[A,g]=t.useState({}),[C,P]=t.useState({}),Y=t.useRef(null),se=t.useRef(null),fe=t.useRef(null),ie=t.useRef(null),q=t.useRef(null),W=()=>{try{Y.current?.getTracks().forEach(a=>a.stop())}catch{}try{se.current?.getTracks().forEach(a=>a.stop())}catch{}Y.current=null,se.current=null,fe.current&&(fe.current.dispose().catch(()=>{}),fe.current=null),ie.current&&(cancelAnimationFrame(ie.current),ie.current=null)},ke=async a=>{try{const h=window.AudioContext||window.webkitAudioContext;if(!h)throw new Error("AudioContext not supported");const w=new h,B=w.createMediaStreamSource(a),N=w.createAnalyser();N.fftSize=256,N.smoothingTimeConstant=.8,B.connect(N);const Ne=new Uint8Array(N.frequencyBinCount);N.getByteFrequencyData(Ne),sessionStorage.setItem("audio-context-initialized","true"),B.disconnect(),await w.close(),typeof window<"u"&&(window.precheckAudioStream=a)}catch{sessionStorage.setItem("audio-context-initialized","false")}},xe=async a=>{const h=q.current;let w=0,B=0,N=0;const Ne=30;for(;N<Ne&&w<5;){try{const pe=await ln(h);pe.present&&(w+=1,B=Math.max(B,pe.confidence))}catch{}N++,j(N),await new Promise(pe=>setTimeout(pe,100))}return{status:w>=5,confidence:B,timestamp:Date.now()}},Le=()=>{try{const a=window.screen.width,h=window.screen.height,w=window.screen.availWidth;return a/h>3||a>w*1.5||[3840,3360,2560,4480,5120].includes(a)?2:1}catch{return 1}},de=async()=>Le(),U=()=>["navigator.mediaDevices","navigator.mediaDevices.getUserMedia","requestAnimationFrame","WebAssembly"].every(h=>{const w=h.split(".");let B=window;for(const N of w){if(!(N in B))return!1;B=B[N]}return!0}),M=(a,h)=>{p(w=>({...w,[a]:h}))},ce=t.useCallback(async()=>{M("camera","running"),g(a=>({...a,camera:""}));try{try{Y.current?.getTracks().forEach(h=>h.stop())}catch{}const a=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:15}}});if(Y.current=a,!q.current){const h=document.createElement("video");h.muted=!0,h.playsInline=!0,q.current=h}q.current.srcObject=a;try{await q.current.play()}catch{}return P(h=>({...h,cameraAccess:!0})),M("camera","passed"),!0}catch(a){const h=a?.name==="NotAllowedError"?"Camera permission denied":a?.message||"Camera access failed";return g(w=>({...w,camera:h})),M("camera","failed"),!1}},[]),he=t.useCallback(async()=>{M("microphone","running"),g(a=>({...a,microphone:""}));try{try{se.current?.getTracks().forEach(h=>h.stop())}catch{}const a=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});se.current=a,P(h=>({...h,microphoneAccess:!0})),await ke(a);try{const h=tn(a);fe.current=h;const w=()=>{v(h.getLevel()),ie.current=requestAnimationFrame(w)};ie.current=requestAnimationFrame(w)}catch{}return M("microphone","passed"),!0}catch(a){const h=a?.name==="NotAllowedError"?"Microphone permission denied":a?.message||"Microphone access failed";return g(w=>({...w,microphone:h})),M("microphone","failed"),!1}},[]),Te=t.useCallback(async()=>{M("face","running"),g(a=>({...a,face:""}));try{if(!Y.current)throw new Error("Camera is not initialized");const a=await xe(Y.current);if(P(h=>({...h,faceDetection:a})),a.status)return M("face","passed"),!0;throw new Error("No face detected. Please align your face within the frame and retry.")}catch(a){const h=a?.message||"Face detection failed";return g(w=>({...w,face:h})),M("face","failed"),!1}},[]),Ve=t.useCallback(async()=>{M("monitor","running"),g(a=>({...a,monitor:""}));try{const a=await de();if(a&&a>1)throw P(h=>({...h,monitorCount:a})),new Error("Multiple displays detected. Please remove external screens and keep only one display connected, then press Retry.");if(a===1)return P(h=>({...h,monitorCount:a})),M("monitor","passed"),!0;throw new Error("Could not verify displays")}catch(a){return g(h=>({...h,monitor:a?.message||"Monitor verification failed"})),M("monitor","failed"),!1}},[]),me=t.useCallback(async()=>{M("browser","running"),g(a=>({...a,browser:""}));try{const a=U();if(P(h=>({...h,browserSupport:a})),!a)throw new Error("Required browser features are unavailable");return M("browser","passed"),!0}catch(a){return g(h=>({...h,browser:a?.message||"Browser not supported"})),M("browser","failed"),!1}},[]),ue={camera:ce,microphone:he,face:Te,monitor:Ve,browser:me},Se=t.useCallback(async a=>{for(let h=a;h<i.length;h++){const w=i[h];if(!await ue[w]())break}},[ue]);t.useEffect(()=>{if(!i.every(w=>y[w]==="passed"))return;const h={cameraAccess:!!C.cameraAccess,microphoneAccess:!!C.microphoneAccess,faceDetection:C.faceDetection||{status:!1,confidence:0,timestamp:Date.now()},monitorCount:C.monitorCount||1,browserSupport:!!C.browserSupport,codeEditorReady:!0};r(h),W()},[y,C]),t.useEffect(()=>(Se(0),()=>W()),[]);const ot=a=>{const h=i.indexOf(a);p(w=>{const B={...w};for(let N=h;N<i.length;N++)B[i[N]]="pending";return B}),g(w=>({...w,[a]:""})),Se(h)},at=i.filter(a=>y[a]==="passed").length,He=i.some(a=>y[a]==="running"),Ke=Math.round((at+(He?.5:0))/i.length*100);return d.jsx("div",{style:{fontFamily:"system-ui, sans-serif",minHeight:"100vh",display:"grid",placeItems:"center",background:"linear-gradient(135deg,#eff6ff,#eef2ff)"},children:d.jsxs("div",{style:{width:720,maxWidth:"95vw",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16,boxShadow:"0 8px 24px rgba(0,0,0,0.08)"},children:[d.jsxs("div",{style:{textAlign:"center",marginBottom:12},children:[d.jsx("h2",{style:{margin:0,fontSize:20,fontWeight:700},children:"System Pre-Check"}),d.jsx("p",{style:{color:"#6b7280"},children:"Verifying your system for proctored assessment"})]}),d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12},children:[d.jsx("span",{children:"Overall Progress"}),d.jsxs("span",{children:[Ke,"%"]})]}),d.jsx("div",{style:{height:8,background:"#f3f4f6",borderRadius:9999,overflow:"hidden"},children:d.jsx("div",{style:{width:`${Ke}%`,height:8,background:"#3b82f6"}})})]}),d.jsx("div",{style:{display:"grid",gap:8},children:i.map(a=>{const h=a==="camera"?"Camera Access":a==="microphone"?"Microphone Access":a==="face"?"Face Detection":a==="monitor"?"Single Monitor Check":"Browser Support",w=y[a],B=w==="passed"?"#ecfdf5":w==="running"?"#eff6ff":w==="failed"?"#fef2f2":"#f9fafb",N=w==="passed"?"#10b981":w==="running"?"#3b82f6":w==="failed"?"#dc2626":"#9ca3af";return d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"16px 1fr auto",gap:12,alignItems:"center",padding:12,borderRadius:8,border:"1px solid #e5e7eb",background:B},children:[d.jsx("div",{style:{width:12,height:12,borderRadius:9999,background:N}}),d.jsxs("div",{style:{minWidth:0},children:[d.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:d.jsx("div",{style:{fontWeight:600,fontSize:14},children:h})}),a==="face"&&d.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:8},children:[d.jsx("video",{ref:q,muted:!0,playsInline:!0,autoPlay:!0,style:{width:180,height:112,background:"#000",borderRadius:6}}),w==="running"&&d.jsxs("div",{style:{color:"#6b7280",fontSize:12},children:["Analyzing frames: ",k]})]}),a==="microphone"&&w!=="pending"&&d.jsx("div",{style:{marginTop:6,width:220,height:8,background:"#e5e7eb",borderRadius:9999,overflow:"hidden"},children:d.jsx("div",{style:{width:`${Math.min(100,Math.round(F*200))}%`,height:8,background:"#10b981",transition:"width 150ms"}})}),A[a]&&d.jsx("div",{style:{marginTop:6,color:"#dc2626",fontSize:12},children:A[a]})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[d.jsx("div",{style:{fontSize:12,padding:"2px 8px",borderRadius:9999,background:w==="passed"?"#111827":w==="failed"?"#fee2e2":"#e5e7eb",color:w==="passed"?"#fff":"#111827"},children:w==="passed"?"Passed":w==="running"?"Checkingâ€¦":w==="failed"?"Failed":"Pending"}),w==="failed"&&d.jsx("button",{onClick:()=>ot(a),style:{fontSize:12,padding:"6px 10px",borderRadius:6,background:"#111827",color:"#fff",border:0},children:"Retry"})]})]},a)})})]})})}let Vt=null;async function fn(){return Vt||(Vt=(async()=>{const r=globalThis;let f=r.Human||r.human||null;if(!f)try{const p=await new Function("m","return import(m)")("@vladmandic/human");f=p?.default||p}catch{return null}const i=new f({backend:"webgl",cacheModels:!0,modelBasePath:"https://vladmandic.github.io/human/models",face:{enabled:!0,mesh:!0,iris:!1,attention:!0,description:!0,emotion:{enabled:!0}},body:{enabled:!1},hand:{enabled:!1},object:{enabled:!1},filter:{enabled:!0,equalization:!0,flip:!1,return:!0},async:!0});try{await i.load()}catch{return null}return i})()),Vt}async function dn(r){try{const f=await fn();if(!f)return null;const y=(await f.detect(r)).face?.[0];if(!y||!y.emotion)return null;const p={};for(const A of y.emotion)p[A.emotion]=A.score;const k={happy:(p.happy||0)+(p.joy||0),surprised:p.surprised||0,concerned:(p.sad||0)+(p.angry||0)+(p.fear||0)+(p.disgust||0),focused:(p.neutral||0)*.6+(p.surprised||0)*.05,neutral:p.neutral||0};let j=0;if(Object.values(k).forEach(A=>{j+=A}),j<=0)return null;Object.keys(k).forEach(A=>{k[A]=k[A]/j});const F=Object.entries(k).reduce((A,g)=>k[A[0]]>k[g[0]]?A:g)[0],v=k[F];return{dominant:F,confidence:v,emotions:k}}catch{return null}}function hn(r){const{onEvent:f,context:i="coding"}=r||{},[y,p]=t.useState("idle"),[k,j]=t.useState(void 0),[F,v]=t.useState(0),[A,g]=t.useState(0),C=t.useRef(null),P=t.useRef(null),Y=t.useRef(null),se=t.useRef(!1),fe=t.useRef(0),ie=t.useRef(0),q=t.useRef(null),W=t.useCallback(()=>{Y.current&&cancelAnimationFrame(Y.current),Y.current=null;try{C.current?.dispose()}catch{}C.current=null;try{P.current?.getTracks().forEach(U=>U.stop())}catch{}P.current=null,p("idle")},[]),ke=t.useCallback(U=>{const M=Date.now(),ce=se.current;U>18&&M-fe.current>2e3&&(g(he=>he+1),fe.current=M,f?.({eventType:"audio_anomaly",severity:"warning",context:i,data:{level:U,reason:"audio_spike",faceDetected:ce}})),ce&&U<3?q.current==null?q.current=M:M-q.current>15e3&&(g(he=>he+1),q.current=null,f?.({eventType:"audio_anomaly",severity:"warning",context:i,data:{level:U,reason:"extended_silence_with_face"}})):U>=3&&(q.current=null),!ce&&U>12&&M-ie.current>3e3&&(g(he=>he+1),ie.current=M,f?.({eventType:"audio_anomaly",severity:"warning",context:i,data:{level:U,reason:"audio_without_face"}}))},[i,f]),xe=t.useCallback(()=>{try{if(!C.current)return;const U=C.current.getLevel(),M=Math.max(0,Math.min(100,Math.round(U*160)));v(M),ke(M)}finally{Y.current=requestAnimationFrame(xe)}},[ke]),Le=t.useCallback(async U=>{try{j(void 0),g(0),fe.current=0,ie.current=0,q.current=null;let M=U;if(!M&&typeof window<"u"&&window.precheckAudioStream){const Te=window.precheckAudioStream;Te?.active&&Te.getAudioTracks().length>0&&(M=Te)}M||(M=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:44100}})),P.current=M;const ce=M.getAudioTracks(),he=ce.length?new MediaStream(ce):M;C.current=tn(he),p("running"),Y.current=requestAnimationFrame(xe)}catch(M){p("error"),j(M instanceof Error?M.message:String(M))}},[xe]),de=t.useCallback(U=>{se.current=U},[]);return t.useEffect(()=>W,[W]),{status:y,error:k,level:F,anomalyCount:A,start:Le,stop:W,setFaceDetected:de}}function rn({monitoringStatus:r,sessionData:f,onStatusChange:i,onUpdateSession:y,onAddEvent:p,onAddSnapshot:k}){const[j,F]=t.useState({x:typeof window<"u"?window.innerWidth-280:0,y:typeof window<"u"?window.innerHeight-400:0}),[v,A]=t.useState(!1),[g,C]=t.useState({x:0,y:0}),[P,Y]=t.useState(0),[se,fe]=t.useState(!1),[ie,q]=t.useState(null),[W,ke]=t.useState(null),[xe,Le]=t.useState(null),[de,U]=t.useState(0),[M,ce]=t.useState(0),[he,Te]=t.useState([]),[Ve,me]=t.useState(0),[ue,Se]=t.useState(0),[ot,at]=t.useState(0),[He,Ke]=t.useState(0),[a,h]=t.useState(0),[w,B]=t.useState(!1),[N,Ne]=t.useState(null),[Re,pe]=t.useState(null),[dt,ht]=t.useState(0),[mt,Et]=t.useState(0),[pt,Nt]=t.useState(0),[Ct,Je]=t.useState(null),[We,Mt]=t.useState(0),[Wt,st]=t.useState(0),Ee=t.useRef(null),it=t.useRef(null),ct=t.useRef(null),gt=t.useRef(null),Be=t.useRef(null),Xe=t.useRef(null),kt=t.useRef(!1),yt=t.useRef(0),Tt=t.useRef(0),Ce=t.useRef("none"),le=t.useRef({noFace:0,multipleFaces:0}),we=t.useRef({noFace:!1,multipleFaces:!1,gazeOff:!1}),vt=t.useRef(null),_t=t.useRef(0),Ft=t.useRef(null),ut=t.useRef([]),wt=t.useRef(0),lt=t.useRef(!1),ae=t.useRef({yaw:0,pitch:0,roll:0,initialized:!1}),ee=t.useRef({isGood:!0,goodStreak:0,poorStreak:0}),_e=8,Me=.25,{level:ft,anomalyCount:bt,start:Bt,stop:jt,setFaceDetected:Dt}=hn({context:"coding",onEvent:o=>p?.({...o,timestamp:Date.now()})});t.useEffect(()=>U(ft),[ft]),t.useEffect(()=>ce(bt),[bt]);const Ze=t.useCallback((o,s,c)=>{const u=o.data,x=o.width,b=o.height;let R=0,z=0,H=0;for(let E=0;E<u.length;E+=4){const ve=u[E],V=u[E+1],ze=u[E+2],Ue=(ve+V+ze)/3;if(R+=Ue,E>0){const rt=(u[E-4]+u[E-3]+u[E-2])/3;z+=Math.abs(Ue-rt)}if(E>x*4&&E<u.length-x*4){const rt=(u[E-x*4]+u[E-x*4+1]+u[E-x*4+2])/3,an=(u[E+x*4]+u[E+x*4+1]+u[E+x*4+2])/3;(Math.abs(Ue-rt)>26||Math.abs(Ue-an)>26)&&H++}}const J=Math.max(1,u.length/4),be=R/J,G=z/J,L=H/J,$=c||null,qe=$?Math.min(45,Math.abs($.yaw)):0,Ge=$?Math.min(45,Math.abs($.pitch)):0,De=Math.floor(b*.62),Ye=Math.floor(x*.25),te=Math.ceil(x*.75);let m=0,O=0,re=0,K=0;for(let E=De;E<b;E++)for(let ve=Ye;ve<te;ve++){const V=(E*x+ve)*4,ze=(u[V]+u[V+1]+u[V+2])/3,Ue=(u[V-4]+u[V-3]+u[V-2])/3,rt=(u[V+4]+u[V+5]+u[V+6])/3;(Math.abs(ze-Ue)>24||Math.abs(ze-rt)>24)&&m++,ze<65&&re++,ze>160&&K++,O++}const X=O?m/O:0,Z=O?re/O:0,oe=O?K/O:0,ne=Math.max(0,Math.min(1,(X-.01)/.07)),ge=Math.floor(b*.38);let Ae=0,Oe=0;for(let E=Math.max(0,Math.floor(b*.18));E<ge;E++)for(let ve=1;ve<x-1;ve++){const V=(E*x+ve)*4,ze=(u[V]+u[V+1]+u[V+2])/3,Ue=(u[V-4]+u[V-3]+u[V-2])/3,rt=(u[V+4]+u[V+5]+u[V+6])/3;(Math.abs(ze-Ue)>26||Math.abs(ze-rt)>26)&&Ae++,Oe++}const Qe=Oe?Ae/Oe:0,Pe=Math.max(0,Math.min(1,(Qe-.012)/.06)),Q=Math.max(0,1-(qe/35+Ge/30)/2),et=Math.max(0,Math.min(1,(G-12)/18)),Ie=ne>.22,$e=Z>.12,It=Pe>.2,tt={neutral:.35+.25*Q-.2*Math.max(ne,Pe)-.12*L,happy:(Ie?.18:.05)+.55*ne+(oe>.18?.05:0)-.15*(1-Q),surprised:(Ie&&$e?.16:.04)+.5*ne+($&&$.pitch>10?.12:0)-.12*(qe/45),focused:.18+.55*Q+.2*et-.15*ne,concerned:(It?.16:.06)+.55*Pe+(be<110?.1:0)+($&&$.pitch<-10?.1:0)-.08*ne},nt=Object.keys(tt);let Kt=0;nt.forEach(E=>{tt[E]=Math.max(.001,tt[E]),Kt+=tt[E]});const $t={};nt.forEach(E=>{$t[E]=Math.max(.02,Math.min(.98,tt[E]/Kt))});const Jt=.35;let ye;vt.current?(ye={},nt.forEach(E=>{ye[E]=(1-Jt)*vt.current[E]+Jt*$t[E]})):ye={...$t};let Ut=0;nt.forEach(E=>{Ut+=ye[E]}),Ut>0&&nt.forEach(E=>{ye[E]=ye[E]/Ut}),vt.current=ye;const Xt=Object.entries(ye).reduce((E,ve)=>ye[E[0]]>ye[ve[0]]?E:ve)[0],on=ye[Xt];return{dominant:Xt,confidence:on,emotions:ye}},[]),xt=t.useCallback((o,s)=>{const c=s.data,u=s.width,x=s.height,b=Math.max(0,Math.floor(o.x-o.width*.2)),R=Math.min(u,Math.floor(o.x+o.width*1.2)),z=Math.min(x-1,Math.floor(o.y+o.height*1.05)),H=Math.min(x,z+Math.floor(o.height*1.6));if(H<=z||R<=b)return{isProfessional:!1,hasShirt:!1,confidence:.4,details:"Insufficient torso ROI"};let J=0,be=0,G=0,L=0,$=0;const qe=Math.floor((b+R)/2);for(let K=z;K<H;K++)for(let X=b;X<R;X++){const Z=(K*u+X)*4,oe=c[Z],ne=c[Z+1],ge=c[Z+2],Ae=Math.max(oe,ne,ge),Oe=Math.min(oe,ne,ge),Qe=Ae,Pe=Ae?(Ae-Oe)/Ae:0;if(Qe>60&&Qe<210&&Pe<.45&&oe>40&&ne>20&&ge>20&&oe>ge)continue;if((oe+ne+ge)/3<105&&J++,(Math.abs(oe-ne)>28||Math.abs(ne-ge)>28)&&be++,G+=Pe,L++,K<z+(H-z)*.35&&Math.abs(X-qe)<Math.max(6,Math.floor(o.width*.08))&&X>b+1&&X<R-1){const Ie=(K*u+(X-1))*4,$e=(K*u+(X+1))*4,It=(oe+ne+ge)/3,tt=(c[Ie]+c[Ie+1]+c[Ie+2])/3,nt=(c[$e]+c[$e+1]+c[$e+2])/3;(Math.abs(It-tt)>28||Math.abs(It-nt)>28)&&$++}}if(!L)return{isProfessional:!1,hasShirt:!1,confidence:.4,details:"Insufficient torso pixels"};const Ge=J/L,De=be/L,Ye=G/L,te=$/L,m=Ge>.18||Ye<.35,O=Ge>.35&&De<.22||Ye<.28&&De<.18||te>.002,re=Math.max(.5,Math.min(.95,.55+(m?.15:0)+(O?.15:0)-De*.2));return{isProfessional:O,hasShirt:m,confidence:re,details:O?"Professional attire (solid/low-saturation)":m?"Casual attire":"Torso not clearly visible"}},[]),At=t.useCallback((o,s,c)=>{const u=o.x+o.width/2,x=o.y+o.height/2,b=(u-s/2)/s,R=(x-c/2)/c,z=Math.sqrt(b*b+R*R),H=z<.15,J=Math.max(0,1-z*2);return{isLookingAtCamera:H,gazeDirection:{x:b,y:R},confidence:.8,attentionScore:J}},[]),Ot=t.useCallback(o=>{if(!o.landmarks||o.landmarks.length<4)return null;const s=o.landmarks,c=s[0],u=s[1],x=s[2],b=s[3]??[(u[0]+c[0])/2,Math.max(u[1],c[1])+o.height*.2],R=[(u[0]+c[0])/2,(u[1]+c[1])/2],z=u[0]-c[0],H=u[1]-c[1],J=Math.max(1,Math.hypot(z,H)),be=Math.atan2(H,z)*180/Math.PI,G=Math.hypot(x[0]-c[0],x[1]-c[1]),L=Math.hypot(x[0]-u[0],x[1]-u[1]),$=(G-L)/J,qe=Math.max(-45,Math.min(45,$*90)),Ge=Math.max(1,x[1]-R[1]),De=Math.max(1,(b[1]??R[1])-x[1]),Ye=(Ge-De)/o.height,te=Math.max(-45,Math.min(45,Ye*180)),m=Math.abs(be)>20,O=Math.abs($)>.18,re=Math.abs(te)>15,K=O||re||m,X=Math.max(.5,Math.min(1,Math.max(Math.abs($)*2,Math.abs(be)/30,Math.abs(te)/30)));return{yaw:qe,pitch:te,roll:be,isHeadTurned:K,confidence:X}},[]),Fe=t.useCallback((o=.8)=>{const s=Ee.current,c=it.current;if(!s||!c)return null;const u=s.videoWidth||320,x=s.videoHeight||240;if(s.readyState<2)return null;c.width=u,c.height=x;const b=c.getContext("2d");if(!b)return null;b.drawImage(s,0,0,u,x);try{return c.toDataURL("image/jpeg",o)}catch{return null}},[]),je=t.useCallback(o=>{if(k){k(o);return}if(y){let c=[...f?.snapshots||[],o];c.length>50&&(c=c.slice(c.length-50)),y({snapshots:c})}},[k,y,f?.snapshots]),qt=t.useCallback(()=>{if(wt.current>=5||lt.current)return;lt.current=!0;const o=Fe(.85);if(o){je({timestamp:Date.now(),type:"random_webcam",image:o,context:"Random webcam snapshot during coding"}),wt.current+=1,lt.current=!1;return}const s=window.setTimeout(()=>{const c=Fe(.85);c&&(je({timestamp:Date.now(),type:"random_webcam",image:c,context:"Random webcam snapshot (retry) during coding"}),wt.current+=1),lt.current=!1},3e3);ut.current.push(s)},[je,Fe]),Pt=t.useCallback((o,s)=>{const{gazeDirection:c,attentionScore:u,isLookingAtCamera:x}=o,b=Math.sqrt(c.x*c.x+c.y*c.y),R=!x&&b>.5&&u<.3;return s&&s.isHeadTurned&&s.confidence>=.6?!0:R},[]),Gt=t.useCallback(async()=>{try{const o=await Promise.resolve().then(()=>require("./index-x7BUnCGZ.cjs")),s=await Promise.resolve().then(()=>require("./blazeface.esm-BsJ4BrW4.cjs"));o.ready&&await o.ready();const c=await s.load();return gt.current=c,!0}catch(o){return console.error("[widget] Failed to init face detection:",o),!1}},[]),Yt=(o,s)=>{const c=Math.max(o.x,s.x),u=Math.max(o.y,s.y),x=Math.min(o.x+o.width,s.x+s.width),b=Math.min(o.y+o.height,s.y+s.height),R=Math.max(0,x-c),z=Math.max(0,b-u),H=R*z,J=o.width*o.height+s.width*s.height-H;return J>0?H/J:0},e=t.useCallback(async()=>{if(!Ee.current||!it.current||!gt.current){Be.current=requestAnimationFrame(e);return}const o=Ee.current,s=it.current;if(o.readyState!==4){Be.current=requestAnimationFrame(e);return}try{const c=await gt.current.estimateFaces(o,!1),u=o.videoWidth||o.width||s.width,x=o.videoHeight||o.height||s.height,b=Math.max(6,Math.floor(u*.04)),R=Math.max(6,Math.floor(x*.04)),z=.03,H=.6,be=c.map(m=>{const[O,re]=m.topLeft,[K,X]=m.bottomRight;return{x:O,y:re,width:K-O,height:X-re,confidence:m.probability?.[0]||.8,landmarks:m.landmarks}}).filter(m=>{if(m.width<=0||m.height<=0||(m.confidence||0)<.6||m.x<b||m.y<R||m.x+m.width>u-b||m.y+m.height>x-R)return!1;const re=m.width*m.height/(u*x);if(re<z||re>H)return!1;const K=m.width/m.height;return!(K<.6||K>1.6)});be.sort((m,O)=>O.confidence-m.confidence);const G=[];be.forEach(m=>{G.some(re=>Yt(m,re)>.45)||G.push(m)}),Y(G.length),Te(G),fe(G.length===1),Dt(G.length>0);const L=Date.now(),$=G.length===0?"none":G.length===1?"single":"multiple";$==="multiple"?le.current.multipleFaces+=1:le.current.multipleFaces=Math.max(0,le.current.multipleFaces-1),$==="none"?le.current.noFace+=1:le.current.noFace=Math.max(0,le.current.noFace-1);const qe=3,Ge=2,De=3,Ye=2;let te=Ce.current;if(Ce.current!=="multiple"?le.current.multipleFaces>=qe?te="multiple":te=$==="none"?"single":$:le.current.multipleFaces<=Ge&&(te=$==="multiple"?"multiple":"single"),te!=="none"?le.current.noFace>=De&&(te="none"):le.current.noFace<=Ye&&(te=$==="none"?"none":"single"),te==="multiple"){if(Ce.current!=="multiple"&&(Ne(L),Nt(m=>m+1),!we.current.multipleFaces)){we.current.multipleFaces=!0,p?.({eventType:"face_detection",severity:"warning",context:"coding",data:{reason:"multiple_faces",count:G.length},timestamp:L});const m=Fe(.85);m&&je({timestamp:L,type:"violation_trigger",image:m,context:"Multiple faces detected"})}}else{if(Ce.current==="multiple"&&N!==null){const m=L-N;ht(O=>O+m),Ne(null)}we.current.multipleFaces=!1}if(te==="none"){if(Ce.current!=="none"&&(Je(L),Mt(m=>m+1),!we.current.noFace)){we.current.noFace=!0,p?.({eventType:"face_detection",severity:"critical",context:"coding",data:{reason:"no_face"},timestamp:L});const m=Fe(.85);m&&je({timestamp:L,type:"violation_trigger",image:m,context:"No face detected"})}}else{if(Ce.current==="none"&&Ct!==null){const m=L-Ct;st(O=>O+m),Je(null)}we.current.noFace=!1}if(Ce.current=te,G.length===1){const m=G[0],O=s.getContext("2d");if(O){O.drawImage(o,0,0,s.width,s.height);const re=O.getImageData(0,0,s.width,s.height),K=O.getImageData(m.x,m.y,m.width,m.height);let X={isGoodPosture:!0,shoulderAlignment:0,headTilt:0,confidence:.7};const Z=Ot(m);if(Z){ae.current.initialized?(ae.current.yaw=Me*Z.yaw+(1-Me)*ae.current.yaw,ae.current.pitch=Me*Z.pitch+(1-Me)*ae.current.pitch,ae.current.roll=Me*Z.roll+(1-Me)*ae.current.roll):ae.current={yaw:Z.yaw,pitch:Z.pitch,roll:Z.roll,initialized:!0};const Q=ae.current.yaw,et=ae.current.pitch,Ie=ae.current.roll,$e=Math.abs(Ie)<=10&&Math.abs(et)<=12&&Math.abs(Q)<=18;$e!==ee.current.isGood?$e?(ee.current.goodStreak+=1,ee.current.poorStreak=0,ee.current.goodStreak>=_e&&(ee.current.isGood=!0,ee.current.goodStreak=0)):(ee.current.poorStreak+=1,ee.current.goodStreak=0,ee.current.poorStreak>=_e&&(ee.current.isGood=!1,ee.current.poorStreak=0)):(ee.current.goodStreak=0,ee.current.poorStreak=0),X={isGoodPosture:ee.current.isGood,shoulderAlignment:-Ie,headTilt:et,confidence:Math.min(1,.6+.4*Z.confidence)}}let oe;const ne=Date.now();if(ne-_t.current>500){_t.current=ne;try{const Q=await dn(s);Q?(oe={dominant:Q.dominant,confidence:Q.confidence,emotions:Q.emotions},Ft.current=oe):oe=Ze(K,m,Z)}catch{oe=Ze(K,m,Z)}}else oe=Ft.current??Ze(K,m,Z);const ge=xt(m,re),Ae=At(m,s.width,s.height),Oe=Z??Ot(m);q(X),ke(oe),Le(ge);const Qe=Pt(Ae,Oe);if(Qe&&!w&&Date.now()-Tt.current>3e3)h(Q=>Q+1),B(!0),pe(L),Tt.current=Date.now(),we.current.gazeOff||(we.current.gazeOff=!0,p?.({eventType:"gaze_tracking",severity:"warning",context:"coding",data:{offscreen:!0,reason:Oe?.isHeadTurned?"head_movement":"center_offset",headPose:Oe},timestamp:L}));else if(!Qe&&w){if(Re!==null){const Q=L-Re;Et(et=>et+Q),pe(null)}B(!1),we.current.gazeOff=!1}const Pe=G.length===0||G.length>1;if(y&&(Pe||L-yt.current>=5e3)){if(Pe){const Q=Fe(.85);Q&&je({timestamp:L,type:"violation_trigger",image:Q,context:G.length===0?"No face detected":"Multiple faces detected"})}y({postureAnalysis:X,attireAnalysis:ge}),yt.current=L}}}else if(q(null),ke(null),Le(null),w){if(Re!==null){const m=L-Re;Et(O=>O+m),pe(null)}B(!1)}G.length===0?i?.("violation"):G.length>1?i?.("warning"):i?.("optimal")}catch(c){console.error("[widget] Face detection error:",c)}Be.current=requestAnimationFrame(e)},[Ze,xt,At,Pt,i,y,f?.snapshots,w,N,Re,Dt]);t.useEffect(()=>{ce(0)},[]),t.useEffect(()=>{(async()=>{try{const b=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:320},height:{ideal:240},frameRate:{ideal:15}},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});Ee.current&&(Ee.current.srcObject=b);let R=null;const z=b.getAudioTracks();z.length>0&&(R=new MediaStream(z),Xe.current=R),await Gt(),R&&await Bt(R),Be.current=requestAnimationFrame(e)}catch{i?.("violation")}})();const s=5,c=[60*1e3,5*60*1e3],u=Math.max(0,s-c.length),x=[...c];if(u>0)for(let z=0;z<u;z++){const H=42e4+Math.random()*18e4,J=(Math.random()-.5)*30*1e3;x.push(Math.max(0,Math.floor(H+J)))}x.sort((b,R)=>b-R);for(let b=1;b<x.length;b++)Math.abs(x[b]-x[b-1])<10*1e3&&(x[b]+=12*1e3);return x.forEach(b=>{const R=window.setTimeout(()=>qt(),b);ut.current.push(R)}),()=>{kt.current=!0,Be.current&&cancelAnimationFrame(Be.current),Ee.current?.srcObject&&Ee.current.srcObject.getTracks().forEach(R=>R.stop()),Xe.current&&Xe.current.getTracks().forEach(b=>b.stop()),jt(),Xe.current=null,ut.current.forEach(b=>window.clearTimeout(b)),ut.current=[]}},[]);const n=o=>{A(!0);const s=ct.current?.getBoundingClientRect();s&&C({x:o.clientX-s.left,y:o.clientY-s.top})},l=o=>{if(v){const s=Math.max(0,Math.min((typeof window<"u"?window.innerWidth:0)-280,o.clientX-g.x)),c=Math.max(0,Math.min((typeof window<"u"?window.innerHeight:0)-400,o.clientY-g.y));F({x:s,y:c})}},S=()=>A(!1);t.useEffect(()=>{if(v)return document.addEventListener("mousemove",l),document.addEventListener("mouseup",S),()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",S)}},[v,g]);const D=()=>{document.hidden&&Se(o=>{const s=o+1;return p?.({eventType:"tab_switch",severity:"critical",context:"coding",data:{when:Date.now()},timestamp:Date.now()}),s})},I=()=>me(o=>o+1),_=o=>{at(s=>s+1),p?.({eventType:"keystroke",severity:"info",context:"coding",data:{},timestamp:Date.now()}),(o.ctrlKey||o.metaKey)&&(o.key==="c"||o.key==="x"||o.key==="v")&&(Ke(s=>s+1),o.preventDefault(),p?.({eventType:"keystroke",severity:"warning",context:"coding",data:{copyCutPaste:!0,key:o.key},timestamp:Date.now()}))};t.useEffect(()=>(document.addEventListener("visibilitychange",D),window.addEventListener("blur",I),document.addEventListener("keydown",_),()=>{document.removeEventListener("visibilitychange",D),window.removeEventListener("blur",I),document.removeEventListener("keydown",_)}),[]);const T=P===0?"#ef4444":P>1?"#f59e0b":"#22c55e";return d.jsxs("div",{ref:ct,onMouseDown:n,style:{position:"fixed",left:j.x,top:j.y,zIndex:9999,width:288,cursor:"move",border:`2px solid ${T}`,borderRadius:8,background:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.2)",padding:12,userSelect:"none"},children:[d.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:d.jsx("div",{style:{fontSize:12,fontWeight:600},children:P===0?"No Face":P>1?"Multiple Faces":se?"Optimal":"Good"})}),d.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:4,overflow:"hidden"},children:[d.jsx("video",{ref:Ee,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:128,objectFit:"cover"}}),d.jsx("canvas",{ref:it,width:320,height:240,style:{display:"none"}})]}),d.jsxs("div",{style:{marginTop:8,fontSize:12,display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[d.jsxs("div",{children:["Faces: ",d.jsx("strong",{style:{color:P===1?"#16a34a":"#ef4444"},children:P})]}),d.jsxs("div",{children:["No Face: ",d.jsx("strong",{style:{color:We>0?"#ef4444":"#16a34a"},children:We})]}),d.jsxs("div",{children:["Multiple: ",d.jsx("strong",{style:{color:pt>0?"#ef4444":"#16a34a"},children:pt})]}),d.jsxs("div",{children:["Posture: ",d.jsx("strong",{style:{color:ie?.isGoodPosture?"#16a34a":"#f59e0b"},children:ie?.isGoodPosture?"Good":"Poor"})]}),d.jsxs("div",{children:["Attire: ",d.jsx("strong",{style:{color:xe?.isProfessional?"#16a34a":"#f59e0b"},children:xe?.isProfessional?"Professional":"Casual"})]}),d.jsxs("div",{children:["Emotion: ",d.jsx("strong",{style:{color:"#3b82f6"},children:W?.dominant||"Unknown"})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:["Audio: ",d.jsxs("span",{style:{color:de>50?"#16a34a":de>20?"#f59e0b":"#ef4444"},children:[de,"%"]}),d.jsx("div",{style:{width:64,height:6,background:"#eee",borderRadius:9999,overflow:"hidden"},children:d.jsx("div",{style:{width:`${Math.min(de,100)}%`,height:6,transition:"width 100ms",background:de>50?"#16a34a":de>20?"#f59e0b":"#ef4444"}})})]}),d.jsxs("div",{children:["Audio Alerts: ",d.jsx("strong",{style:{color:M>0?"#ef4444":"#16a34a"},children:M})]}),d.jsxs("div",{children:["Unfocus: ",d.jsx("strong",{style:{color:Ve>0?"#ef4444":"#16a34a"},children:Ve})]}),d.jsxs("div",{children:["Tab Switch: ",d.jsx("strong",{style:{color:ue>0?"#ef4444":"#16a34a"},children:ue})]}),d.jsxs("div",{children:["Keystrokes: ",d.jsx("strong",{style:{color:"#3b82f6"},children:ot})]}),d.jsxs("div",{children:["Copy Attempts: ",d.jsx("strong",{style:{color:He>0?"#ef4444":"#16a34a"},children:He})]}),d.jsxs("div",{children:["Gaze Off: ",d.jsx("strong",{style:{color:a>0?"#ef4444":"#16a34a"},children:a})]})]})]})}const Lt=(r,f)=>r.length>f?r.slice(r.length-f):r,mn=(r,f)=>({sessionId:r,sessionType:"coding-assessment",startTime:Date.now(),preCheckResults:f,liveEvents:[],codingMetrics:{totalKeystrokes:0,linesOfCode:0,codeExecutions:0,externalCopyEvents:0,languageSwitches:0,averageTypingSpeed:0,codingTimeVsReadingTime:{coding:0,reading:0}},questionProgress:[],snapshots:[],sessionStats:{totalDuration:0,questionsAttempted:0,violationCount:0,tabSwitches:0,audioAnomalies:0,gazeDuration:0,focusBreaks:0,codeExecutionCount:0,noFaceIncidents:0,multipleFaceIncidents:0,unfocusEvents:0,gazeOffScreenIncidents:0,keystrokes:0,copyCutPasteAttempts:0}});function pn(r,f){switch(f.eventType){case"tab_switch":return{...r,tabSwitches:r.tabSwitches+1,violationCount:r.violationCount+1};case"audio_anomaly":return{...r,audioAnomalies:r.audioAnomalies+1,violationCount:r.violationCount+1};case"code_execution":return{...r,codeExecutionCount:r.codeExecutionCount+1};case"face_detection":{const i=f.data?.reason;return i==="no_face"?{...r,noFaceIncidents:r.noFaceIncidents+1,violationCount:r.violationCount+1}:i==="multiple_faces"?{...r,multipleFaceIncidents:r.multipleFaceIncidents+1,violationCount:r.violationCount+1}:r}case"gaze_tracking":{const i=f.data?.type==="focus_break",y=Number(f.data?.focusTimeMs)||0,p=f.data?.offscreen===!0;return{...r,focusBreaks:r.focusBreaks+(i?1:0),gazeDuration:r.gazeDuration+y,unfocusEvents:r.unfocusEvents+(i?1:0),gazeOffScreenIncidents:r.gazeOffScreenIncidents+(p?1:0),violationCount:r.violationCount+(i||p?1:0)}}case"keystroke":{const i=f.data?.copyCutPaste===!0;return{...r,keystrokes:r.keystrokes+1,copyCutPasteAttempts:r.copyCutPasteAttempts+(i?1:0),violationCount:r.violationCount+(i?1:0)}}default:return r}}function gn(r,f){switch(f.type){case"INIT":return{...f.payload};case"SET_FIELDS":{const i={...r,...f.payload};return i.snapshots&&(i.snapshots=Lt(i.snapshots,50)),i.liveEvents&&(i.liveEvents=Lt(i.liveEvents,200)),i}case"ADD_EVENTS":{const i=Lt([...r.liveEvents,...f.events],200),y=f.events.reduce(pn,r.sessionStats);return{...r,liveEvents:i,sessionStats:y}}case"ADD_SNAPSHOT":{const i=Lt([...r.snapshots,f.snapshot],50);return{...r,snapshots:i}}case"TICK":{const i=Math.max(0,f.now-r.startTime);return i===r.sessionStats.totalDuration?r:{...r,sessionStats:{...r.sessionStats,totalDuration:i}}}case"COMPLETE":{const i=f.endTime??Date.now();return{...r,sessionStats:{...r.sessionStats,totalDuration:Math.max(0,i-r.startTime)}}}default:return r}}function yn(r){const[f,i]=t.useState(null),y=t.useCallback(g=>{i(C=>C&&gn(C,g))},[]),p=t.useRef(null),k=t.useRef(0),j=t.useRef(null),F=t.useCallback(g=>{const C=`session_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;p.current=C;const P=sessionStorage.getItem(C);if(P)try{const se=JSON.parse(P);return i(se),C}catch{}const Y=mn(C,g);return i(Y),sessionStorage.setItem(C,JSON.stringify(Y)),C},[r?.sessionId]),v=t.useCallback(g=>{const C=g??f;if(!(!C||!p.current))try{sessionStorage.setItem(p.current,JSON.stringify(C)),k.current=Date.now()}catch(P){console.error("[session] persist failed",P)}},[f]);return t.useEffect(()=>{if(!f)return;const C=Date.now()-k.current;return C<1e3?(j.current&&clearTimeout(j.current),j.current=setTimeout(()=>v(),1e3-C)):v(),()=>{j.current&&clearTimeout(j.current)}},[f,v]),t.useEffect(()=>{const g=()=>v();return window.addEventListener("visibilitychange",g),window.addEventListener("beforeunload",g),()=>{window.removeEventListener("visibilitychange",g),window.removeEventListener("beforeunload",g)}},[v]),t.useEffect(()=>{if(!f)return;const g=setInterval(()=>y({type:"TICK",now:Date.now()}),1e3);return()=>clearInterval(g)},[f,y]),t.useMemo(()=>({state:f,sessionId:p.current,init:F,setFields:g=>y({type:"SET_FIELDS",payload:g}),addEvents:g=>y({type:"ADD_EVENTS",events:g}),addSnapshot:g=>y({type:"ADD_SNAPSHOT",snapshot:g}),complete:()=>y({type:"COMPLETE"})}),[f,y,F])}function vn({onSessionStart:r,onSessionUpdate:f,onEvent:i}){const[y,p]=t.useState(null),[k,j]=t.useState("optimal"),F=yn();return t.useEffect(()=>{if(y&&!F.state){const v=F.init(y);r?.(v,y)}},[y,F]),y?d.jsx(rn,{monitoringStatus:k,sessionData:F.state??void 0,onStatusChange:v=>j(v),onUpdateSession:v=>{F.setFields(v),f?.(v)},onAddSnapshot:v=>F.addSnapshot(v),onAddEvent:v=>{F.addEvents([{...v,timestamp:v.timestamp??Date.now()}]),i?.(v)}}):d.jsx(nn,{onComplete:v=>p(v),onError:()=>p(null)})}exports.FloatingVideo=rn;exports.Prechecks=nn;exports.ProctoringWidget=vn;
