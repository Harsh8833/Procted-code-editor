"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const n=require("react");var bt={exports:{}},Ke={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rt;function Mt(){if(Rt)return Ke;Rt=1;var o=n,h=Symbol.for("react.element"),c=Symbol.for("react.fragment"),w=Object.prototype.hasOwnProperty,R=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,j={key:!0,ref:!0,__self:!0,__source:!0};function A(_,b,B){var p,C={},D=null,N=null;B!==void 0&&(D=""+B),b.key!==void 0&&(D=""+b.key),b.ref!==void 0&&(N=b.ref);for(p in b)w.call(b,p)&&!j.hasOwnProperty(p)&&(C[p]=b[p]);if(_&&_.defaultProps)for(p in b=_.defaultProps,b)C[p]===void 0&&(C[p]=b[p]);return{$$typeof:h,type:_,key:D,ref:N,props:C,_owner:R.current}}return Ke.Fragment=c,Ke.jsx=A,Ke.jsxs=A,Ke}var Je={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ct;function jt(){return Ct||(Ct=1,process.env.NODE_ENV!=="production"&&function(){var o=n,h=Symbol.for("react.element"),c=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),_=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),N=Symbol.for("react.offscreen"),G=Symbol.iterator,Z="@@iterator";function U(e){if(e===null||typeof e!="object")return null;var r=G&&e[G]||e[Z];return typeof r=="function"?r:null}var W=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function P(e){{for(var r=arguments.length,l=new Array(r>1?r-1:0),t=1;t<r;t++)l[t-1]=arguments[t];ue("error",e,l)}}function ue(e,r,l){{var t=W.ReactDebugCurrentFrame,s=t.getStackAddendum();s!==""&&(r+="%s",l=l.concat([s]));var a=l.map(function(f){return String(f)});a.unshift("Warning: "+r),Function.prototype.apply.call(console[e],console,a)}}var oe=!1,he=!1,Q=!1,q=!1,k=!1,V;V=Symbol.for("react.module.reference");function ee(e){return!!(typeof e=="string"||typeof e=="function"||e===w||e===j||k||e===R||e===B||e===p||q||e===N||oe||he||Q||typeof e=="object"&&e!==null&&(e.$$typeof===D||e.$$typeof===C||e.$$typeof===A||e.$$typeof===_||e.$$typeof===b||e.$$typeof===V||e.getModuleId!==void 0))}function le(e,r,l){var t=e.displayName;if(t)return t;var s=r.displayName||r.name||"";return s!==""?l+"("+s+")":l}function xe(e){return e.displayName||"Context"}function te(e){if(e==null)return null;if(typeof e.tag=="number"&&P("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case w:return"Fragment";case c:return"Portal";case j:return"Profiler";case R:return"StrictMode";case B:return"Suspense";case p:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case _:var r=e;return xe(r)+".Consumer";case A:var l=e;return xe(l._context)+".Provider";case b:return le(e,e.render,"ForwardRef");case C:var t=e.displayName||null;return t!==null?t:te(e.type)||"Memo";case D:{var s=e,a=s._payload,f=s._init;try{return te(f(a))}catch{return null}}}return null}var K=Object.assign,ae=0,Te,_e,Se,Re,i,m,y;function I(){}I.__reactDisabledLog=!0;function O(){{if(ae===0){Te=console.log,_e=console.info,Se=console.warn,Re=console.error,i=console.group,m=console.groupCollapsed,y=console.groupEnd;var e={configurable:!0,enumerable:!0,value:I,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}ae++}}function me(){{if(ae--,ae===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:K({},e,{value:Te}),info:K({},e,{value:_e}),warn:K({},e,{value:Se}),error:K({},e,{value:Re}),group:K({},e,{value:i}),groupCollapsed:K({},e,{value:m}),groupEnd:K({},e,{value:y})})}ae<0&&P("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var se=W.ReactCurrentDispatcher,ne;function ze(e,r,l){{if(ne===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);ne=t&&t[1]||""}return`
`+ne+e}}var Le=!1,We;{var Xe=typeof WeakMap=="function"?WeakMap:Map;We=new Xe}function Ne(e,r){if(!e||Le)return"";{var l=We.get(e);if(l!==void 0)return l}var t;Le=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var a;a=se.current,se.current=null,O();try{if(r){var f=function(){throw Error()};if(Object.defineProperty(f.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(f,[])}catch(z){t=z}Reflect.construct(e,[],f)}else{try{f.call()}catch(z){t=z}e.call(f.prototype)}}else{try{throw Error()}catch(z){t=z}e()}}catch(z){if(z&&t&&typeof z.stack=="string"){for(var u=z.stack.split(`
`),g=t.stack.split(`
`),x=u.length-1,E=g.length-1;x>=1&&E>=0&&u[x]!==g[E];)E--;for(;x>=1&&E>=0;x--,E--)if(u[x]!==g[E]){if(x!==1||E!==1)do if(x--,E--,E<0||u[x]!==g[E]){var F=`
`+u[x].replace(" at new "," at ");return e.displayName&&F.includes("<anonymous>")&&(F=F.replace("<anonymous>",e.displayName)),typeof e=="function"&&We.set(e,F),F}while(x>=1&&E>=0);break}}}finally{Le=!1,se.current=a,me(),Error.prepareStackTrace=s}var T=e?e.displayName||e.name:"",M=T?ze(T):"";return typeof e=="function"&&We.set(e,M),M}function pt(e,r,l){return Ne(e,!1)}function Ze(e){var r=e.prototype;return!!(r&&r.isReactComponent)}function Ce(e,r,l){if(e==null)return"";if(typeof e=="function")return Ne(e,Ze(e));if(typeof e=="string")return ze(e);switch(e){case B:return ze("Suspense");case p:return ze("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case b:return pt(e.render);case C:return Ce(e.type,r,l);case D:{var t=e,s=t._payload,a=t._init;try{return Ce(a(s),r,l)}catch{}}}return""}var pe=Object.prototype.hasOwnProperty,Qe={},gt=W.ReactDebugCurrentFrame;function Me(e){if(e){var r=e._owner,l=Ce(e.type,e._source,r?r.type:null);gt.setExtraStackFrame(l)}else gt.setExtraStackFrame(null)}function ie(e,r,l,t,s){{var a=Function.call.bind(pe);for(var f in e)if(a(e,f)){var u=void 0;try{if(typeof e[f]!="function"){var g=Error((t||"React class")+": "+l+" type `"+f+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[f]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw g.name="Invariant Violation",g}u=e[f](r,f,t,l,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(x){u=x}u&&!(u instanceof Error)&&(Me(s),P("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",t||"React class",l,f,typeof u),Me(null)),u instanceof Error&&!(u.message in Qe)&&(Qe[u.message]=!0,Me(s),P("Failed %s type: %s",l,u.message),Me(null))}}}var je=Array.isArray;function Ae(e){return je(e)}function qe(e){{var r=typeof Symbol=="function"&&Symbol.toStringTag,l=r&&e[Symbol.toStringTag]||e.constructor.name||"Object";return l}}function ge(e){try{return Ee(e),!1}catch{return!0}}function Ee(e){return""+e}function et(e){if(ge(e))return P("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",qe(e)),Ee(e)}var Be=W.ReactCurrentOwner,tt={key:!0,ref:!0,__self:!0,__source:!0},ye,re;function De(e){if(pe.call(e,"ref")){var r=Object.getOwnPropertyDescriptor(e,"ref").get;if(r&&r.isReactWarning)return!1}return e.ref!==void 0}function Ye(e){if(pe.call(e,"key")){var r=Object.getOwnPropertyDescriptor(e,"key").get;if(r&&r.isReactWarning)return!1}return e.key!==void 0}function Fe(e,r){typeof e.ref=="string"&&Be.current}function J(e,r){{var l=function(){ye||(ye=!0,P("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",r))};l.isReactWarning=!0,Object.defineProperty(e,"key",{get:l,configurable:!0})}}function $(e,r){{var l=function(){re||(re=!0,P("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",r))};l.isReactWarning=!0,Object.defineProperty(e,"ref",{get:l,configurable:!0})}}var nt=function(e,r,l,t,s,a,f){var u={$$typeof:h,type:e,key:r,ref:l,props:f,_owner:a};return u._store={},Object.defineProperty(u._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(u,"_self",{configurable:!1,enumerable:!1,writable:!1,value:t}),Object.defineProperty(u,"_source",{configurable:!1,enumerable:!1,writable:!1,value:s}),Object.freeze&&(Object.freeze(u.props),Object.freeze(u)),u};function ve(e,r,l,t,s){{var a,f={},u=null,g=null;l!==void 0&&(et(l),u=""+l),Ye(r)&&(et(r.key),u=""+r.key),De(r)&&(g=r.ref,Fe(r,s));for(a in r)pe.call(r,a)&&!tt.hasOwnProperty(a)&&(f[a]=r[a]);if(e&&e.defaultProps){var x=e.defaultProps;for(a in x)f[a]===void 0&&(f[a]=x[a])}if(u||g){var E=typeof e=="function"?e.displayName||e.name||"Unknown":e;u&&J(f,E),g&&$(f,E)}return nt(e,u,g,s,t,Be.current,f)}}var Oe=W.ReactCurrentOwner,$e=W.ReactDebugCurrentFrame;function we(e){if(e){var r=e._owner,l=Ce(e.type,e._source,r?r.type:null);$e.setExtraStackFrame(l)}else $e.setExtraStackFrame(null)}var Ge;Ge=!1;function Pe(e){return typeof e=="object"&&e!==null&&e.$$typeof===h}function Ue(){{if(Oe.current){var e=te(Oe.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function rt(e){return""}var Ve={};function ot(e){{var r=Ue();if(!r){var l=typeof e=="string"?e:e.displayName||e.name;l&&(r=`

Check the top-level render call using <`+l+">.")}return r}}function fe(e,r){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var l=ot(r);if(Ve[l])return;Ve[l]=!0;var t="";e&&e._owner&&e._owner!==Oe.current&&(t=" It was passed a child from "+te(e._owner.type)+"."),we(e),P('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',l,t),we(null)}}function de(e,r){{if(typeof e!="object")return;if(Ae(e))for(var l=0;l<e.length;l++){var t=e[l];Pe(t)&&fe(t,r)}else if(Pe(e))e._store&&(e._store.validated=!0);else if(e){var s=U(e);if(typeof s=="function"&&s!==e.entries)for(var a=s.call(e),f;!(f=a.next()).done;)Pe(f.value)&&fe(f.value,r)}}}function yt(e){{var r=e.type;if(r==null||typeof r=="string")return;var l;if(typeof r=="function")l=r.propTypes;else if(typeof r=="object"&&(r.$$typeof===b||r.$$typeof===C))l=r.propTypes;else return;if(l){var t=te(r);ie(l,e.props,"prop",t,e)}else if(r.PropTypes!==void 0&&!Ge){Ge=!0;var s=te(r);P("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",s||"Unknown")}typeof r.getDefaultProps=="function"&&!r.getDefaultProps.isReactClassApproved&&P("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function at(e){{for(var r=Object.keys(e.props),l=0;l<r.length;l++){var t=r[l];if(t!=="children"&&t!=="key"){we(e),P("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",t),we(null);break}}e.ref!==null&&(we(e),P("Invalid attribute `ref` supplied to `React.Fragment`."),we(null))}}var st={};function ke(e,r,l,t,s,a){{var f=ee(e);if(!f){var u="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(u+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var g=rt();g?u+=g:u+=Ue();var x;e===null?x="null":Ae(e)?x="array":e!==void 0&&e.$$typeof===h?(x="<"+(te(e.type)||"Unknown")+" />",u=" Did you accidentally export a JSX literal instead of a component?"):x=typeof e,P("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",x,u)}var E=ve(e,r,l,s,a);if(E==null)return E;if(f){var F=r.children;if(F!==void 0)if(t)if(Ae(F)){for(var T=0;T<F.length;T++)de(F[T],e);Object.freeze&&Object.freeze(F)}else P("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else de(F,e)}if(pe.call(r,"key")){var M=te(e),z=Object.keys(r).filter(function(L){return L!=="key"}),v=z.length>0?"{key: someKey, "+z.join(": ..., ")+": ...}":"{key: someKey}";if(!st[M+v]){var S=z.length>0?"{"+z.join(": ..., ")+": ...}":"{}";P(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,v,M,S,M),st[M+v]=!0}}return e===w?at(E):yt(E),E}}function vt(e,r,l){return ke(e,r,l,!0)}function it(e,r,l){return ke(e,r,l,!1)}var ct=it,ut=vt;Je.Fragment=w,Je.jsx=ct,Je.jsxs=ut}()),Je}process.env.NODE_ENV==="production"?bt.exports=Mt():bt.exports=jt();var d=bt.exports;function kt(o){const h=window.AudioContext||window.webkitAudioContext,c=new h,w=c.createMediaStreamSource(o),R=c.createAnalyser();R.fftSize=2048,R.smoothingTimeConstant=.85,w.connect(R);const j=new Uint8Array(R.fftSize);function A(){R.getByteTimeDomainData(j);let _=0;for(let b=0;b<j.length;b++){const B=(j[b]-128)/128;_+=B*B}return Math.sqrt(_/j.length)}return{getLevel:()=>A(),dispose:async()=>{try{w.disconnect()}catch{}try{R.disconnect()}catch{}try{await c.close()}catch{}}}}let ht=null;async function At(){if(ht)return ht;const o=await Promise.resolve().then(()=>require("./blazeface.esm-BsJ4BrW4.cjs")),h=await Promise.resolve().then(()=>require("./index-x7BUnCGZ.cjs"));return h.ready&&await h.ready(),ht=await o.load(),ht}function Et(o,h,c){if(o.width<=0||o.height<=0||h<=0||c<=0)return!1;const w=Math.max(6,Math.floor(h*.06)),R=Math.max(6,Math.floor(c*.06));if(o.x<w||o.y<R||o.x+o.width>h-w||o.y+o.height>c-R)return!1;const j=o.width*o.height,A=h*c,_=j/A;if(_<.04||_>.65)return!1;const b=o.width/o.height;return!(b<.6||b>1.6)}async function Dt(o){if("FaceDetector"in window)try{const c=await new window.FaceDetector({fastMode:!0,maxDetectedFaces:1}).detect(o);if(c&&c.length>0){const w=c[0]?.boundingBox,R=o.videoWidth||o.width||0,j=o.videoHeight||o.height||0;if(w){const A={x:w.x,y:w.y,width:w.width,height:w.height};if(Et(A,R,j))return{present:!0,confidence:.85}}}return{present:!1,confidence:0}}catch{}try{const c=await(await At()).estimateFaces(o,!1);if(c&&c.length>0){const w=o.videoWidth||o.width||0,R=o.videoHeight||o.height||0;for(const j of c){const[A,_]=j.topLeft,[b,B]=j.bottomRight,p={x:A,y:_,width:b-A,height:B-_};if(Et(p,w,R)){const C=j.probability?j.probability[0]:.75;return{present:!0,confidence:Math.max(.6,Math.min(1,C))}}}}}catch{}return{present:!1,confidence:0}}function Tt({onComplete:o,onError:h}){const c=["camera","microphone","face","monitor","browser"],[w,R]=n.useState({camera:"pending",microphone:"pending",face:"pending",monitor:"pending",browser:"pending"}),[j,A]=n.useState(0),[_,b]=n.useState(0),[B,p]=n.useState({}),[C,D]=n.useState({}),N=n.useRef(null),G=n.useRef(null),Z=n.useRef(null),U=n.useRef(null),W=n.useRef(null),P=()=>{try{N.current?.getTracks().forEach(i=>i.stop())}catch{}try{G.current?.getTracks().forEach(i=>i.stop())}catch{}N.current=null,G.current=null,Z.current&&(Z.current.dispose().catch(()=>{}),Z.current=null),U.current&&(cancelAnimationFrame(U.current),U.current=null)},ue=async i=>{try{const m=window.AudioContext||window.webkitAudioContext;if(!m)throw new Error("AudioContext not supported");const y=new m,I=y.createMediaStreamSource(i),O=y.createAnalyser();O.fftSize=256,O.smoothingTimeConstant=.8,I.connect(O);const me=new Uint8Array(O.frequencyBinCount);O.getByteFrequencyData(me),sessionStorage.setItem("audio-context-initialized","true"),I.disconnect(),await y.close(),typeof window<"u"&&(window.precheckAudioStream=i)}catch{sessionStorage.setItem("audio-context-initialized","false")}},oe=async i=>{const m=W.current;let y=0,I=0,O=0;const me=30;for(;O<me&&y<5;){try{const ne=await Dt(m);ne.present&&(y+=1,I=Math.max(I,ne.confidence))}catch{}O++,A(O),await new Promise(ne=>setTimeout(ne,100))}return{status:y>=5,confidence:I,timestamp:Date.now()}},he=()=>{try{const i=window.screen.width,m=window.screen.height,y=window.screen.availWidth;return i/m>3||i>y*1.5||[3840,3360,2560,4480,5120].includes(i)?2:1}catch{return 1}},Q=async()=>he(),q=()=>["navigator.mediaDevices","navigator.mediaDevices.getUserMedia","requestAnimationFrame","WebAssembly"].every(m=>{const y=m.split(".");let I=window;for(const O of y){if(!(O in I))return!1;I=I[O]}return!0}),k=(i,m)=>{R(y=>({...y,[i]:m}))},V=n.useCallback(async()=>{k("camera","running"),p(i=>({...i,camera:""}));try{try{N.current?.getTracks().forEach(m=>m.stop())}catch{}const i=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:15}}});if(N.current=i,!W.current){const m=document.createElement("video");m.muted=!0,m.playsInline=!0,W.current=m}W.current.srcObject=i;try{await W.current.play()}catch{}return D(m=>({...m,cameraAccess:!0})),k("camera","passed"),!0}catch(i){const m=i?.name==="NotAllowedError"?"Camera permission denied":i?.message||"Camera access failed";return p(y=>({...y,camera:m})),k("camera","failed"),!1}},[]),ee=n.useCallback(async()=>{k("microphone","running"),p(i=>({...i,microphone:""}));try{try{G.current?.getTracks().forEach(m=>m.stop())}catch{}const i=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});G.current=i,D(m=>({...m,microphoneAccess:!0})),await ue(i);try{const m=kt(i);Z.current=m;const y=()=>{b(m.getLevel()),U.current=requestAnimationFrame(y)};U.current=requestAnimationFrame(y)}catch{}return k("microphone","passed"),!0}catch(i){const m=i?.name==="NotAllowedError"?"Microphone permission denied":i?.message||"Microphone access failed";return p(y=>({...y,microphone:m})),k("microphone","failed"),!1}},[]),le=n.useCallback(async()=>{k("face","running"),p(i=>({...i,face:""}));try{if(!N.current)throw new Error("Camera is not initialized");const i=await oe(N.current);if(D(m=>({...m,faceDetection:i})),i.status)return k("face","passed"),!0;throw new Error("No face detected. Please align your face within the frame and retry.")}catch(i){const m=i?.message||"Face detection failed";return p(y=>({...y,face:m})),k("face","failed"),!1}},[]),xe=n.useCallback(async()=>{k("monitor","running"),p(i=>({...i,monitor:""}));try{const i=await Q();if(i&&i>1)throw D(m=>({...m,monitorCount:i})),new Error("Multiple displays detected. Please remove external screens and keep only one display connected, then press Retry.");if(i===1)return D(m=>({...m,monitorCount:i})),k("monitor","passed"),!0;throw new Error("Could not verify displays")}catch(i){return p(m=>({...m,monitor:i?.message||"Monitor verification failed"})),k("monitor","failed"),!1}},[]),te=n.useCallback(async()=>{k("browser","running"),p(i=>({...i,browser:""}));try{const i=q();if(D(m=>({...m,browserSupport:i})),!i)throw new Error("Required browser features are unavailable");return k("browser","passed"),!0}catch(i){return p(m=>({...m,browser:i?.message||"Browser not supported"})),k("browser","failed"),!1}},[]),K={camera:V,microphone:ee,face:le,monitor:xe,browser:te},ae=n.useCallback(async i=>{for(let m=i;m<c.length;m++){const y=c[m];if(!await K[y]())break}},[K]);n.useEffect(()=>{if(!c.every(y=>w[y]==="passed"))return;const m={cameraAccess:!!C.cameraAccess,microphoneAccess:!!C.microphoneAccess,faceDetection:C.faceDetection||{status:!1,confidence:0,timestamp:Date.now()},monitorCount:C.monitorCount||1,browserSupport:!!C.browserSupport,codeEditorReady:!0};o(m),P()},[w,C]),n.useEffect(()=>(ae(0),()=>P()),[]);const Te=i=>{const m=c.indexOf(i);R(y=>{const I={...y};for(let O=m;O<c.length;O++)I[c[O]]="pending";return I}),p(y=>({...y,[i]:""})),ae(m)},_e=c.filter(i=>w[i]==="passed").length,Se=c.some(i=>w[i]==="running"),Re=Math.round((_e+(Se?.5:0))/c.length*100);return d.jsx("div",{style:{fontFamily:"system-ui, sans-serif",minHeight:"100vh",display:"grid",placeItems:"center",background:"linear-gradient(135deg,#eff6ff,#eef2ff)"},children:d.jsxs("div",{style:{width:720,maxWidth:"95vw",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16,boxShadow:"0 8px 24px rgba(0,0,0,0.08)"},children:[d.jsxs("div",{style:{textAlign:"center",marginBottom:12},children:[d.jsx("h2",{style:{margin:0,fontSize:20,fontWeight:700},children:"System Pre-Check"}),d.jsx("p",{style:{color:"#6b7280"},children:"Verifying your system for proctored assessment"})]}),d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12},children:[d.jsx("span",{children:"Overall Progress"}),d.jsxs("span",{children:[Re,"%"]})]}),d.jsx("div",{style:{height:8,background:"#f3f4f6",borderRadius:9999,overflow:"hidden"},children:d.jsx("div",{style:{width:`${Re}%`,height:8,background:"#3b82f6"}})})]}),d.jsx("div",{style:{display:"grid",gap:8},children:c.map(i=>{const m=i==="camera"?"Camera Access":i==="microphone"?"Microphone Access":i==="face"?"Face Detection":i==="monitor"?"Single Monitor Check":"Browser Support",y=w[i],I=y==="passed"?"#ecfdf5":y==="running"?"#eff6ff":y==="failed"?"#fef2f2":"#f9fafb",O=y==="passed"?"#10b981":y==="running"?"#3b82f6":y==="failed"?"#dc2626":"#9ca3af";return d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"16px 1fr auto",gap:12,alignItems:"center",padding:12,borderRadius:8,border:"1px solid #e5e7eb",background:I},children:[d.jsx("div",{style:{width:12,height:12,borderRadius:9999,background:O}}),d.jsxs("div",{style:{minWidth:0},children:[d.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:d.jsx("div",{style:{fontWeight:600,fontSize:14},children:m})}),i==="face"&&d.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:8},children:[d.jsx("video",{ref:W,muted:!0,playsInline:!0,autoPlay:!0,style:{width:180,height:112,background:"#000",borderRadius:6}}),y==="running"&&d.jsxs("div",{style:{color:"#6b7280",fontSize:12},children:["Analyzing frames: ",j]})]}),i==="microphone"&&y!=="pending"&&d.jsx("div",{style:{marginTop:6,width:220,height:8,background:"#e5e7eb",borderRadius:9999,overflow:"hidden"},children:d.jsx("div",{style:{width:`${Math.min(100,Math.round(_*200))}%`,height:8,background:"#10b981",transition:"width 150ms"}})}),B[i]&&d.jsx("div",{style:{marginTop:6,color:"#dc2626",fontSize:12},children:B[i]})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[d.jsx("div",{style:{fontSize:12,padding:"2px 8px",borderRadius:9999,background:y==="passed"?"#111827":y==="failed"?"#fee2e2":"#e5e7eb",color:y==="passed"?"#fff":"#111827"},children:y==="passed"?"Passed":y==="running"?"Checkingâ€¦":y==="failed"?"Failed":"Pending"}),y==="failed"&&d.jsx("button",{onClick:()=>Te(i),style:{fontSize:12,padding:"6px 10px",borderRadius:6,background:"#111827",color:"#fff",border:0},children:"Retry"})]})]},i)})})]})})}function Ft(o){const{onEvent:h,context:c="coding"}=o||{},[w,R]=n.useState("idle"),[j,A]=n.useState(void 0),[_,b]=n.useState(0),[B,p]=n.useState(0),C=n.useRef(null),D=n.useRef(null),N=n.useRef(null),G=n.useRef(!1),Z=n.useRef(0),U=n.useRef(0),W=n.useRef(null),P=n.useCallback(()=>{N.current&&cancelAnimationFrame(N.current),N.current=null;try{C.current?.dispose()}catch{}C.current=null;try{D.current?.getTracks().forEach(q=>q.stop())}catch{}D.current=null,R("idle")},[]),ue=n.useCallback(q=>{const k=Date.now(),V=G.current;q>18&&k-Z.current>2e3&&(p(ee=>ee+1),Z.current=k,h?.({eventType:"audio_anomaly",severity:"warning",context:c,data:{level:q,reason:"audio_spike",faceDetected:V}})),V&&q<3?W.current==null?W.current=k:k-W.current>15e3&&(p(ee=>ee+1),W.current=null,h?.({eventType:"audio_anomaly",severity:"warning",context:c,data:{level:q,reason:"extended_silence_with_face"}})):q>=3&&(W.current=null),!V&&q>12&&k-U.current>3e3&&(p(ee=>ee+1),U.current=k,h?.({eventType:"audio_anomaly",severity:"warning",context:c,data:{level:q,reason:"audio_without_face"}}))},[c,h]),oe=n.useCallback(()=>{try{if(!C.current)return;const q=C.current.getLevel(),k=Math.max(0,Math.min(100,Math.round(q*160)));b(k),ue(k)}finally{N.current=requestAnimationFrame(oe)}},[ue]),he=n.useCallback(async q=>{try{A(void 0),p(0),Z.current=0,U.current=0,W.current=null;let k=q;if(!k&&typeof window<"u"&&window.precheckAudioStream){const le=window.precheckAudioStream;le?.active&&le.getAudioTracks().length>0&&(k=le)}k||(k=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:44100}})),D.current=k;const V=k.getAudioTracks(),ee=V.length?new MediaStream(V):k;C.current=kt(ee),R("running"),N.current=requestAnimationFrame(oe)}catch(k){R("error"),A(k instanceof Error?k.message:String(k))}},[oe]),Q=n.useCallback(q=>{G.current=q},[]);return n.useEffect(()=>P,[P]),{status:w,error:j,level:_,anomalyCount:B,start:he,stop:P,setFaceDetected:Q}}function _t({monitoringStatus:o,sessionData:h,onStatusChange:c,onUpdateSession:w,onAddEvent:R,onAddSnapshot:j}){const[A,_]=n.useState({x:typeof window<"u"?window.innerWidth-280:0,y:typeof window<"u"?window.innerHeight-400:0}),[b,B]=n.useState(!1),[p,C]=n.useState({x:0,y:0}),[D,N]=n.useState(0),[G,Z]=n.useState(!1),[U,W]=n.useState(null),[P,ue]=n.useState(null),[oe,he]=n.useState(null),[Q,q]=n.useState(0),[k,V]=n.useState(0),[ee,le]=n.useState([]),[xe,te]=n.useState(0),[K,ae]=n.useState(0),[Te,_e]=n.useState(0),[Se,Re]=n.useState(0),[i,m]=n.useState(0),[y,I]=n.useState(!1),[O,me]=n.useState(null),[se,ne]=n.useState(null),[ze,Le]=n.useState(0),[We,Xe]=n.useState(0),[Ne,pt]=n.useState(0),[Ze,Ce]=n.useState(null),[pe,Qe]=n.useState(0),[gt,Me]=n.useState(0),ie=n.useRef(null),je=n.useRef(null),Ae=n.useRef(null),qe=n.useRef(null),ge=n.useRef(null),Ee=n.useRef(null),et=n.useRef(!1),Be=n.useRef(0),tt=n.useRef(0),ye=n.useRef("none");n.useRef({noFace:0,multipleFaces:0});const re=n.useRef({noFace:!1,multipleFaces:!1,gazeOff:!1}),De=n.useRef([]),Ye=n.useRef(0),Fe=n.useRef(!1),J=n.useRef({yaw:0,pitch:0,roll:0,initialized:!1}),$=n.useRef({isGood:!0,goodStreak:0,poorStreak:0}),nt=8,ve=.25,{level:Oe,anomalyCount:$e,start:we,stop:Ge,setFaceDetected:Pe}=Ft({context:"coding",onEvent:t=>R?.({...t,timestamp:Date.now()})});n.useEffect(()=>q(Oe),[Oe]),n.useEffect(()=>V($e),[$e]);const Ue=n.useCallback((t,s)=>{const a=t.data;let f=0,u=0,g=0;for(let S=0;S<a.length;S+=4){const L=a[S],H=a[S+1],X=a[S+2],Y=(L+H+X)/3;if(f+=Y,S>0){const ce=(a[S-4]+a[S-3]+a[S-2])/3;u+=Math.abs(Y-ce)}if(S>t.width*4&&S<a.length-t.width*4){const ce=(a[S-t.width*4]+a[S-t.width*4+1]+a[S-t.width*4+2])/3,Ie=(a[S+t.width*4]+a[S+t.width*4+1]+a[S+t.width*4+2])/3;(Math.abs(Y-ce)>30||Math.abs(Y-Ie)>30)&&g++}}const x=a.length/4;f/=x,u/=x;const E=g/x,F=s.width/s.height,T={neutral:Math.max(.1,.6-Math.abs(f-120)/200-Math.abs(u-15)/100),happy:Math.max(.05,(f>115?.4:.1)+(E>.15?.3:0)+(F>.85?.2:0)),focused:Math.max(.05,(u>20?.4:.1)+(E>.12?.2:0)+(f<110?.2:0)),concerned:Math.max(.05,(f<105?.3:.1)+(u>25?.2:0)+(F<.75?.2:0)),surprised:Math.max(.05,(F>.9?.3:.1)+(E>.18?.3:0))},M=Date.now()%1e4/1e4;Object.keys(T).forEach(S=>{const L=S;T[L]+=Math.sin(M*Math.PI*2)*.1,T[L]=Math.max(.05,Math.min(.95,T[L]))});const z=Object.entries(T).reduce((S,L)=>T[S[0]]>T[L[0]]?S:L)[0],v=Math.max(...Object.values(T));return{dominant:z,confidence:v,emotions:T}},[]),rt=n.useCallback((t,s)=>{const a=s.data;let f=0,u=0,g=0;const x=Math.floor(s.height*.6);for(let v=Math.floor(s.height*.3);v<x;v++)for(let S=0;S<s.width;S+=4){const L=(v*s.width+S)*4,H=a[L],X=a[L+1],Y=a[L+2];(H+X+Y)/3<100?f++:u++,(Math.abs(H-X)>30||Math.abs(X-Y)>30)&&g++}const E=f+u,F=E?f/E:0,T=E?g/E:0,M=F>.4&&T<.3,z=F>.2;return{isProfessional:M,hasShirt:z,confidence:.7,details:M?"Professional attire detected":"Casual attire detected"}},[]),Ve=n.useCallback((t,s,a)=>{const f=t.x+t.width/2,u=t.y+t.height/2,g=(f-s/2)/s,x=(u-a/2)/a,E=Math.sqrt(g*g+x*x),F=E<.15,T=Math.max(0,1-E*2);return{isLookingAtCamera:F,gazeDirection:{x:g,y:x},confidence:.8,attentionScore:T}},[]),ot=n.useCallback(t=>{if(!t.landmarks||t.landmarks.length<4)return null;const s=t.landmarks,a=s[0],f=s[1],u=s[2],g=s[3]??[(f[0]+a[0])/2,Math.max(f[1],a[1])+t.height*.2],x=[(f[0]+a[0])/2,(f[1]+a[1])/2],E=f[0]-a[0],F=f[1]-a[1],T=Math.max(1,Math.hypot(E,F)),M=Math.atan2(F,E)*180/Math.PI,z=Math.hypot(u[0]-a[0],u[1]-a[1]),v=Math.hypot(u[0]-f[0],u[1]-f[1]),S=(z-v)/T,L=Math.max(-45,Math.min(45,S*90)),H=Math.max(1,u[1]-x[1]),X=Math.max(1,(g[1]??x[1])-u[1]),Y=(H-X)/t.height,ce=Math.max(-45,Math.min(45,Y*180)),Ie=Math.abs(M)>20,wt=Math.abs(S)>.18,He=Math.abs(ce)>15,lt=wt||He||Ie,ft=Math.max(.5,Math.min(1,Math.max(Math.abs(S)*2,Math.abs(M)/30,Math.abs(ce)/30)));return{yaw:L,pitch:ce,roll:M,isHeadTurned:lt,confidence:ft}},[]),fe=n.useCallback((t=.8)=>{const s=ie.current,a=je.current;if(!s||!a)return null;const f=s.videoWidth||320,u=s.videoHeight||240;if(s.readyState<2)return null;a.width=f,a.height=u;const g=a.getContext("2d");if(!g)return null;g.drawImage(s,0,0,f,u);try{return a.toDataURL("image/jpeg",t)}catch{return null}},[]),de=n.useCallback(t=>{if(j){j(t);return}if(w){let a=[...h?.snapshots||[],t];a.length>50&&(a=a.slice(a.length-50)),w({snapshots:a})}},[j,w,h?.snapshots]),yt=n.useCallback(()=>{if(Ye.current>=5||Fe.current)return;Fe.current=!0;const t=fe(.85);if(t){de({timestamp:Date.now(),type:"random_webcam",image:t,context:"Random webcam snapshot during coding"}),Ye.current+=1,Fe.current=!1;return}const s=window.setTimeout(()=>{const a=fe(.85);a&&(de({timestamp:Date.now(),type:"random_webcam",image:a,context:"Random webcam snapshot (retry) during coding"}),Ye.current+=1),Fe.current=!1},3e3);De.current.push(s)},[de,fe]),at=n.useCallback((t,s)=>{const{gazeDirection:a,attentionScore:f,isLookingAtCamera:u}=t,g=Math.sqrt(a.x*a.x+a.y*a.y),x=!u&&g>.5&&f<.3;return s&&s.isHeadTurned&&s.confidence>=.6?!0:x},[]),st=n.useCallback(async()=>{try{const t=await Promise.resolve().then(()=>require("./index-x7BUnCGZ.cjs")),s=await Promise.resolve().then(()=>require("./blazeface.esm-BsJ4BrW4.cjs"));t.ready&&await t.ready();const a=await s.load();return qe.current=a,!0}catch(t){return console.error("[widget] Failed to init face detection:",t),!1}},[]),ke=n.useCallback(async()=>{if(!ie.current||!je.current||!qe.current){ge.current=requestAnimationFrame(ke);return}const t=ie.current,s=je.current;if(t.readyState!==4){ge.current=requestAnimationFrame(ke);return}try{const a=await qe.current.estimateFaces(t,!1),f=t.videoWidth||t.width||s.width,u=t.videoHeight||t.height||s.height,g=Math.max(6,Math.floor(f*.06)),x=Math.max(6,Math.floor(u*.06)),E=.04,F=.65,T=a.map(v=>{const[S,L]=v.topLeft,[H,X]=v.bottomRight;return{x:S,y:L,width:H-S,height:X-L,confidence:v.probability?.[0]||.8,landmarks:v.landmarks}}).filter(v=>{if(v.width<=0||v.height<=0||v.x<g||v.y<x||v.x+v.width>f-g||v.y+v.height>u-x)return!1;const L=v.width*v.height/(f*u);if(L<E||L>F)return!1;const H=v.width/v.height;return!(H<.6||H>1.6)});N(T.length),le(T),Z(T.length===1),Pe(T.length>0);const M=Date.now();let z=T.length===0?"none":T.length===1?"single":"multiple";if(z==="multiple"){if(ye.current!=="multiple"&&(me(M),pt(v=>v+1),!re.current.multipleFaces)){re.current.multipleFaces=!0,R?.({eventType:"face_detection",severity:"warning",context:"coding",data:{reason:"multiple_faces",count:T.length},timestamp:M});const v=fe(.85);v&&de({timestamp:M,type:"violation_trigger",image:v,context:"Multiple faces detected"})}}else{if(ye.current==="multiple"&&O!==null){const v=M-O;Le(S=>S+v),me(null)}re.current.multipleFaces=!1}if(z==="none"){if(ye.current!=="none"&&(Ce(M),Qe(v=>v+1),!re.current.noFace)){re.current.noFace=!0,R?.({eventType:"face_detection",severity:"critical",context:"coding",data:{reason:"no_face"},timestamp:M});const v=fe(.85);v&&de({timestamp:M,type:"violation_trigger",image:v,context:"No face detected"})}}else{if(ye.current==="none"&&Ze!==null){const v=M-Ze;Me(S=>S+v),Ce(null)}re.current.noFace=!1}if(ye.current=z,T.length===1){const v=T[0],S=s.getContext("2d");if(S){S.drawImage(t,0,0,s.width,s.height);const L=S.getImageData(0,0,s.width,s.height),H=S.getImageData(v.x,v.y,v.width,v.height);let X={isGoodPosture:!0,shoulderAlignment:0,headTilt:0,confidence:.7};const Y=ot(v);if(Y){J.current.initialized?(J.current.yaw=ve*Y.yaw+(1-ve)*J.current.yaw,J.current.pitch=ve*Y.pitch+(1-ve)*J.current.pitch,J.current.roll=ve*Y.roll+(1-ve)*J.current.roll):J.current={yaw:Y.yaw,pitch:Y.pitch,roll:Y.roll,initialized:!0};const be=J.current.yaw,dt=J.current.pitch,xt=J.current.roll,St=Math.abs(xt)<=10&&Math.abs(dt)<=12&&Math.abs(be)<=18;St!==$.current.isGood?St?($.current.goodStreak+=1,$.current.poorStreak=0,$.current.goodStreak>=nt&&($.current.isGood=!0,$.current.goodStreak=0)):($.current.poorStreak+=1,$.current.goodStreak=0,$.current.poorStreak>=nt&&($.current.isGood=!1,$.current.poorStreak=0)):($.current.goodStreak=0,$.current.poorStreak=0),X={isGoodPosture:$.current.isGood,shoulderAlignment:-xt,headTilt:dt,confidence:Math.min(1,.6+.4*Y.confidence)}}const ce=Ue(H,v),Ie=rt(H,L),wt=Ve(v,s.width,s.height),He=Y??ot(v);W(X),ue(ce),he(Ie);const lt=at(wt,He);if(lt&&!y&&Date.now()-tt.current>3e3)m(be=>be+1),I(!0),ne(M),tt.current=Date.now(),re.current.gazeOff||(re.current.gazeOff=!0,R?.({eventType:"gaze_tracking",severity:"warning",context:"coding",data:{offscreen:!0,reason:He?.isHeadTurned?"head_movement":"center_offset",headPose:He},timestamp:M}));else if(!lt&&y){if(se!==null){const be=M-se;Xe(dt=>dt+be),ne(null)}I(!1),re.current.gazeOff=!1}const ft=T.length===0||T.length>1;if(w&&(ft||M-Be.current>=5e3)){if(ft){const be=fe(.85);be&&de({timestamp:M,type:"violation_trigger",image:be,context:T.length===0?"No face detected":"Multiple faces detected"})}w({postureAnalysis:X,attireAnalysis:Ie}),Be.current=M}}}else if(W(null),ue(null),he(null),y){if(se!==null){const v=M-se;Xe(S=>S+v),ne(null)}I(!1)}T.length===0?c?.("violation"):T.length>1?c?.("warning"):c?.("optimal")}catch(a){console.error("[widget] Face detection error:",a)}ge.current=requestAnimationFrame(ke)},[Ue,rt,Ve,at,c,w,h?.snapshots,y,O,se,Pe]);n.useEffect(()=>{V(0)},[]),n.useEffect(()=>{(async()=>{try{const g=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:320},height:{ideal:240},frameRate:{ideal:15}},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});ie.current&&(ie.current.srcObject=g);let x=null;const E=g.getAudioTracks();E.length>0&&(x=new MediaStream(E),Ee.current=x),await st(),x&&await we(x),ge.current=requestAnimationFrame(ke)}catch{c?.("violation")}})();const s=5,a=[60*1e3,5*60*1e3],f=Math.max(0,s-a.length),u=[...a];if(f>0)for(let E=0;E<f;E++){const F=42e4+Math.random()*78e4,T=(Math.random()-.5)*30*1e3;u.push(Math.max(0,Math.floor(F+T)))}u.sort((g,x)=>g-x);for(let g=1;g<u.length;g++)Math.abs(u[g]-u[g-1])<10*1e3&&(u[g]+=12*1e3);return u.forEach(g=>{const x=window.setTimeout(()=>yt(),g);De.current.push(x)}),()=>{et.current=!0,ge.current&&cancelAnimationFrame(ge.current),ie.current?.srcObject&&ie.current.srcObject.getTracks().forEach(x=>x.stop()),Ee.current&&Ee.current.getTracks().forEach(g=>g.stop()),Ge(),Ee.current=null,De.current.forEach(g=>window.clearTimeout(g)),De.current=[]}},[]);const vt=t=>{B(!0);const s=Ae.current?.getBoundingClientRect();s&&C({x:t.clientX-s.left,y:t.clientY-s.top})},it=t=>{if(b){const s=Math.max(0,Math.min((typeof window<"u"?window.innerWidth:0)-280,t.clientX-p.x)),a=Math.max(0,Math.min((typeof window<"u"?window.innerHeight:0)-400,t.clientY-p.y));_({x:s,y:a})}},ct=()=>B(!1);n.useEffect(()=>{if(b)return document.addEventListener("mousemove",it),document.addEventListener("mouseup",ct),()=>{document.removeEventListener("mousemove",it),document.removeEventListener("mouseup",ct)}},[b,p]);const ut=()=>{document.hidden&&ae(t=>{const s=t+1;return R?.({eventType:"tab_switch",severity:"critical",context:"coding",data:{when:Date.now()},timestamp:Date.now()}),s})},e=()=>te(t=>t+1),r=t=>{_e(s=>s+1),R?.({eventType:"keystroke",severity:"info",context:"coding",data:{},timestamp:Date.now()}),(t.ctrlKey||t.metaKey)&&(t.key==="c"||t.key==="x"||t.key==="v")&&(Re(s=>s+1),t.preventDefault(),R?.({eventType:"keystroke",severity:"warning",context:"coding",data:{copyCutPaste:!0,key:t.key},timestamp:Date.now()}))};n.useEffect(()=>(document.addEventListener("visibilitychange",ut),window.addEventListener("blur",e),document.addEventListener("keydown",r),()=>{document.removeEventListener("visibilitychange",ut),window.removeEventListener("blur",e),document.removeEventListener("keydown",r)}),[]);const l=D===0?"#ef4444":D>1?"#f59e0b":"#22c55e";return d.jsxs("div",{ref:Ae,onMouseDown:vt,style:{position:"fixed",left:A.x,top:A.y,zIndex:9999,width:288,cursor:"move",border:`2px solid ${l}`,borderRadius:8,background:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.2)",padding:12,userSelect:"none"},children:[d.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:d.jsx("div",{style:{fontSize:12,fontWeight:600},children:D===0?"No Face":D>1?"Multiple Faces":G?"Optimal":"Good"})}),d.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:4,overflow:"hidden"},children:[d.jsx("video",{ref:ie,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:128,objectFit:"cover"}}),d.jsx("canvas",{ref:je,width:320,height:240,style:{display:"none"}})]}),d.jsxs("div",{style:{marginTop:8,fontSize:12,display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[d.jsxs("div",{children:["Faces: ",d.jsx("strong",{style:{color:D===1?"#16a34a":"#ef4444"},children:D})]}),d.jsxs("div",{children:["No Face: ",d.jsx("strong",{style:{color:pe>0?"#ef4444":"#16a34a"},children:pe})]}),d.jsxs("div",{children:["Multiple: ",d.jsx("strong",{style:{color:Ne>0?"#ef4444":"#16a34a"},children:Ne})]}),d.jsxs("div",{children:["Posture: ",d.jsx("strong",{style:{color:U?.isGoodPosture?"#16a34a":"#f59e0b"},children:U?.isGoodPosture?"Good":"Poor"})]}),d.jsxs("div",{children:["Attire: ",d.jsx("strong",{style:{color:oe?.isProfessional?"#16a34a":"#f59e0b"},children:oe?.isProfessional?"Professional":"Casual"})]}),d.jsxs("div",{children:["Emotion: ",d.jsx("strong",{style:{color:"#3b82f6"},children:P?.dominant||"Unknown"})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:["Audio: ",d.jsxs("span",{style:{color:Q>50?"#16a34a":Q>20?"#f59e0b":"#ef4444"},children:[Q,"%"]}),d.jsx("div",{style:{width:64,height:6,background:"#eee",borderRadius:9999,overflow:"hidden"},children:d.jsx("div",{style:{width:`${Math.min(Q,100)}%`,height:6,transition:"width 100ms",background:Q>50?"#16a34a":Q>20?"#f59e0b":"#ef4444"}})})]}),d.jsxs("div",{children:["Audio Alerts: ",d.jsx("strong",{style:{color:k>0?"#ef4444":"#16a34a"},children:k})]}),d.jsxs("div",{children:["Unfocus: ",d.jsx("strong",{style:{color:xe>0?"#ef4444":"#16a34a"},children:xe})]}),d.jsxs("div",{children:["Tab Switch: ",d.jsx("strong",{style:{color:K>0?"#ef4444":"#16a34a"},children:K})]}),d.jsxs("div",{children:["Keystrokes: ",d.jsx("strong",{style:{color:"#3b82f6"},children:Te})]}),d.jsxs("div",{children:["Copy Attempts: ",d.jsx("strong",{style:{color:Se>0?"#ef4444":"#16a34a"},children:Se})]}),d.jsxs("div",{children:["Gaze Off: ",d.jsx("strong",{style:{color:i>0?"#ef4444":"#16a34a"},children:i})]})]})]})}const mt=(o,h)=>o.length>h?o.slice(o.length-h):o,Ot=(o,h)=>({sessionId:o,sessionType:"coding-assessment",startTime:Date.now(),preCheckResults:h,liveEvents:[],codingMetrics:{totalKeystrokes:0,linesOfCode:0,codeExecutions:0,externalCopyEvents:0,languageSwitches:0,averageTypingSpeed:0,codingTimeVsReadingTime:{coding:0,reading:0}},questionProgress:[],snapshots:[],sessionStats:{totalDuration:0,questionsAttempted:0,violationCount:0,tabSwitches:0,audioAnomalies:0,gazeDuration:0,focusBreaks:0,codeExecutionCount:0,noFaceIncidents:0,multipleFaceIncidents:0,unfocusEvents:0,gazeOffScreenIncidents:0,keystrokes:0,copyCutPasteAttempts:0}});function Pt(o,h){switch(h.eventType){case"tab_switch":return{...o,tabSwitches:o.tabSwitches+1,violationCount:o.violationCount+1};case"audio_anomaly":return{...o,audioAnomalies:o.audioAnomalies+1,violationCount:o.violationCount+1};case"code_execution":return{...o,codeExecutionCount:o.codeExecutionCount+1};case"face_detection":{const c=h.data?.reason;return c==="no_face"?{...o,noFaceIncidents:o.noFaceIncidents+1,violationCount:o.violationCount+1}:c==="multiple_faces"?{...o,multipleFaceIncidents:o.multipleFaceIncidents+1,violationCount:o.violationCount+1}:o}case"gaze_tracking":{const c=h.data?.type==="focus_break",w=Number(h.data?.focusTimeMs)||0,R=h.data?.offscreen===!0;return{...o,focusBreaks:o.focusBreaks+(c?1:0),gazeDuration:o.gazeDuration+w,unfocusEvents:o.unfocusEvents+(c?1:0),gazeOffScreenIncidents:o.gazeOffScreenIncidents+(R?1:0),violationCount:o.violationCount+(c||R?1:0)}}case"keystroke":{const c=h.data?.copyCutPaste===!0;return{...o,keystrokes:o.keystrokes+1,copyCutPasteAttempts:o.copyCutPasteAttempts+(c?1:0),violationCount:o.violationCount+(c?1:0)}}default:return o}}function It(o,h){switch(h.type){case"INIT":return{...h.payload};case"SET_FIELDS":{const c={...o,...h.payload};return c.snapshots&&(c.snapshots=mt(c.snapshots,50)),c.liveEvents&&(c.liveEvents=mt(c.liveEvents,200)),c}case"ADD_EVENTS":{const c=mt([...o.liveEvents,...h.events],200),w=h.events.reduce(Pt,o.sessionStats);return{...o,liveEvents:c,sessionStats:w}}case"ADD_SNAPSHOT":{const c=mt([...o.snapshots,h.snapshot],50);return{...o,snapshots:c}}case"TICK":{const c=Math.max(0,h.now-o.startTime);return c===o.sessionStats.totalDuration?o:{...o,sessionStats:{...o.sessionStats,totalDuration:c}}}case"COMPLETE":{const c=h.endTime??Date.now();return{...o,sessionStats:{...o.sessionStats,totalDuration:Math.max(0,c-o.startTime)}}}default:return o}}function zt(o){const[h,c]=n.useState(null),w=n.useCallback(p=>{c(C=>C&&It(C,p))},[]),R=n.useRef(null),j=n.useRef(0),A=n.useRef(null),_=n.useCallback(p=>{const C=`session_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;R.current=C;const D=sessionStorage.getItem(C);if(D)try{const G=JSON.parse(D);return c(G),C}catch{}const N=Ot(C,p);return c(N),sessionStorage.setItem(C,JSON.stringify(N)),C},[o?.sessionId]),b=n.useCallback(p=>{const C=p??h;if(!(!C||!R.current))try{sessionStorage.setItem(R.current,JSON.stringify(C)),j.current=Date.now()}catch(D){console.error("[session] persist failed",D)}},[h]);return n.useEffect(()=>{if(!h)return;const C=Date.now()-j.current;return C<1e3?(A.current&&clearTimeout(A.current),A.current=setTimeout(()=>b(),1e3-C)):b(),()=>{A.current&&clearTimeout(A.current)}},[h,b]),n.useEffect(()=>{const p=()=>b();return window.addEventListener("visibilitychange",p),window.addEventListener("beforeunload",p),()=>{window.removeEventListener("visibilitychange",p),window.removeEventListener("beforeunload",p)}},[b]),n.useEffect(()=>{if(!h)return;const p=setInterval(()=>w({type:"TICK",now:Date.now()}),1e3);return()=>clearInterval(p)},[h,w]),n.useMemo(()=>({state:h,sessionId:R.current,init:_,setFields:p=>w({type:"SET_FIELDS",payload:p}),addEvents:p=>w({type:"ADD_EVENTS",events:p}),addSnapshot:p=>w({type:"ADD_SNAPSHOT",snapshot:p}),complete:()=>w({type:"COMPLETE"})}),[h,w,_])}function Lt({onSessionStart:o,onSessionUpdate:h,onEvent:c}){const[w,R]=n.useState(null),[j,A]=n.useState("optimal"),_=zt();return n.useEffect(()=>{if(w&&!_.state){const b=_.init(w);o?.(b,w)}},[w,_]),w?d.jsx(_t,{monitoringStatus:j,sessionData:_.state??void 0,onStatusChange:b=>A(b),onUpdateSession:b=>{_.setFields(b),h?.(b)},onAddSnapshot:b=>_.addSnapshot(b),onAddEvent:b=>{_.addEvents([{...b,timestamp:b.timestamp??Date.now()}]),c?.(b)}}):d.jsx(Tt,{onComplete:b=>R(b),onError:()=>R(null)})}exports.FloatingVideo=_t;exports.Prechecks=Tt;exports.ProctoringWidget=Lt;
