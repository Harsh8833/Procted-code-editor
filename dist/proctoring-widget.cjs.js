"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const n=require("react");var st={exports:{}},Le={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ct;function mt(){if(ct)return Le;ct=1;var s=n,d=Symbol.for("react.element"),a=Symbol.for("react.fragment"),v=Object.prototype.hasOwnProperty,S=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,W={key:!0,ref:!0,__self:!0,__source:!0};function z(j,y,$){var h,w={},N=null,L=null;$!==void 0&&(N=""+$),y.key!==void 0&&(N=""+y.key),y.ref!==void 0&&(L=y.ref);for(h in y)v.call(y,h)&&!W.hasOwnProperty(h)&&(w[h]=y[h]);if(j&&j.defaultProps)for(h in y=j.defaultProps,y)w[h]===void 0&&(w[h]=y[h]);return{$$typeof:d,type:j,key:N,ref:L,props:w,_owner:S.current}}return Le.Fragment=a,Le.jsx=z,Le.jsxs=z,Le}var We={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ut;function gt(){return ut||(ut=1,process.env.NODE_ENV!=="production"&&function(){var s=n,d=Symbol.for("react.element"),a=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),j=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),h=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),L=Symbol.for("react.offscreen"),Y=Symbol.iterator,U="@@iterator";function X(e){if(e===null||typeof e!="object")return null;var t=Y&&e[Y]||e[U];return typeof t=="function"?t:null}var q=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function D(e){{for(var t=arguments.length,o=new Array(t>1?t-1:0),l=1;l<t;l++)o[l-1]=arguments[l];K("error",e,o)}}function K(e,t,o){{var l=q.ReactDebugCurrentFrame,x=l.getStackAddendum();x!==""&&(t+="%s",o=o.concat([x]));var E=o.map(function(u){return String(u)});E.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,E)}}var Q=!1,ce=!1,ue=!1,A=!1,P=!1,J;J=Symbol.for("react.module.reference");function F(e){return!!(typeof e=="string"||typeof e=="function"||e===v||e===W||P||e===S||e===$||e===h||A||e===L||Q||ce||ue||typeof e=="object"&&e!==null&&(e.$$typeof===N||e.$$typeof===w||e.$$typeof===z||e.$$typeof===j||e.$$typeof===y||e.$$typeof===J||e.getModuleId!==void 0))}function le(e,t,o){var l=e.displayName;if(l)return l;var x=t.displayName||t.name||"";return x!==""?o+"("+x+")":o}function Ee(e){return e.displayName||"Context"}function Z(e){if(e==null)return null;if(typeof e.tag=="number"&&D("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case v:return"Fragment";case a:return"Portal";case W:return"Profiler";case S:return"StrictMode";case $:return"Suspense";case h:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case j:var t=e;return Ee(t)+".Consumer";case z:var o=e;return Ee(o._context)+".Provider";case y:return le(e,e.render,"ForwardRef");case w:var l=e.displayName||null;return l!==null?l:Z(e.type)||"Memo";case N:{var x=e,E=x._payload,u=x._init;try{return Z(u(E))}catch{return null}}}return null}var ee=Object.assign,re=0,ge,ye,Ce,ve,Re,de,r;function c(){}c.__reactDisabledLog=!0;function f(){{if(re===0){ge=console.log,ye=console.info,Ce=console.warn,ve=console.error,Re=console.group,de=console.groupCollapsed,r=console.groupEnd;var e={configurable:!0,enumerable:!0,value:c,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}re++}}function M(){{if(re--,re===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:ee({},e,{value:ge}),info:ee({},e,{value:ye}),warn:ee({},e,{value:Ce}),error:ee({},e,{value:ve}),group:ee({},e,{value:Re}),groupCollapsed:ee({},e,{value:de}),groupEnd:ee({},e,{value:r})})}re<0&&D("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var T=q.ReactCurrentDispatcher,V;function te(e,t,o){{if(V===void 0)try{throw Error()}catch(x){var l=x.stack.trim().match(/\n( *(at )?)/);V=l&&l[1]||""}return`
`+V+e}}var oe=!1,ke;{var it=typeof WeakMap=="function"?WeakMap:Map;ke=new it}function Te(e,t){if(!e||oe)return"";{var o=ke.get(e);if(o!==void 0)return o}var l;oe=!0;var x=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var E;E=T.current,T.current=null,f();try{if(t){var u=function(){throw Error()};if(Object.defineProperty(u.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(u,[])}catch(H){l=H}Reflect.construct(e,[],u)}else{try{u.call()}catch(H){l=H}e.call(u.prototype)}}else{try{throw Error()}catch(H){l=H}e()}}catch(H){if(H&&l&&typeof H.stack=="string"){for(var p=H.stack.split(`
`),I=l.stack.split(`
`),k=p.length-1,C=I.length-1;k>=1&&C>=0&&p[k]!==I[C];)C--;for(;k>=1&&C>=0;k--,C--)if(p[k]!==I[C]){if(k!==1||C!==1)do if(k--,C--,C<0||p[k]!==I[C]){var B=`
`+p[k].replace(" at new "," at ");return e.displayName&&B.includes("<anonymous>")&&(B=B.replace("<anonymous>",e.displayName)),typeof e=="function"&&ke.set(e,B),B}while(k>=1&&C>=0);break}}}finally{oe=!1,T.current=E,M(),Error.prepareStackTrace=x}var me=e?e.displayName||e.name:"",xe=me?te(me):"";return typeof e=="function"&&ke.set(e,xe),xe}function Ne(e,t,o){return Te(e,!1)}function et(e){var t=e.prototype;return!!(t&&t.isReactComponent)}function we(e,t,o){if(e==null)return"";if(typeof e=="function")return Te(e,et(e));if(typeof e=="string")return te(e);switch(e){case $:return te("Suspense");case h:return te("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case y:return Ne(e.render);case w:return we(e.type,t,o);case N:{var l=e,x=l._payload,E=l._init;try{return we(E(x),t,o)}catch{}}}return""}var fe=Object.prototype.hasOwnProperty,je={},qe=q.ReactDebugCurrentFrame;function De(e){if(e){var t=e._owner,o=we(e.type,e._source,t?t.type:null);qe.setExtraStackFrame(o)}else qe.setExtraStackFrame(null)}function tt(e,t,o,l,x){{var E=Function.call.bind(fe);for(var u in e)if(E(e,u)){var p=void 0;try{if(typeof e[u]!="function"){var I=Error((l||"React class")+": "+o+" type `"+u+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[u]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw I.name="Invariant Violation",I}p=e[u](t,u,l,o,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(k){p=k}p&&!(p instanceof Error)&&(De(x),D("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",l||"React class",o,u,typeof p),De(null)),p instanceof Error&&!(p.message in je)&&(je[p.message]=!0,De(x),D("Failed %s type: %s",o,p.message),De(null))}}}var ae=Array.isArray;function be(e){return ae(e)}function $e(e){{var t=typeof Symbol=="function"&&Symbol.toStringTag,o=t&&e[Symbol.toStringTag]||e.constructor.name||"Object";return o}}function Ae(e){try{return se(e),!1}catch{return!0}}function se(e){return""+e}function Se(e){if(Ae(e))return D("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",$e(e)),se(e)}var Be=q.ReactCurrentOwner,Ye={key:!0,ref:!0,__self:!0,__source:!0},Fe,he;function ne(e){if(fe.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return e.ref!==void 0}function Ue(e){if(fe.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return e.key!==void 0}function Ve(e,t){typeof e.ref=="string"&&Be.current}function nt(e,t){{var o=function(){Fe||(Fe=!0,D("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};o.isReactWarning=!0,Object.defineProperty(e,"key",{get:o,configurable:!0})}}function rt(e,t){{var o=function(){he||(he=!0,D("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};o.isReactWarning=!0,Object.defineProperty(e,"ref",{get:o,configurable:!0})}}var Ge=function(e,t,o,l,x,E,u){var p={$$typeof:d,type:e,key:t,ref:o,props:u,_owner:E};return p._store={},Object.defineProperty(p._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(p,"_self",{configurable:!1,enumerable:!1,writable:!1,value:l}),Object.defineProperty(p,"_source",{configurable:!1,enumerable:!1,writable:!1,value:x}),Object.freeze&&(Object.freeze(p.props),Object.freeze(p)),p};function Ke(e,t,o,l,x){{var E,u={},p=null,I=null;o!==void 0&&(Se(o),p=""+o),Ue(t)&&(Se(t.key),p=""+t.key),ne(t)&&(I=t.ref,Ve(t,x));for(E in t)fe.call(t,E)&&!Ye.hasOwnProperty(E)&&(u[E]=t[E]);if(e&&e.defaultProps){var k=e.defaultProps;for(E in k)u[E]===void 0&&(u[E]=k[E])}if(p||I){var C=typeof e=="function"?e.displayName||e.name||"Unknown":e;p&&nt(u,C),I&&rt(u,C)}return Ge(e,p,I,x,l,Be.current,u)}}var _e=q.ReactCurrentOwner,Oe=q.ReactDebugCurrentFrame;function ie(e){if(e){var t=e._owner,o=we(e.type,e._source,t?t.type:null);Oe.setExtraStackFrame(o)}else Oe.setExtraStackFrame(null)}var Pe;Pe=!1;function pe(e){return typeof e=="object"&&e!==null&&e.$$typeof===d}function Je(){{if(_e.current){var e=Z(_e.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function He(e){return""}var Me={};function Xe(e){{var t=Je();if(!t){var o=typeof e=="string"?e:e.displayName||e.name;o&&(t=`

Check the top-level render call using <`+o+">.")}return t}}function Ie(e,t){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var o=Xe(t);if(Me[o])return;Me[o]=!0;var l="";e&&e._owner&&e._owner!==_e.current&&(l=" It was passed a child from "+Z(e._owner.type)+"."),ie(e),D('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',o,l),ie(null)}}function ze(e,t){{if(typeof e!="object")return;if(be(e))for(var o=0;o<e.length;o++){var l=e[o];pe(l)&&Ie(l,t)}else if(pe(e))e._store&&(e._store.validated=!0);else if(e){var x=X(e);if(typeof x=="function"&&x!==e.entries)for(var E=x.call(e),u;!(u=E.next()).done;)pe(u.value)&&Ie(u.value,t)}}}function ot(e){{var t=e.type;if(t==null||typeof t=="string")return;var o;if(typeof t=="function")o=t.propTypes;else if(typeof t=="object"&&(t.$$typeof===y||t.$$typeof===w))o=t.propTypes;else return;if(o){var l=Z(t);tt(o,e.props,"prop",l,e)}else if(t.PropTypes!==void 0&&!Pe){Pe=!0;var x=Z(t);D("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",x||"Unknown")}typeof t.getDefaultProps=="function"&&!t.getDefaultProps.isReactClassApproved&&D("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function m(e){{for(var t=Object.keys(e.props),o=0;o<t.length;o++){var l=t[o];if(l!=="children"&&l!=="key"){ie(e),D("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",l),ie(null);break}}e.ref!==null&&(ie(e),D("Invalid attribute `ref` supplied to `React.Fragment`."),ie(null))}}var g={};function b(e,t,o,l,x,E){{var u=F(e);if(!u){var p="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(p+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var I=He();I?p+=I:p+=Je();var k;e===null?k="null":be(e)?k="array":e!==void 0&&e.$$typeof===d?(k="<"+(Z(e.type)||"Unknown")+" />",p=" Did you accidentally export a JSX literal instead of a component?"):k=typeof e,D("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",k,p)}var C=Ke(e,t,o,x,E);if(C==null)return C;if(u){var B=t.children;if(B!==void 0)if(l)if(be(B)){for(var me=0;me<B.length;me++)ze(B[me],e);Object.freeze&&Object.freeze(B)}else D("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ze(B,e)}if(fe.call(t,"key")){var xe=Z(e),H=Object.keys(t).filter(function(pt){return pt!=="key"}),at=H.length>0?"{key: someKey, "+H.join(": ..., ")+": ...}":"{key: someKey}";if(!g[xe+at]){var ht=H.length>0?"{"+H.join(": ..., ")+": ...}":"{}";D(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,at,xe,ht,xe),g[xe+at]=!0}}return e===v?m(C):ot(C),C}}function R(e,t,o){return b(e,t,o,!0)}function O(e,t,o){return b(e,t,o,!1)}var G=O,_=R;We.Fragment=v,We.jsx=G,We.jsxs=_}()),We}process.env.NODE_ENV==="production"?st.exports=mt():st.exports=gt();var i=st.exports;function lt(s){const d=window.AudioContext||window.webkitAudioContext,a=new d,v=a.createMediaStreamSource(s),S=a.createAnalyser();S.fftSize=2048,S.smoothingTimeConstant=.85,v.connect(S);const W=new Uint8Array(S.fftSize);function z(){S.getByteTimeDomainData(W);let j=0;for(let y=0;y<W.length;y++){const $=(W[y]-128)/128;j+=$*$}return Math.sqrt(j/W.length)}return{getLevel:()=>z(),dispose:async()=>{try{v.disconnect()}catch{}try{S.disconnect()}catch{}try{await a.close()}catch{}}}}let Ze=null;async function yt(){if(Ze)return Ze;const s=await Promise.resolve().then(()=>require("./blazeface.esm-BsJ4BrW4.cjs")),d=await Promise.resolve().then(()=>require("./index-x7BUnCGZ.cjs"));return d.ready&&await d.ready(),Ze=await s.load(),Ze}async function vt(s){if("FaceDetector"in window)try{const a=await new window.FaceDetector({fastMode:!0,maxDetectedFaces:1}).detect(s);return a&&a.length>0?{present:!0,confidence:.8}:{present:!1,confidence:0}}catch{}try{const a=await(await yt()).estimateFaces(s,!1);if(a&&a.length>0){const v=a[0].probability?a[0].probability[0]:.7;return{present:!0,confidence:Math.max(.5,Math.min(1,v))}}}catch{}return{present:!1,confidence:0}}function dt({onComplete:s,onError:d}){const a=["camera","microphone","face","monitor","browser"],[v,S]=n.useState({camera:"pending",microphone:"pending",face:"pending",monitor:"pending",browser:"pending"}),[W,z]=n.useState(0),[j,y]=n.useState(0),[$,h]=n.useState({}),[w,N]=n.useState(!1),[L,Y]=n.useState({}),U=n.useRef(null),X=n.useRef(null),q=n.useRef(null),D=n.useRef(null),K=n.useRef(null),Q=()=>{try{U.current?.getTracks().forEach(r=>r.stop())}catch{}try{X.current?.getTracks().forEach(r=>r.stop())}catch{}U.current=null,X.current=null,q.current&&(q.current.dispose().catch(()=>{}),q.current=null),D.current&&(cancelAnimationFrame(D.current),D.current=null)},ce=async r=>{try{const c=window.AudioContext||window.webkitAudioContext;if(!c)throw new Error("AudioContext not supported");const f=new c,M=f.createMediaStreamSource(r),T=f.createAnalyser();T.fftSize=256,T.smoothingTimeConstant=.8,M.connect(T);const V=new Uint8Array(T.frequencyBinCount);T.getByteFrequencyData(V),sessionStorage.setItem("audio-context-initialized","true"),M.disconnect(),await f.close(),typeof window<"u"&&(window.precheckAudioStream=r)}catch{sessionStorage.setItem("audio-context-initialized","false")}},ue=async r=>{const c=K.current;let f=0,M=0,T=0;const V=30;for(;T<V&&f<5;){try{const oe=await vt(c);oe.present&&(f+=1,M=Math.max(M,oe.confidence))}catch{}T++,z(T),await new Promise(oe=>setTimeout(oe,100))}return{status:f>=5,confidence:M,timestamp:Date.now()}},A=()=>{try{const r=window.screen.width,c=window.screen.height,f=window.screen.availWidth;return r/c>3||r>f*1.5||[3840,3360,2560,4480,5120].includes(r)?2:1}catch{return 1}},P=async()=>{try{if(!window.isSecureContext)return A();if("getScreenDetails"in window)try{return(await window.getScreenDetails()).screens.length}catch(r){if(r?.name==="NotAllowedError"||r?.name==="SecurityError"){N(!0);try{return await new Promise(M=>{const T=async()=>{V();try{const te=await window.getScreenDetails();M(te.screens.length)}catch{M(A())}},V=()=>{window.removeEventListener("pointerdown",T),window.removeEventListener("keydown",T)};window.addEventListener("pointerdown",T,{once:!0}),window.addEventListener("keydown",T,{once:!0})})}finally{N(!1)}}}return A()}catch{return 1}},J=()=>["navigator.mediaDevices","navigator.mediaDevices.getUserMedia","requestAnimationFrame","WebAssembly"].every(c=>{const f=c.split(".");let M=window;for(const T of f){if(!(T in M))return!1;M=M[T]}return!0}),F=(r,c)=>{S(f=>({...f,[r]:c}))},le=n.useCallback(async()=>{F("camera","running"),h(r=>({...r,camera:""}));try{try{U.current?.getTracks().forEach(c=>c.stop())}catch{}const r=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:15}}});if(U.current=r,!K.current){const c=document.createElement("video");c.muted=!0,c.playsInline=!0,K.current=c}K.current.srcObject=r;try{await K.current.play()}catch{}return Y(c=>({...c,cameraAccess:!0})),F("camera","passed"),!0}catch(r){const c=r?.name==="NotAllowedError"?"Camera permission denied":r?.message||"Camera access failed";return h(f=>({...f,camera:c})),F("camera","failed"),!1}},[]),Ee=n.useCallback(async()=>{F("microphone","running"),h(r=>({...r,microphone:""}));try{try{X.current?.getTracks().forEach(c=>c.stop())}catch{}const r=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});X.current=r,Y(c=>({...c,microphoneAccess:!0})),await ce(r);try{const c=lt(r);q.current=c;const f=()=>{y(c.getLevel()),D.current=requestAnimationFrame(f)};D.current=requestAnimationFrame(f)}catch{}return F("microphone","passed"),!0}catch(r){const c=r?.name==="NotAllowedError"?"Microphone permission denied":r?.message||"Microphone access failed";return h(f=>({...f,microphone:c})),F("microphone","failed"),!1}},[]),Z=n.useCallback(async()=>{F("face","running"),h(r=>({...r,face:""}));try{if(!U.current)throw new Error("Camera is not initialized");const r=await ue(U.current);if(Y(c=>({...c,faceDetection:r})),r.status)return F("face","passed"),!0;throw new Error("No face detected. Please align your face within the frame and retry.")}catch(r){const c=r?.message||"Face detection failed";return h(f=>({...f,face:c})),F("face","failed"),!1}},[]),ee=n.useCallback(async()=>{F("monitor","running"),h(r=>({...r,monitor:""}));try{const r=await P();if(r&&r>1)throw Y(c=>({...c,monitorCount:r})),new Error("Multiple displays detected. Please remove external screens and keep only one display connected, then press Retry.");if(r===1)return Y(c=>({...c,monitorCount:r})),F("monitor","passed"),!0;throw new Error("Could not verify displays")}catch(r){return h(c=>({...c,monitor:r?.message||"Monitor verification failed"})),F("monitor","failed"),!1}},[]),re=n.useCallback(async()=>{F("browser","running"),h(r=>({...r,browser:""}));try{const r=J();if(Y(c=>({...c,browserSupport:r})),!r)throw new Error("Required browser features are unavailable");return F("browser","passed"),!0}catch(r){return h(c=>({...c,browser:r?.message||"Browser not supported"})),F("browser","failed"),!1}},[]),ge={camera:le,microphone:Ee,face:Z,monitor:ee,browser:re},ye=n.useCallback(async r=>{for(let c=r;c<a.length;c++){const f=a[c];if(!await ge[f]())break}},[ge]);n.useEffect(()=>{if(!a.every(f=>v[f]==="passed"))return;const c={cameraAccess:!!L.cameraAccess,microphoneAccess:!!L.microphoneAccess,faceDetection:L.faceDetection||{status:!1,confidence:0,timestamp:Date.now()},monitorCount:L.monitorCount||1,browserSupport:!!L.browserSupport,codeEditorReady:!0};s(c),Q()},[v,L]),n.useEffect(()=>(ye(0),()=>Q()),[]);const Ce=r=>{const c=a.indexOf(r);S(f=>{const M={...f};for(let T=c;T<a.length;T++)M[a[T]]="pending";return M}),h(f=>({...f,[r]:""})),ye(c)},ve=a.filter(r=>v[r]==="passed").length,Re=a.some(r=>v[r]==="running"),de=Math.round((ve+(Re?.5:0))/a.length*100);return i.jsx("div",{style:{fontFamily:"system-ui, sans-serif",minHeight:"100vh",display:"grid",placeItems:"center",background:"linear-gradient(135deg,#eff6ff,#eef2ff)"},children:i.jsxs("div",{style:{width:720,maxWidth:"95vw",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16,boxShadow:"0 8px 24px rgba(0,0,0,0.08)"},children:[i.jsxs("div",{style:{textAlign:"center",marginBottom:12},children:[i.jsx("h2",{style:{margin:0,fontSize:20,fontWeight:700},children:"System Pre-Check"}),i.jsx("p",{style:{color:"#6b7280"},children:"Verifying your system for proctored assessment"})]}),i.jsxs("div",{style:{marginBottom:16},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12},children:[i.jsx("span",{children:"Overall Progress"}),i.jsxs("span",{children:[de,"%"]})]}),i.jsx("div",{style:{height:8,background:"#f3f4f6",borderRadius:9999,overflow:"hidden"},children:i.jsx("div",{style:{width:`${de}%`,height:8,background:"#3b82f6"}})})]}),i.jsx("div",{style:{display:"grid",gap:8},children:a.map(r=>{const c=r==="camera"?"Camera Access":r==="microphone"?"Microphone Access":r==="face"?"Face Detection":r==="monitor"?"Single Monitor Check":"Browser Support",f=v[r],M=f==="passed"?"#ecfdf5":f==="running"?"#eff6ff":f==="failed"?"#fef2f2":"#f9fafb",T=f==="passed"?"#10b981":f==="running"?"#3b82f6":f==="failed"?"#dc2626":"#9ca3af";return i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"16px 1fr auto",gap:12,alignItems:"center",padding:12,borderRadius:8,border:"1px solid #e5e7eb",background:M},children:[i.jsx("div",{style:{width:12,height:12,borderRadius:9999,background:T}}),i.jsxs("div",{style:{minWidth:0},children:[i.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:i.jsx("div",{style:{fontWeight:600,fontSize:14},children:c})}),r==="face"&&i.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:8},children:[i.jsx("video",{ref:K,muted:!0,playsInline:!0,autoPlay:!0,style:{width:180,height:112,background:"#000",borderRadius:6}}),f==="running"&&i.jsxs("div",{style:{color:"#6b7280",fontSize:12},children:["Analyzing frames: ",W]})]}),r==="microphone"&&f!=="pending"&&i.jsx("div",{style:{marginTop:6,width:220,height:8,background:"#e5e7eb",borderRadius:9999,overflow:"hidden"},children:i.jsx("div",{style:{width:`${Math.min(100,Math.round(j*200))}%`,height:8,background:"#10b981",transition:"width 150ms"}})}),w&&r==="monitor"&&(f==="running"||f==="pending")&&i.jsx("div",{style:{marginTop:6,color:"#6b7280",fontSize:12},children:"Requesting display info… click anywhere or press a key to continue."}),$[r]&&i.jsx("div",{style:{marginTop:6,color:"#dc2626",fontSize:12},children:$[r]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("div",{style:{fontSize:12,padding:"2px 8px",borderRadius:9999,background:f==="passed"?"#111827":f==="failed"?"#fee2e2":"#e5e7eb",color:f==="passed"?"#fff":"#111827"},children:f==="passed"?"Passed":f==="running"?"Checking…":f==="failed"?"Failed":"Pending"}),f==="failed"&&i.jsx("button",{onClick:()=>Ce(r),style:{fontSize:12,padding:"6px 10px",borderRadius:6,background:"#111827",color:"#fff",border:0},children:"Retry"})]})]},r)})})]})})}function wt(s){const{onEvent:d,context:a="coding"}=s||{},[v,S]=n.useState("idle"),[W,z]=n.useState(void 0),[j,y]=n.useState(0),[$,h]=n.useState(0),w=n.useRef(null),N=n.useRef(null),L=n.useRef(null),Y=n.useRef(!1),U=n.useRef(0),X=n.useRef(0),q=n.useRef(null),D=n.useCallback(()=>{L.current&&cancelAnimationFrame(L.current),L.current=null;try{w.current?.dispose()}catch{}w.current=null;try{N.current?.getTracks().forEach(A=>A.stop())}catch{}N.current=null,S("idle")},[]),K=n.useCallback(A=>{const P=Date.now(),J=Y.current;A>18&&P-U.current>2e3&&(h(F=>F+1),U.current=P,d?.({eventType:"audio_anomaly",severity:"warning",context:a,data:{level:A,reason:"audio_spike",faceDetected:J}})),J&&A<3?q.current==null?q.current=P:P-q.current>15e3&&(h(F=>F+1),q.current=null,d?.({eventType:"audio_anomaly",severity:"warning",context:a,data:{level:A,reason:"extended_silence_with_face"}})):A>=3&&(q.current=null),!J&&A>12&&P-X.current>3e3&&(h(F=>F+1),X.current=P,d?.({eventType:"audio_anomaly",severity:"warning",context:a,data:{level:A,reason:"audio_without_face"}}))},[a,d]),Q=n.useCallback(()=>{try{if(!w.current)return;const A=w.current.getLevel(),P=Math.max(0,Math.min(100,Math.round(A*160)));y(P),K(P)}finally{L.current=requestAnimationFrame(Q)}},[K]),ce=n.useCallback(async A=>{try{z(void 0),h(0),U.current=0,X.current=0,q.current=null;let P=A;if(!P&&typeof window<"u"&&window.precheckAudioStream){const le=window.precheckAudioStream;le?.active&&le.getAudioTracks().length>0&&(P=le)}P||(P=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:44100}})),N.current=P;const J=P.getAudioTracks(),F=J.length?new MediaStream(J):P;w.current=lt(F),S("running"),L.current=requestAnimationFrame(Q)}catch(P){S("error"),z(P instanceof Error?P.message:String(P))}},[Q]),ue=n.useCallback(A=>{Y.current=A},[]);return n.useEffect(()=>D,[D]),{status:v,error:W,level:j,anomalyCount:$,start:ce,stop:D,setFaceDetected:ue}}function ft({monitoringStatus:s,sessionData:d,onStatusChange:a,onUpdateSession:v,onAddEvent:S}){const[W,z]=n.useState({x:typeof window<"u"?window.innerWidth-280:0,y:typeof window<"u"?window.innerHeight-400:0}),[j,y]=n.useState(!1),[$,h]=n.useState({x:0,y:0}),[w,N]=n.useState(0),[L,Y]=n.useState(!1),[U,X]=n.useState(null),[q,D]=n.useState(null),[K,Q]=n.useState(null),[ce,ue]=n.useState(null),[A,P]=n.useState(0),[J,F]=n.useState(0),[le,Ee]=n.useState([]),[Z,ee]=n.useState(0),[re,ge]=n.useState(0),[ye,Ce]=n.useState(0),[ve,Re]=n.useState(0),[de,r]=n.useState(0),[c,f]=n.useState(!1),[M,T]=n.useState(null),[V,te]=n.useState(null),[oe,ke]=n.useState(0),[it,Te]=n.useState(0),[Ne,et]=n.useState(0),[we,fe]=n.useState(null),[je,qe]=n.useState(0),[De,tt]=n.useState(0),ae=n.useRef(null),be=n.useRef(null),$e=n.useRef(null),Ae=n.useRef(null),se=n.useRef(null),Se=n.useRef(null),Be=n.useRef(!1),Ye=n.useRef(0),Fe=n.useRef(0),he=n.useRef("none");n.useRef({noFace:0,multipleFaces:0});const ne=n.useRef({noFace:!1,multipleFaces:!1,gazeOff:!1}),{level:Ue,anomalyCount:Ve,start:nt,stop:rt,setFaceDetected:Ge}=wt({context:"coding",onEvent:m=>S?.({...m,timestamp:Date.now()})});n.useEffect(()=>P(Ue),[Ue]),n.useEffect(()=>F(Ve),[Ve]);const Ke=n.useCallback((m,g)=>{const b=m.data;let R=0,O=0,G=0;for(let u=0;u<b.length;u+=4){const p=b[u],I=b[u+1],k=b[u+2],C=(p+I+k)/3;if(R+=C,u>0){const B=(b[u-4]+b[u-3]+b[u-2])/3;O+=Math.abs(C-B)}if(u>m.width*4&&u<b.length-m.width*4){const B=(b[u-m.width*4]+b[u-m.width*4+1]+b[u-m.width*4+2])/3,me=(b[u+m.width*4]+b[u+m.width*4+1]+b[u+m.width*4+2])/3;(Math.abs(C-B)>30||Math.abs(C-me)>30)&&G++}}const _=b.length/4;R/=_,O/=_;const e=G/_,t=g.width/g.height,o={neutral:Math.max(.1,.6-Math.abs(R-120)/200-Math.abs(O-15)/100),happy:Math.max(.05,(R>115?.4:.1)+(e>.15?.3:0)+(t>.85?.2:0)),focused:Math.max(.05,(O>20?.4:.1)+(e>.12?.2:0)+(R<110?.2:0)),concerned:Math.max(.05,(R<105?.3:.1)+(O>25?.2:0)+(t<.75?.2:0)),surprised:Math.max(.05,(t>.9?.3:.1)+(e>.18?.3:0))},l=Date.now()%1e4/1e4;Object.keys(o).forEach(u=>{const p=u;o[p]+=Math.sin(l*Math.PI*2)*.1,o[p]=Math.max(.05,Math.min(.95,o[p]))});const x=Object.entries(o).reduce((u,p)=>o[u[0]]>o[p[0]]?u:p)[0],E=Math.max(...Object.values(o));return{dominant:x,confidence:E,emotions:o}},[]),_e=n.useCallback((m,g)=>{const b=g.data;let R=0,O=0,G=0;const _=Math.floor(g.height*.6);for(let E=Math.floor(g.height*.3);E<_;E++)for(let u=0;u<g.width;u+=4){const p=(E*g.width+u)*4,I=b[p],k=b[p+1],C=b[p+2];(I+k+C)/3<100?R++:O++,(Math.abs(I-k)>30||Math.abs(k-C)>30)&&G++}const e=R+O,t=e?R/e:0,o=e?G/e:0,l=t>.4&&o<.3,x=t>.2;return{isProfessional:l,hasShirt:x,confidence:.7,details:l?"Professional attire detected":"Casual attire detected"}},[]),Oe=n.useCallback((m,g,b)=>{const R=m.x+m.width/2,O=m.y+m.height/2,G=(R-g/2)/g,_=(O-b/2)/b,e=Math.sqrt(G*G+_*_),t=e<.15,o=Math.max(0,1-e*2);return{isLookingAtCamera:t,gazeDirection:{x:G,y:_},confidence:.8,attentionScore:o}},[]),ie=n.useCallback(m=>{const{gazeDirection:g,attentionScore:b,isLookingAtCamera:R}=m,O=Math.sqrt(g.x*g.x+g.y*g.y);return!R&&O>.5&&b<.3},[]),Pe=n.useCallback(async()=>{try{const m=await Promise.resolve().then(()=>require("./index-x7BUnCGZ.cjs")),g=await Promise.resolve().then(()=>require("./blazeface.esm-BsJ4BrW4.cjs"));m.ready&&await m.ready();const b=await g.load();return Ae.current=b,!0}catch(m){return console.error("[widget] Failed to init face detection:",m),!1}},[]),pe=n.useCallback(async()=>{if(!ae.current||!be.current||!Ae.current){se.current=requestAnimationFrame(pe);return}const m=ae.current,g=be.current;if(m.readyState!==4){se.current=requestAnimationFrame(pe);return}try{const R=(await Ae.current.estimateFaces(m,!1)).map(_=>{const[e,t]=_.topLeft,[o,l]=_.bottomRight;return{x:e,y:t,width:o-e,height:l-t,confidence:_.probability?.[0]||.8}});N(R.length),Ee(R),Y(R.length===1),Ge(R.length>0);const O=Date.now();let G=R.length===0?"none":R.length===1?"single":"multiple";if(G==="multiple")he.current!=="multiple"&&(T(O),et(_=>_+1),ne.current.multipleFaces||(ne.current.multipleFaces=!0,S?.({eventType:"face_detection",severity:"warning",context:"coding",data:{reason:"multiple_faces",count:R.length},timestamp:O})));else{if(he.current==="multiple"&&M!==null){const _=O-M;ke(e=>e+_),T(null)}ne.current.multipleFaces=!1}if(G==="none")he.current!=="none"&&(fe(O),qe(_=>_+1),ne.current.noFace||(ne.current.noFace=!0,S?.({eventType:"face_detection",severity:"critical",context:"coding",data:{reason:"no_face"},timestamp:O})));else{if(he.current==="none"&&we!==null){const _=O-we;tt(e=>e+_),fe(null)}ne.current.noFace=!1}if(he.current=G,R.length===1){const _=R[0],e=g.getContext("2d");if(e){e.drawImage(m,0,0,g.width,g.height);const t=e.getImageData(0,0,g.width,g.height),o=e.getImageData(_.x,_.y,_.width,_.height),l={isGoodPosture:Math.abs(Math.random()*20-10)<5,shoulderAlignment:Math.random()*20-10,headTilt:Math.random()*15-7.5,confidence:.75},x=Ke(o,_),E=_e(o,t),u=Oe(_,g.width,g.height);X(l),D(x),Q(E),ue(u);const p=ie(u);if(p&&!c&&Date.now()-Fe.current>3e3)r(k=>k+1),f(!0),te(O),Fe.current=Date.now(),ne.current.gazeOff||(ne.current.gazeOff=!0,S?.({eventType:"gaze_tracking",severity:"warning",context:"coding",data:{offscreen:!0},timestamp:O}));else if(!p&&c){if(V!==null){const k=O-V;Te(C=>C+k),te(null)}f(!1),ne.current.gazeOff=!1}const I=R.length===0||R.length>1;if(v&&(I||O-Ye.current>=5e3)){const k=d?.snapshots||[];let C=k;if(I){const B={timestamp:O,type:"violation_trigger",image:"base64_image_placeholder",context:R.length===0?"No face detected":"Multiple faces detected"};C=[...k,B],C.length>30&&(C=C.slice(-30))}v({snapshots:C,postureAnalysis:l,attireAnalysis:E}),Ye.current=O}}}else if(X(null),D(null),Q(null),ue(null),c){if(V!==null){const _=O-V;Te(e=>e+_),te(null)}f(!1)}R.length===0?a?.("violation"):R.length>1?a?.("warning"):a?.("optimal")}catch(b){console.error("[widget] Face detection error:",b)}se.current=requestAnimationFrame(pe)},[Ke,_e,Oe,ie,a,v,d?.snapshots,c,M,V,Ge]);n.useEffect(()=>{F(0)},[]),n.useEffect(()=>((async()=>{try{const g=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:320},height:{ideal:240},frameRate:{ideal:15}},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});ae.current&&(ae.current.srcObject=g);let b=null;const R=g.getAudioTracks();R.length>0&&(b=new MediaStream(R),Se.current=b),await Pe(),b&&await nt(b),se.current=requestAnimationFrame(pe)}catch{a?.("violation")}})(),()=>{Be.current=!0,se.current&&cancelAnimationFrame(se.current),ae.current?.srcObject&&ae.current.srcObject.getTracks().forEach(b=>b.stop()),Se.current&&Se.current.getTracks().forEach(g=>g.stop()),rt(),Se.current=null}),[]);const Je=m=>{y(!0);const g=$e.current?.getBoundingClientRect();g&&h({x:m.clientX-g.left,y:m.clientY-g.top})},He=m=>{if(j){const g=Math.max(0,Math.min((typeof window<"u"?window.innerWidth:0)-280,m.clientX-$.x)),b=Math.max(0,Math.min((typeof window<"u"?window.innerHeight:0)-400,m.clientY-$.y));z({x:g,y:b})}},Me=()=>y(!1);n.useEffect(()=>{if(j)return document.addEventListener("mousemove",He),document.addEventListener("mouseup",Me),()=>{document.removeEventListener("mousemove",He),document.removeEventListener("mouseup",Me)}},[j,$]);const Xe=()=>{document.hidden&&ge(m=>{const g=m+1;return S?.({eventType:"tab_switch",severity:"critical",context:"coding",data:{when:Date.now()},timestamp:Date.now()}),g})},Ie=()=>ee(m=>m+1),ze=m=>{Ce(g=>g+1),S?.({eventType:"keystroke",severity:"info",context:"coding",data:{},timestamp:Date.now()}),(m.ctrlKey||m.metaKey)&&(m.key==="c"||m.key==="x"||m.key==="v")&&(Re(g=>g+1),m.preventDefault(),S?.({eventType:"keystroke",severity:"warning",context:"coding",data:{copyCutPaste:!0,key:m.key},timestamp:Date.now()}))};n.useEffect(()=>(document.addEventListener("visibilitychange",Xe),window.addEventListener("blur",Ie),document.addEventListener("keydown",ze),()=>{document.removeEventListener("visibilitychange",Xe),window.removeEventListener("blur",Ie),document.removeEventListener("keydown",ze)}),[]);const ot=w===0?"#ef4444":w>1?"#f59e0b":"#22c55e";return i.jsxs("div",{ref:$e,onMouseDown:Je,style:{position:"fixed",left:W.x,top:W.y,zIndex:9999,width:288,cursor:"move",border:`2px solid ${ot}`,borderRadius:8,background:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.2)",padding:12,userSelect:"none"},children:[i.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:i.jsx("div",{style:{fontSize:12,fontWeight:600},children:w===0?"No Face":w>1?"Multiple Faces":L?"Optimal":"Good"})}),i.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:4,overflow:"hidden"},children:[i.jsx("video",{ref:ae,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:128,objectFit:"cover"}}),i.jsx("canvas",{ref:be,width:320,height:240,style:{display:"none"}})]}),i.jsxs("div",{style:{marginTop:8,fontSize:12,display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[i.jsxs("div",{children:["Faces: ",i.jsx("strong",{style:{color:w===1?"#16a34a":"#ef4444"},children:w})]}),i.jsxs("div",{children:["No Face: ",i.jsx("strong",{style:{color:je>0?"#ef4444":"#16a34a"},children:je})]}),i.jsxs("div",{children:["Multiple: ",i.jsx("strong",{style:{color:Ne>0?"#ef4444":"#16a34a"},children:Ne})]}),i.jsxs("div",{children:["Eye Contact: ",i.jsx("strong",{style:{color:ce?.isLookingAtCamera?"#16a34a":"#ef4444"},children:ce?.isLookingAtCamera?"Yes":"No"})]}),i.jsxs("div",{children:["Posture: ",i.jsx("strong",{style:{color:U?.isGoodPosture?"#16a34a":"#f59e0b"},children:U?.isGoodPosture?"Good":"Poor"})]}),i.jsxs("div",{children:["Attire: ",i.jsx("strong",{style:{color:K?.isProfessional?"#16a34a":"#f59e0b"},children:K?.isProfessional?"Professional":"Casual"})]}),i.jsxs("div",{children:["Emotion: ",i.jsx("strong",{style:{color:"#3b82f6"},children:q?.dominant||"Unknown"})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:["Audio: ",i.jsxs("span",{style:{color:A>50?"#16a34a":A>20?"#f59e0b":"#ef4444"},children:[A,"%"]}),i.jsx("div",{style:{width:64,height:6,background:"#eee",borderRadius:9999,overflow:"hidden"},children:i.jsx("div",{style:{width:`${Math.min(A,100)}%`,height:6,transition:"width 100ms",background:A>50?"#16a34a":A>20?"#f59e0b":"#ef4444"}})})]}),i.jsxs("div",{children:["Audio Alerts: ",i.jsx("strong",{style:{color:J>0?"#ef4444":"#16a34a"},children:J})]}),i.jsxs("div",{children:["Unfocus: ",i.jsx("strong",{style:{color:Z>0?"#ef4444":"#16a34a"},children:Z})]}),i.jsxs("div",{children:["Tab Switch: ",i.jsx("strong",{style:{color:re>0?"#ef4444":"#16a34a"},children:re})]}),i.jsxs("div",{children:["Keystrokes: ",i.jsx("strong",{style:{color:"#3b82f6"},children:ye})]}),i.jsxs("div",{children:["Copy Attempts: ",i.jsx("strong",{style:{color:ve>0?"#ef4444":"#16a34a"},children:ve})]}),i.jsxs("div",{children:["Gaze Off: ",i.jsx("strong",{style:{color:de>0?"#ef4444":"#16a34a"},children:de})]})]})]})}const Qe=(s,d)=>s.length>d?s.slice(s.length-d):s,bt=(s,d)=>({sessionId:s,sessionType:"coding-assessment",startTime:Date.now(),preCheckResults:d,liveEvents:[],codingMetrics:{totalKeystrokes:0,linesOfCode:0,codeExecutions:0,externalCopyEvents:0,languageSwitches:0,averageTypingSpeed:0,codingTimeVsReadingTime:{coding:0,reading:0}},questionProgress:[],snapshots:[],sessionStats:{totalDuration:0,questionsAttempted:0,violationCount:0,tabSwitches:0,audioAnomalies:0,gazeDuration:0,focusBreaks:0,codeExecutionCount:0,noFaceIncidents:0,multipleFaceIncidents:0,unfocusEvents:0,gazeOffScreenIncidents:0,keystrokes:0,copyCutPasteAttempts:0}});function St(s,d){switch(d.eventType){case"tab_switch":return{...s,tabSwitches:s.tabSwitches+1,violationCount:s.violationCount+1};case"audio_anomaly":return{...s,audioAnomalies:s.audioAnomalies+1,violationCount:s.violationCount+1};case"code_execution":return{...s,codeExecutionCount:s.codeExecutionCount+1};case"face_detection":{const a=d.data?.reason;return a==="no_face"?{...s,noFaceIncidents:s.noFaceIncidents+1,violationCount:s.violationCount+1}:a==="multiple_faces"?{...s,multipleFaceIncidents:s.multipleFaceIncidents+1,violationCount:s.violationCount+1}:s}case"gaze_tracking":{const a=d.data?.type==="focus_break",v=Number(d.data?.focusTimeMs)||0,S=d.data?.offscreen===!0;return{...s,focusBreaks:s.focusBreaks+(a?1:0),gazeDuration:s.gazeDuration+v,unfocusEvents:s.unfocusEvents+(a?1:0),gazeOffScreenIncidents:s.gazeOffScreenIncidents+(S?1:0),violationCount:s.violationCount+(a||S?1:0)}}case"keystroke":{const a=d.data?.copyCutPaste===!0;return{...s,keystrokes:s.keystrokes+1,copyCutPasteAttempts:s.copyCutPasteAttempts+(a?1:0),violationCount:s.violationCount+(a?1:0)}}default:return s}}function xt(s,d){switch(d.type){case"INIT":return{...d.payload};case"SET_FIELDS":{const a={...s,...d.payload};return a.snapshots&&(a.snapshots=Qe(a.snapshots,50)),a.liveEvents&&(a.liveEvents=Qe(a.liveEvents,200)),a}case"ADD_EVENTS":{const a=Qe([...s.liveEvents,...d.events],200),v=d.events.reduce(St,s.sessionStats);return{...s,liveEvents:a,sessionStats:v}}case"ADD_SNAPSHOT":{const a=Qe([...s.snapshots,d.snapshot],50);return{...s,snapshots:a}}case"TICK":{const a=Math.max(0,d.now-s.startTime);return a===s.sessionStats.totalDuration?s:{...s,sessionStats:{...s.sessionStats,totalDuration:a}}}case"COMPLETE":{const a=d.endTime??Date.now();return{...s,sessionStats:{...s.sessionStats,totalDuration:Math.max(0,a-s.startTime)}}}default:return s}}function Et(s){const[d,a]=n.useState(null),v=n.useCallback(h=>{a(w=>w&&xt(w,h))},[]),S=n.useRef(null),W=n.useRef(0),z=n.useRef(null),j=n.useCallback(h=>{const w=`session_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;S.current=w;const N=sessionStorage.getItem(w);if(N)try{const Y=JSON.parse(N);return a(Y),w}catch{}const L=bt(w,h);return a(L),sessionStorage.setItem(w,JSON.stringify(L)),w},[s?.sessionId]),y=n.useCallback(h=>{const w=h??d;if(!(!w||!S.current))try{sessionStorage.setItem(S.current,JSON.stringify(w)),W.current=Date.now()}catch(N){console.error("[session] persist failed",N)}},[d]);return n.useEffect(()=>{if(!d)return;const w=Date.now()-W.current;return w<1e3?(z.current&&clearTimeout(z.current),z.current=setTimeout(()=>y(),1e3-w)):y(),()=>{z.current&&clearTimeout(z.current)}},[d,y]),n.useEffect(()=>{const h=()=>y();return window.addEventListener("visibilitychange",h),window.addEventListener("beforeunload",h),()=>{window.removeEventListener("visibilitychange",h),window.removeEventListener("beforeunload",h)}},[y]),n.useEffect(()=>{if(!d)return;const h=setInterval(()=>v({type:"TICK",now:Date.now()}),1e3);return()=>clearInterval(h)},[d,v]),n.useMemo(()=>({state:d,sessionId:S.current,init:j,setFields:h=>v({type:"SET_FIELDS",payload:h}),addEvents:h=>v({type:"ADD_EVENTS",events:h}),addSnapshot:h=>v({type:"ADD_SNAPSHOT",snapshot:h}),complete:()=>v({type:"COMPLETE"})}),[d,v,j])}function Ct({onSessionStart:s,onSessionUpdate:d,onEvent:a}){const[v,S]=n.useState(null),[W,z]=n.useState("optimal"),j=Et();return n.useEffect(()=>{if(v&&!j.state){const y=j.init(v);s?.(y,v)}},[v,j]),v?i.jsx(ft,{monitoringStatus:W,sessionData:j.state??void 0,onStatusChange:y=>z(y),onUpdateSession:y=>{j.setFields(y),d?.(y)},onAddEvent:y=>{j.addEvents([{...y,timestamp:y.timestamp??Date.now()}]),a?.(y)}}):i.jsx(dt,{onComplete:y=>S(y),onError:()=>S(null)})}exports.FloatingVideo=ft;exports.Prechecks=dt;exports.ProctoringWidget=Ct;
